<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>榛戦緳姹熷ぇ妗ョ洃娴嬬郴缁?/title>
    <!-- 娣诲姞缃戦〉鍥炬爣 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>馃寜</text></svg>">
    <!-- 寮曞叆Chart.js搴撶敤浜庢暟鎹彲瑙嗗寲 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- 寮曞叆Material Icons搴?-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f9fc;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #2c5282, #1a365d);
            color: white;
            padding: 20px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        .header-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c5282;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .logout-btn {
            background-color: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .logout-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }
        /* 鐧诲綍妯℃€佹鏍峰紡 */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .login-container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            width: 350px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h2 {
            color: #007aff;
            margin: 0;
        }
        .login-form .form-group {
            margin-bottom: 20px;
        }
        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .login-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .login-form .login-button {
            background-color: #007aff;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 4px;
            width: 100%;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .login-form .login-button:hover {
            background-color: #0056b3;
        }
        .error-message {
            color: #dc3545;
            margin-top: 10px;
            text-align: center;
        }
        /* 妗ユ绀烘剰鍥炬牱寮?*/
        .bridge-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
            position: relative;
            height: 300px;
            overflow: hidden;
        }
        .bridge {
            position: relative;
            height: 100%;
            width: 100%;
        }
        .bridge-deck {
            position: absolute;
            bottom: 120px;
            left: 5%;
            width: 90%;
            height: 20px;
            background-color: #6c757d;
        }
        .bridge-pier {
            position: absolute;
            bottom: 0;
            width: 40px;
            height: 120px;
            background-color: #495057;
        }
        .bridge-pier:nth-child(1) {
            left: 10%;
        }
        .bridge-pier:nth-child(2) {
            left: 50%;
            transform: translateX(-50%);
        }
        .bridge-pier:nth-child(3) {
            right: 10%;
        }
        .sensor-point {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #28a745;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
            cursor: pointer;
        }
        .sensor-point:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 10;
        }
        .sensor-point.warning {
            background-color: #ffc107;
        }
        .sensor-point.danger {
            background-color: #dc3545;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        .sensor-tooltip {
            position: absolute;
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid rgba(0,0,0,0.03);
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 18px;
            color: #2c5282;
            border-bottom: 1px solid #edf2f7;
            padding-bottom: 12px;
            display: flex;
            align-items: center;
        }
        .card-title::before {
            content: "";
            display: inline-block;
            width: 4px;
            height: 18px;
            background-color: #2c5282;
            margin-right: 10px;
            border-radius: 2px;
        }
        .example-file-link {
            margin-top: 12px;
            display: block;
            font-size: 14px;
            color: #2c5282;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            background-color: #edf2f7;
            transition: all 0.2s;
            width: fit-content;
        }
        .example-file-link:hover {
            background-color: #e2e8f0;
            text-decoration: none;
            transform: translateY(-2px);
        }
        .file-format-info {
            background-color: #f8fafc;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 13px;
            border-left: 3px solid #2c5282;
        }
        .upload-area {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .file-input-container {
            position: relative;
            margin-right: 15px;
            margin-bottom: 10px;
        }
        .custom-file-input {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
        }
        .custom-file-input:hover {
            background-color: #e0e0e0;
        }
        #fileInput {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .button {
            background-color: #2c5282;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        .button:hover {
            background-color: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.12);
        }
        .button:active {
            transform: translateY(0);
        }
        .button.secondary {
            background-color: #718096;
        }
        .button.secondary:hover {
            background-color: #4a5568;
        }
        .button.danger {
            background-color: #e53e3e;
        }
        .button.danger:hover {
            background-color: #c53030;
        }
        .button .material-icons {
            font-size: 16px;
            margin-right: 6px;
        }
        .button:disabled {
            background-color: #cbd5e0;
            color: #718096;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .data-table-container {
            overflow-x: auto;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .data-table th, .data-table td {
            border: 1px solid #edf2f7;
            padding: 10px 14px;
            text-align: left;
        }
        .data-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #4a5568;
        }
        .data-table tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .data-table tr:hover {
            background-color: #ebf4ff;
        }
        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }
        .result-area {
            margin-top: 30px;
        }
        .anomaly-list {
            list-style-type: none;
            padding: 0;
        }
        .anomaly-item {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .anomaly-item.severe {
            background-color: #f8d7da;
            border-left-color: #dc3545;
        }
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            margin-right: 5px;
        }
        .status-normal {
            background-color: #28a745;
        }
        .status-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .status-danger {
            background-color: #dc3545;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 24px;
            background-color: white;
            border-radius: 8px 8px 0 0;
            padding: 0 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .tab {
            padding: 16px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.2s;
            position: relative;
            display: flex;
            align-items: center;
        }
        .tab:hover {
            color: #2c5282;
        }
        .tab.active {
            border-bottom-color: #2c5282;
            color: #2c5282;
            font-weight: 600;
        }
        .tab.active::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: #2c5282;
            border-radius: 50%;
        }
        .tab-content {
            display: none;
            background-color: white;
            border-radius: 0 0 8px 8px;
            padding: 10px 0;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content.active {
            display: block;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007aff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .analysis-summary {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .info-text {
            color: #6c757d;
            font-size: 14px;
            margin: 10px 0;
        }
        .anomaly-count {
            font-size: 24px;
            font-weight: bold;
            color: #dc3545;
            margin-right: 5px;
        }
        .no-data-message {
            text-align: center;
            padding: 30px;
            color: #6c757d;
        }
        .camera-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .camera-item {
            width: calc(25% - 15px);
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 5px;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .camera-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .camera-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .camera-name {
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .camera-status {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            white-space: nowrap;
        }
        .sensor-id {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 4px;
            display: inline-block;
        }
        .online {
            background-color: #28a745;
            color: white;
        }
        .offline {
            background-color: #dc3545;
            color: white;
        }
        .warning {
            background-color: #ffc107;
            color: #212529;
        }
        .camera-view {
            position: relative;
            height: 160px;
            background-color: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
        .camera-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
        }
        .camera-icon {
            font-size: 36px;
            margin-bottom: 10px;
            color: #6c757d;
        }
        .camera-message {
            font-size: 12px;
            text-align: center;
            padding: 0 10px;
        }
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .camera-view:hover .camera-overlay {
            opacity: 1;
        }
        .camera-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        .camera-control-btn {
            background-color: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin: 0 2px;
            font-size: 12px;
        }
        .camera-control-btn:hover {
            background-color: rgba(255,255,255,1);
        }
        .camera-info {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .camera-alert {
            color: #007aff;
            font-size: 14px;
            margin-top: 10px;
        }
        .location-tag {
            font-size: 11px;
            color: #6c757d;
            margin-top: 4px;
            margin-bottom: 5px;
            display: block;
        }
        /* 鍒楄〃瑙嗗浘鏍峰紡 */
        .camera-list {
            display: none;
            flex-direction: column;
            gap: 10px;
        }
        .camera-list-item {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px 15px;
        }
        .camera-list-icon {
            width: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 24px;
        }
        .camera-list-info {
            flex-grow: 1;
        }
        .camera-list-actions {
            display: flex;
            gap: 10px;
        }
        .event-status-display {
            padding: 10px 0;
        }
        .event-status-header {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 10px;
        }
        .event-details {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #2c5282;
            transition: all 0.3s ease;
        }
        #currentEventName {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        #currentEventDescription {
            color: #4a5568;
            margin-bottom: 10px;
        }
        .event-progress-container {
            margin-top: 10px;
        }
        .event-progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .event-progress {
            height: 100%;
            background-color: #2c5282;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .event-progress-text {
            text-align: right;
            font-size: 12px;
            color: #718096;
        }
        .event-alert {
            background-color: #fed7d7;
            border-left: 3px solid #e53e3e;
        }
        .event-alert #currentEventName {
            color: #c53030;
        }
        .event-alert .event-progress {
            background-color: #e53e3e;
        }
        .event-warning {
            background-color: #feebc8;
            border-left: 3px solid #dd6b20;
        }
        .event-warning #currentEventName {
            color: #c05621;
        }
        .event-warning .event-progress {
            background-color: #dd6b20;
        }
        .event-controls {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .event-controls h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #2d3748;
            font-size: 16px;
        }
        .event-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .event-buttons button {
            padding: 6px 12px;
            background-color: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .event-buttons button:hover {
            background-color: #e2e8f0;
        }
        .event-buttons button.active {
            background-color: #4299e1;
            color: white;
            border-color: #3182ce;
        }
        .chart-control-btn {
            transition: all 0.2s ease;
        }
        .chart-control-btn:hover {
            opacity: 0.9;
        }
        .chart-control-btn.active {
            background-color: #4299e1 !important;
            color: white !important;
            border-color: #3182ce !important;
        }
        /* 浜嬩欢鐘舵€佹樉绀烘牱寮?*/
        .event-status-display {
            padding: 10px 0;
        }
        .event-status-header {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 10px;
        }
        .event-details {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #2c5282;
            transition: all 0.3s ease;
        }
        #currentEventName {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        #currentEventDescription {
            color: #4a5568;
            margin-bottom: 10px;
        }
        .event-progress-container {
            margin-top: 10px;
        }
        .event-progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .event-progress {
            height: 100%;
            background-color: #2c5282;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .event-progress-text {
            text-align: right;
            font-size: 12px;
            color: #718096;
        }
        .event-alert {
            background-color: #fed7d7;
            border-left: 3px solid #e53e3e;
        }
        .event-alert #currentEventName {
            color: #c53030;
        }
        .event-alert .event-progress {
            background-color: #e53e3e;
        }
        .event-warning {
            background-color: #feebc8;
            border-left: 3px solid #dd6b20;
        }
        .event-warning #currentEventName {
            color: #c05621;
        }
        .event-warning .event-progress {
            background-color: #dd6b20;
        }
        .event-controls {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .event-controls h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #2d3748;
            font-size: 16px;
        }
        .event-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .event-buttons button {
            padding: 6px 12px;
            background-color: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .event-buttons button:hover {
            background-color: #e2e8f0;
        }
        .event-buttons button.active {
            background-color: #4299e1;
            color: white;
            border-color: #3182ce;
        }
        /* 鍘嗗彶璁板綍鍖哄煙鏍峰紡 */
        .history-section {
            margin-bottom: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .history-header h3 {
            margin: 0;
            font-size: 16px;
            color: #2d3748;
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-item {
            padding: 10px;
            border-left: 3px solid #4299e1;
            background-color: #f8fafc;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .history-item:hover {
            background-color: #edf2f7;
        }
        .history-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .history-item-title {
            font-weight: 500;
        }
        .history-item-time {
            font-size: 12px;
            color: #718096;
        }
        .history-item-stats {
            font-size: 13px;
            color: #4a5568;
        }
        .no-history-message {
            text-align: center;
            padding: 20px;
            color: #a0aec0;
        }
        .button.small {
            padding: 6px 12px;
            font-size: 12px;
        }
        /* 娣诲姞鏂扮殑CSS鏍峰紡 */
        .event-prediction-area {
            margin-bottom: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e9ecef;
        }
        .event-prediction-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .event-prediction-header .material-icons {
            margin-right: 10px;
            color: #e53e3e;
        }
        .event-prediction-header h3 {
            margin: 0;
            color: #2d3748;
            font-size: 18px;
        }
        .prediction-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid #718096;
        }
        .prediction-item.high {
            border-left-color: #e53e3e;
        }
        .prediction-item.medium {
            border-left-color: #dd6b20;
        }
        .prediction-item.low {
            border-left-color: #3182ce;
        }
        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .prediction-type {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
        }
        .prediction-type .material-icons {
            margin-right: 8px;
        }
        .prediction-probability {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }
        .prediction-probability.high {
            background-color: #e53e3e;
        }
        .prediction-probability.medium {
            background-color: #dd6b20;
        }
        .prediction-probability.low {
            background-color: #3182ce;
        }
        .prediction-details {
            margin-bottom: 10px;
        }
        .prediction-reasoning {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 5px;
        }
        .prediction-timestamp {
            font-size: 12px;
            color: #718096;
        }
        .prediction-sensors {
            font-size: 13px;
            color: #4a5568;
            background-color: #f7fafc;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .no-prediction-message {
            text-align: center;
            padding: 20px;
            color: #718096;
            font-style: italic;
        }
        .search-filter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .search-box {
            position: relative;
            width: 300px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 35px;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 14px;
        }
        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }
        .filter-controls {
            display: flex;
            gap: 10px;
        }
        .filter-controls select {
            padding: 8px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
        }
        .camera-last-update {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }
        .no-cameras-message {
            text-align: center;
            padding: 30px;
            color: #718096;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>榛戦緳姹熷ぇ妗ョ洃娴嬬郴缁?/h1>
        <div class="header-subtitle">妗ユ缁撴瀯寮傚父妫€娴嬬郴缁?/div>
        <div class="user-info" id="userInfoDisplay" style="display:none;">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">鐢ㄦ埛</span>
            <button class="logout-btn" id="logoutButton">閫€鍑?/button>
        </div>
    </div>

    <!-- 浜嬩欢棰勬祴鍖哄煙 - 绉诲埌椤堕儴 -->
    <div class="container">
        <div class="event-prediction-area">
            <div class="event-prediction-header">
                <span class="material-icons">warning</span>
                <h3>浜嬩欢棰勬祴</h3>
            </div>
            <div class="event-prediction-content" id="eventPredictionContent">
                <div class="no-prediction-message">
                    绯荤粺姝ｅ湪瀹炴椂鍒嗘瀽浼犳劅鍣ㄦ暟鎹紝鏆傛棤寮傚父浜嬩欢棰勬祴
                </div>
                <!-- 浜嬩欢棰勬祴椤瑰皢鍦ㄨ繖閲屽姩鎬佺敓鎴?-->
            </div>
        </div>
    </div>

    <!-- 鐧诲綍妯℃€佹 -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <div class="login-header">
                <h2>绯荤粺鐧诲綍</h2>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">鐢ㄦ埛鍚?/label>
                    <input type="text" id="username" placeholder="璇疯緭鍏ョ敤鎴峰悕">
                </div>
                <div class="form-group">
                    <label for="password">瀵嗙爜</label>
                    <input type="password" id="password" placeholder="璇疯緭鍏ュ瘑鐮?>
                </div>
                <button class="login-button" id="loginButton">鐧诲綍</button>
                <div class="error-message" id="loginError"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-title">鏁版嵁涓婁紶涓庡垎鏋?/div>
            <div class="upload-area">
                <div class="file-input-container">
                    <div class="custom-file-input">
                        <span class="material-icons">cloud_upload</span>
                        閫夋嫨鏂囦欢
                    </div>
                    <input type="file" id="fileInput" accept=".txt,.csv">
                </div>
                <button class="button" id="uploadButton">
                    <span class="material-icons">publish</span>
                    涓婁紶鏁版嵁
                </button>
                <button class="button secondary" id="resetButton">
                    <span class="material-icons">restart_alt</span>
                    閲嶇疆
                </button>
                <button class="button" id="detectButton" disabled>
                    <span class="material-icons">search</span>
                    寮€濮嬫娴?                </button>
                <button class="button secondary" id="sampleButton">
                    <span class="material-icons">data_object</span>
                    鐢熸垚绀轰緥鏁版嵁
                </button>
                <button class="button secondary" id="refreshButton">
                    <span class="material-icons">autorenew</span>
                    闅忔満鍒锋柊鏁版嵁
                </button>
            </div>
            <div class="info-text" id="fileInfo">鏈€夋嫨鏂囦欢</div>
            <a href="#" id="downloadExample" class="example-file-link">
                <span class="material-icons" style="font-size:16px;vertical-align:middle;">file_download</span> 
                涓嬭浇鏁版嵁鏍煎紡绀轰緥鏂囦欢
            </a>
            <div class="file-format-info">
                <strong>鏀寔鐨勬枃浠舵牸寮?</strong>
                <ul style="margin-top: 5px; margin-bottom: 5px;">
                    <li>CSV鏍煎紡: 鏃堕棿鎴?浼犳劅鍣↖D,鏁板€?(姣忚涓€鏉¤褰?</li>
                    <li>TXT鏍煎紡: 鏃堕棿鎴?鏁板€?(姣忚涓€鏉¤褰曪紝鑷姩鍒嗛厤浼犳劅鍣↖D)</li>
                </ul>
                <div>绀轰緥: 2023-06-15 14:30,浼犳劅鍣ˋ,23.45</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="data">
                <span class="material-icons" style="margin-right:8px;">table_chart</span>
                鏁版嵁鏌ョ湅
            </div>
            <div class="tab" data-tab="visualization">
                <span class="material-icons" style="margin-right:8px;">bar_chart</span>
                鏁版嵁鍙鍖?            </div>
            <div class="tab" data-tab="analysis">
                <span class="material-icons" style="margin-right:8px;">analytics</span>
                寮傚父妫€娴嬬粨鏋?            </div>
            <div class="tab" data-tab="monitor">
                <span class="material-icons" style="margin-right:8px;">videocam</span>
                寮傚父鐩戞帶
            </div>
        </div>

        <div class="tab-content active" id="data-tab">
            <div class="card">
                <div class="card-title">浼犳劅鍣ㄦ暟鎹?/div>
                <div class="data-table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th>鏃堕棿鎴?/th>
                                <th>浼犳劅鍣↖D</th>
                                <th>鏁板€?/th>
                                <th>鐘舵€?/th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 鏁版嵁琛屽皢鍔ㄦ€佹彃鍏?-->
                        </tbody>
                    </table>
                </div>
                <div class="no-data-message" id="noDataMessage">
                    璇蜂笂浼犳暟鎹枃浠跺紑濮嬪垎鏋?                </div>
            </div>
        </div>

        <div class="tab-content" id="visualization-tab">
            <div class="card">
                <div class="card-title">浼犳劅鍣ㄦ暟鎹彲瑙嗗寲</div>
                <div class="chart-container">
                    <canvas id="dataChart"></canvas>
                </div>
                <div class="no-data-message" id="noChartDataMessage">
                    璇蜂笂浼犳暟鎹枃浠舵煡鐪嬪彲瑙嗗寲鍥捐〃
                </div>
            </div>
        </div>

        <div class="tab-content" id="analysis-tab">
            <div class="card">
                <div class="card-title">寮傚父妫€娴嬬粨鏋?/div>
                <!-- 鍘嗗彶璁板綍鍖哄煙 -->
                <div class="history-section">
                    <div class="history-header">
                        <h3>鍘嗗彶妫€娴嬭褰?/h3>
                        <button id="clearHistoryBtn" class="button secondary small">
                            <span class="material-icons">delete</span>
                            娓呯┖鍘嗗彶
                        </button>
                    </div>
                    <div class="history-list" id="detectionHistory">
                        <!-- 鍘嗗彶璁板綍椤瑰皢鍦ㄨ繖閲屽姩鎬佹坊鍔?-->
                        <div class="no-history-message">鏆傛棤鍘嗗彶璁板綍</div>
                    </div>
                </div>
                <div class="loader" id="analysisLoader"></div>
                <div class="analysis-summary" id="analysisSummary" style="display:none;">
                    <h3>鏁版嵁鍒嗘瀽鎽樿</h3>
                    <p>鎬绘暟鎹偣: <span id="totalPoints">0</span></p>
                    <p>妫€娴嬪埌 <span class="anomaly-count" id="anomalyCount">0</span> 涓紓甯?/p>
                    <p>寮傚父绫诲瀷鍒嗗竷:</p>
                    <ul>
                        <li>鍗曠偣寮傚父: <span id="singlePointCount">0</span></li>
                        <li>杩炵画鎬у紓甯? <span id="continuousCount">0</span></li>
                        <li>缇や綋寮傚父: <span id="clusterCount">0</span></li>
                    </ul>
                </div>
                <div class="chart-container">
                    <canvas id="anomalyChart"></canvas>
                </div>
                <div class="result-area">
                    <h3>璇︾粏寮傚父鍒楄〃</h3>
                    <ul class="anomaly-list" id="anomalyList">
                        <!-- 寮傚父椤瑰皢鍔ㄦ€佹彃鍏?-->
                    </ul>
                </div>
                <div class="no-data-message" id="noAnalysisMessage">
                    璇风偣鍑?寮€濮嬫娴?鎸夐挳杩涜寮傚父妫€娴?                </div>
            </div>
        </div>

        <div class="tab-content" id="monitor-tab">
            <div class="card">
                <div class="card-title">妗ユ鐩戞帶</div>
                
                <!-- 鎽勫儚澶存悳绱㈠拰绛涢€夊尯鍩?-->
                <div class="camera-control-section">
                    <div class="search-filter-row">
                        <div class="search-box">
                            <input type="text" id="camera-search" placeholder="鎼滅储鎽勫儚澶?.." aria-label="鎼滅储鎽勫儚澶?>
                            <span class="material-icons search-icon">search</span>
                        </div>
                        <div class="filter-controls">
                            <select id="camera-filter" aria-label="鎽勫儚澶寸瓫閫?>
                                <option value="all">鍏ㄩ儴鎽勫儚澶?/option>
                                <option value="online">鍦ㄧ嚎</option>
                                <option value="offline">绂荤嚎</option>
                                <option value="warning">寮傚父</option>
                            </select>
                            <select id="section-filter" aria-label="鍖烘绛涢€?>
                                <option value="all">鍏ㄩ儴鍖烘</option>
                                <option value="north">鍖楁</option>
                                <option value="center">涓</option>
                                <option value="south">鍗楁</option>
                                <option value="east">涓滄</option>
                                <option value="west">瑗挎</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 鎽勫儚澶寸綉鏍?-->
                <div class="camera-grid" id="cameraGrid">
                    <!-- 鎽勫儚澶村皢鍦ㄨ繖閲屽姩鎬佺敓鎴?-->
                </div>
                
                <div class="no-data-message" id="noMonitorMessage">
                    璇蜂笂浼犳暟鎹垨鐢熸垚绀轰緥鏁版嵁鏉ュ惎鐢ㄧ洃鎺ц鍥?                </div>
            </div>
        </div>
    </div>

    <script>
        // 鍏ㄥ眬鍙橀噺澹版槑鍖哄煙 - 淇濈暀涓€浠藉畾涔夛紝鍒犻櫎閲嶅鐨勫０鏄?        let sensorData = [];
        let allCameras = [];
        let dataUpdateInterval = null;
        let selectedSensors = [];
        let eventPredictions = [];
        let currentEventSimulation = null;
        let dataChart = null;
        let anomalyChart = null;
        let isLoggedIn = false;
        let currentUser = null;
        let zScores = [];
        let anomalyIndices = [];
        let anomalyTypes = [];
        
        // DOM 鍏冪礌寮曠敤
        const loginModal = document.querySelector('.login-modal');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.querySelector('.error-message');
        const userInfoDisplay = document.querySelector('.user-info');
        const userAvatar = document.querySelector('.user-avatar');
        const usernameDisplay = document.querySelector('.username-display');
        const noDataMessage = document.getElementById('noDataMessage');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const uploadButton = document.getElementById('uploadButton');
        const detectButton = document.getElementById('detectButton');
        const sampleButton = document.getElementById('sampleButton');
        const resetButton = document.getElementById('resetButton');
        const refreshButton = document.getElementById('refreshButton');
        const downloadExample = document.getElementById('downloadExample');
        const sensorTooltip = document.createElement('div');
        const eventNameElement = document.getElementById('eventName');
        const eventDescElement = document.getElementById('eventDescription');
        const eventDetails = document.querySelector('.event-details');
        const eventProgressContainer = document.querySelector('.event-progress-container');
        const eventProgressBar = document.querySelector('.event-progress-bar');
        const cameraContainer = document.getElementById('camera-container');
        const dataTable = document.getElementById('dataTable');
        const noChartDataMessage = document.getElementById('noChartDataMessage');
        const noAnalysisMessage = document.getElementById('noAnalysisMessage');
        const noMonitorMessage = document.getElementById('noMonitorMessage');
        const analysisLoader = document.getElementById('analysisLoader');
        const analysisSummary = document.getElementById('analysisSummary');
        const anomalyList = document.getElementById('anomalyList');
        const totalPoints = document.getElementById('totalPoints');
        const anomalyCount = document.getElementById('anomalyCount');
        const singlePointCount = document.getElementById('singlePointCount');
        const continuousCount = document.getElementById('continuousCount');
        const clusterCount = document.getElementById('clusterCount');
        const userName = document.getElementById('userName');
        const logoutButton = document.getElementById('logoutButton');
        
        // 浼犳劅鍣ㄨ寖鍥?        const sensorRanges = {
            '娓╁害': {
                normal: [15, 35],
                warning: [10, 40],
                danger: [5, 45]
            },
            '搴斿彉': {
                normal: [100, 300],
                warning: [80, 350],
                danger: [50, 400]
            },
            '鎸姩': {
                normal: [0.1, 1.0],
                warning: [0.05, 1.5],
                danger: [0, 2.0]
            },
            '鍊捐': {
                normal: [0, 1.0],
                warning: [-0.5, 1.5],
                danger: [-1.0, 2.0]
            },
            '鍏朵粬': {
                normal: [50, 150],
                warning: [30, 170],
                danger: [10, 190]
            }
        };
        
        // 鍏ㄥ眬鍙橀噺 - 浜嬩欢妯℃嫙绫诲瀷
        const bridgeEvents = {
            NORMAL: 'normal',
            EARTHQUAKE: 'earthquake',
            STRONG_WIND: 'strong_wind',
            HEAVY_TRAFFIC: 'heavy_traffic',
            TEMPERATURE_CHANGE: 'temperature_change',
            FLOOD: 'flood'
        };

        // 鍚勭被浜嬩欢鐨勮缃?        const eventSettings = {
            [bridgeEvents.NORMAL]: {
                name: "姝ｅ父杩愯",
                description: "妗ユ缁撴瀯姝ｅ父锛屾墍鏈夌洃娴嬪弬鏁板湪瀹夊叏鑼冨洿鍐呫€?,
                duration: [0, 0], // 鏃犳寔缁椂闂?                severity: 'normal',
                icon: '馃煝'
            },
            [bridgeEvents.EARTHQUAKE]: {
                name: "鍦伴渿浜嬩欢",
                description: "妫€娴嬪埌鍦伴渿娲诲姩锛屾尟鍔ㄤ紶鎰熷櫒鏄剧ず寮傚父璇绘暟锛屽缓璁繘琛屽畨鍏ㄦ鏌ャ€?,
                duration: [10, 20], // 鎸佺画10-20涓懆鏈?                severity: 'alert',
                icon: '馃敶'
            },
            [bridgeEvents.STRONG_WIND]: {
                name: "寮洪浜嬩欢",
                description: "褰撳墠椋庨€熻繃楂橈紝妗ユ缁撴瀯鎵垮彈杈冨ぇ椋庤浇鑽凤紝寤鸿闄愰€熼€氳銆?,
                duration: [15, 30], // 鎸佺画15-30涓懆鏈?                severity: 'warning',
                icon: '馃煚'
            },
            [bridgeEvents.HEAVY_TRAFFIC]: {
                name: "浜ら€氭嫢鍫?,
                description: "妗ラ潰浜ら€氭祦閲忚繃澶э紝妗ユ鎵垮彈棰濆杞借嵎锛屽簲鍙樹紶鎰熷櫒璇绘暟鍗囬珮銆?,
                duration: [20, 40], // 鎸佺画20-40涓懆鏈?                severity: 'warning',
                icon: '馃煚'
            },
            [bridgeEvents.TEMPERATURE_CHANGE]: {
                name: "娓╁害鍓у彉",
                description: "妫€娴嬪埌鐜娓╁害蹇€熷彉鍖栵紝鏉愭枡鐑儉鍐风缉瀵艰嚧搴斿彉鍙樺寲銆?,
                duration: [25, 45], // 鎸佺画25-45涓懆鏈?                severity: 'warning',
                icon: '馃煚'
            },
            [bridgeEvents.FLOOD]: {
                name: "娲按璀︽姤",
                description: "妫€娴嬪埌姘翠綅寮傚父涓婃定锛屾ˉ澧╁彈鍒版按娴佸啿鍑伙紝鎸姩鍜屽€捐浼犳劅鍣ㄦ暟鎹紓甯搞€?,
                duration: [30, 60], // 鎸佺画30-60涓懆鏈?                severity: 'alert',
                icon: '馃敶'
            }
        };

        // 鐧诲綍鍔熻兘
        function checkLoginStatus() {
            console.log("妫€鏌ョ櫥褰曠姸鎬?..");
            // 浠巐ocalStorage妫€鏌ョ櫥褰曠姸鎬?            const storedUser = localStorage.getItem('bridgeSystemUser');
            if (storedUser) {
                try {
                    currentUser = JSON.parse(storedUser);
                    isLoggedIn = true;
                    showUserInfo();
                    hideLoginModal();
                    console.log("鐢ㄦ埛宸茬櫥褰?", currentUser.username);
                } catch (e) {
                    console.error('瑙ｆ瀽瀛樺偍鐨勭敤鎴蜂俊鎭椂鍑洪敊:', e);
                    showLoginModal();
                }
            } else {
                console.log("鏈壘鍒扮櫥褰曚俊鎭紝鏄剧ず鐧诲綍鐣岄潰");
                showLoginModal();
            }
        }

        function showUserInfo() {
            console.log("鏄剧ず鐢ㄦ埛淇℃伅");
            if (currentUser && userInfoDisplay) {
                userInfoDisplay.style.display = 'flex';
                if (userName) userName.textContent = currentUser.username;
                if (userAvatar) userAvatar.textContent = currentUser.username.charAt(0).toUpperCase();
            } else {
                console.warn("鏃犳硶鏄剧ず鐢ㄦ埛淇℃伅锛屾鏌serInfoDisplay鎴朿urrentUser鏄惁瀛樺湪");
            }
        }

        function hideUserInfo() {
            if (userInfoDisplay) {
                userInfoDisplay.style.display = 'none';
            }
        }

        function showLoginModal() {
            console.log("鏄剧ず鐧诲綍鐣岄潰");
            if (loginModal) {
                loginModal.style.display = 'flex';
                if (usernameInput) usernameInput.focus();
            } else {
                console.error("鐧诲綍妯℃€佹涓嶅瓨鍦紝妫€鏌TML缁撴瀯");
                // 濡傛灉鎵句笉鍒版ā鎬佹锛屽垱寤轰竴涓复鏃剁櫥褰曠晫闈?                createTemporaryLoginForm();
            }
        }

        function createTemporaryLoginForm() {
            console.log("鍒涘缓涓存椂鐧诲綍琛ㄥ崟");
            // 鍒涘缓涓存椂鐧诲綍琛ㄥ崟锛屼綔涓哄鐢ㄦ柟妗?            const tempLoginForm = document.createElement('div');
            tempLoginForm.id = 'tempLoginForm';
            tempLoginForm.className = 'login-modal';
            tempLoginForm.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:9999;';
            
            tempLoginForm.innerHTML = `
                <div class="login-container" style="background:white; padding:20px; border-radius:8px; width:300px; box-shadow:0 0 10px rgba(0,0,0,0.2);">
                    <h2 style="text-align:center; margin-bottom:20px;">榛戦緳姹熷ぇ妗ョ洃娴嬬郴缁?/h2>
                    <div style="margin-bottom:15px;">
                        <label for="temp-username" style="display:block; margin-bottom:5px;">鐢ㄦ埛鍚?/label>
                        <input type="text" id="temp-username" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;" placeholder="璇疯緭鍏ョ敤鎴峰悕">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label for="temp-password" style="display:block; margin-bottom:5px;">瀵嗙爜</label>
                        <input type="password" id="temp-password" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;" placeholder="璇疯緭鍏ュ瘑鐮?>
                    </div>
                    <div id="temp-login-error" style="color:red; margin-bottom:10px; display:none;">鐢ㄦ埛鍚嶆垨瀵嗙爜閿欒</div>
                    <button id="temp-login-button" style="width:100%; padding:10px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">鐧诲綍</button>
                </div>
            `;
            
            document.body.appendChild(tempLoginForm);
            
            // 娣诲姞涓存椂鐧诲綍琛ㄥ崟鐨勪簨浠剁洃鍚?            document.getElementById('temp-login-button').addEventListener('click', function() {
                const username = document.getElementById('temp-username').value;
                const password = document.getElementById('temp-password').value;
                
                if (username && password) {
                    // 妯℃嫙鐧诲綍楠岃瘉
                    currentUser = { username: username, role: 'admin' };
                    isLoggedIn = true;
                    localStorage.setItem('bridgeSystemUser', JSON.stringify(currentUser));
                    
                    // 绉婚櫎涓存椂鐧诲綍琛ㄥ崟
                    document.body.removeChild(tempLoginForm);
                    
                    // 鍒锋柊椤甸潰浠ュ簲鐢ㄦ纭殑鐧诲綍鐘舵€?                    location.reload();
                } else {
                    document.getElementById('temp-login-error').style.display = 'block';
                }
            });
        }

        function hideLoginModal() {
            if (loginModal) {
                loginModal.style.display = 'none';
            }
        }

        function handleLogin() {
            console.log("澶勭悊鐧诲綍璇锋眰");
            const username = usernameInput ? usernameInput.value : '';
            const password = passwordInput ? passwordInput.value : '';
            
            if (username && password) {
                // 绠€鍖栫増鏈細浠讳綍闈炵┖鐢ㄦ埛鍚嶅拰瀵嗙爜閮借鎺ュ彈
                currentUser = {
                    username: username,
                    role: 'admin',
                    loginTime: new Date().toISOString()
                };
                isLoggedIn = true;
                
                // 灏嗙敤鎴蜂俊鎭瓨鍌ㄥ湪localStorage涓?                localStorage.setItem('bridgeSystemUser', JSON.stringify(currentUser));
                
                // 鏇存柊UI
                showUserInfo();
                hideLoginModal();
                
                console.log("鐧诲綍鎴愬姛:", username);
            } else {
                if (loginError) {
                    loginError.textContent = '璇疯緭鍏ョ敤鎴峰悕鍜屽瘑鐮?;
                    loginError.style.display = 'block';
                }
                console.warn("鐧诲綍澶辫触: 鐢ㄦ埛鍚嶆垨瀵嗙爜涓虹┖");
            }
        }

        function handleLogout() {
            console.log("澶勭悊鐧诲嚭璇锋眰");
            // 娓呴櫎鐢ㄦ埛淇℃伅
            localStorage.removeItem('bridgeSystemUser');
            currentUser = null;
            isLoggedIn = false;
            
            // 鏇存柊UI
            hideUserInfo();
            showLoginModal();
        }

        // 鍒濆鍖栨ˉ姊佺洃鎺у浘
        function initBridgeMonitor() {
            const bridge = document.querySelector('.bridge');
            const noMonitorMessage = document.getElementById('noMonitorMessage');
            
            if (!sensorData || sensorData.length === 0) {
                noMonitorMessage.style.display = 'block';
                return;
            }
            
            noMonitorMessage.style.display = 'none';
            
            // 娓呴櫎鐜版湁浼犳劅鍣ㄧ偣
            document.querySelectorAll('.sensor-point').forEach(point => point.remove());
            
            // 鍒涘缓浼犳劅鍣ㄧ偣
            const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
            
            uniqueSensors.forEach((sensorId, index) => {
                // 鑾峰彇璇ヤ紶鎰熷櫒鐨勬墍鏈夋暟鎹偣
                const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                
                // 鍒ゆ柇浼犳劅鍣ㄧ姸鎬?                let status = 'normal';
                for (const point of sensorPoints) {
                    if (point.status === 'danger') {
                        status = 'danger';
                        break;
                    } else if (point.status === 'warning') {
                        status = 'warning';
                    }
                }
                
                // 璁＄畻浣嶇疆锛堝潎鍖€鍒嗗竷鍦ㄦˉ闈笂锛?                const xPos = 10 + (80 * index / (uniqueSensors.length > 1 ? uniqueSensors.length - 1 : 1)) + '%';
                const yPos = '120px'; // 鏀惧湪妗ラ潰涓?                
                // 鍒涘缓浼犳劅鍣ㄧ偣鍏冪礌
                const sensorPoint = document.createElement('div');
                sensorPoint.className = `sensor-point ${status}`;
                sensorPoint.style.left = xPos;
                sensorPoint.style.top = yPos;
                sensorPoint.dataset.sensorId = sensorId;
                sensorPoint.dataset.status = status;
                
                // 娣诲姞鎮仠浜嬩欢鏄剧ず宸ュ叿鎻愮ず
                sensorPoint.addEventListener('mouseover', function(e) {
                    const rect = this.getBoundingClientRect();
                    
                    // 缁熻寮傚父鏁伴噺
                    const abnormalCount = sensorPoints.filter(p => p.status === 'danger').length;
                    
                    sensorTooltip.innerHTML = `
                        <strong>浼犳劅鍣?</strong> ${sensorId}<br>
                        <strong>鐘舵€?</strong> ${getStatusText(status)}<br>
                        <strong>寮傚父鐐规暟:</strong> ${abnormalCount}
                    `;
                    
                    sensorTooltip.style.top = `${rect.top - 70}px`;
                    sensorTooltip.style.left = `${rect.left}px`;
                    sensorTooltip.style.opacity = '1';
                });
                
                sensorPoint.addEventListener('mouseout', function() {
                    sensorTooltip.style.opacity = '0';
                });
                
                // 鐐瑰嚮璺宠浆鍒板搴斾紶鎰熷櫒鐨勫垎鏋愮粨鏋?                sensorPoint.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.tab[data-tab="analysis"]').classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('analysis-tab').classList.add('active');
                    
                    // 婊氬姩鍒板紓甯稿垪琛ㄤ綅缃?                    document.querySelector('.result-area').scrollIntoView({ behavior: 'smooth' });
                    
                    // 楂樹寒鏄剧ず瀵瑰簲浼犳劅鍣ㄧ殑寮傚父
                    document.querySelectorAll('.anomaly-item').forEach(item => {
                        if (item.textContent.includes(sensorId)) {
                            item.style.backgroundColor = '#fff3cd';
                            setTimeout(() => {
                                item.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                });
                
                bridge.appendChild(sensorPoint);
            });
        }

        function getStatusText(status) {
            switch(status) {
                case 'normal':
                    return '姝ｅ父';
                case 'warning':
                    return '璀﹀憡';
                case 'danger':
                    return '寮傚父';
                default:
                    return '鏈煡';
            }
        }

        // 鍒濆鍖栨憚鍍忓ご鐩戞帶绯荤粺
        function initCameraMonitor() {
            console.log("鍒濆鍖栨憚鍍忓ご鐩戞帶绯荤粺");
            
            // 妫€鏌ユ憚鍍忓ご瀹瑰櫒鏄惁瀛樺湪
            const cameraContainerElement = document.getElementById('camera-container');
            if (!cameraContainerElement) {
                console.warn("鎽勫儚澶村鍣ㄦ湭鎵惧埌锛屽彲鑳藉湪閿欒鐨勯〉闈笂灏濊瘯鍒濆鍖栨憚鍍忓ご");
                return; // 鎻愬墠杩斿洖閬垮厤閿欒
            }
            
            // 娓呯┖鎽勫儚澶村鍣?            cameraContainerElement.innerHTML = '';
            
            // 瀹氫箟鎽勫儚澶翠綅缃拰瀵瑰簲鐨勪紶鎰熷櫒
            const cameraLocations = [
                { id: 1, name: "妗ユ鍖楃-宸︿晶", status: "online", sensorId: "TL-101" },
                { id: 2, name: "妗ユ鍖楃-鍙充晶", status: "online", sensorId: "TR-102" },
                { id: 3, name: "妗ユ涓昏法-A1", status: "online", sensorId: "MA-201" },
                { id: 4, name: "妗ユ涓昏法-A2", status: "online", sensorId: "MA-202" },
                { id: 5, name: "妗ユ涓昏法-B1", status: "warning", sensorId: "MB-203" },
                { id: 6, name: "妗ユ涓昏法-B2", status: "online", sensorId: "MB-204" },
                { id: 7, name: "妗ユ涓昏法-C1", status: "offline", sensorId: "MC-205" },
                { id: 8, name: "妗ユ涓昏法-C2", status: "online", sensorId: "MC-206" },
                { id: 9, name: "妗ユ鍗楃-宸︿晶", status: "online", sensorId: "BL-301" },
                { id: 10, name: "妗ユ鍗楃-鍙充晶", status: "warning", sensorId: "BR-302" },
                { id: 11, name: "妗ュⅸ-鍖?", status: "online", sensorId: "PN-401" },
                { id: 12, name: "妗ュⅸ-鍖?", status: "online", sensorId: "PN-402" },
                { id: 13, name: "妗ュⅸ-涓?", status: "offline", sensorId: "PM-403" },
                { id: 14, name: "妗ュⅸ-涓?", status: "online", sensorId: "PM-404" },
                { id: 15, name: "妗ュⅸ-鍗?", status: "online", sensorId: "PS-405" },
                { id: 16, name: "妗ュⅸ-鍗?", status: "online", sensorId: "PS-406" },
                { id: 17, name: "寮曟ˉ娈?鍖?, status: "warning", sensorId: "AN-501" },
                { id: 18, name: "寮曟ˉ娈?鍗?, status: "online", sensorId: "AS-502" },
                { id: 19, name: "杈呭姪閫氶亾-涓?, status: "offline", sensorId: "SE-601" },
                { id: 20, name: "杈呭姪閫氶亾-瑗?, status: "online", sensorId: "SW-602" }
            ];
            
            // 鍒涘缓鎽勫儚澶村厓绱?            cameraLocations.forEach(camera => {
                const cameraItem = createCameraItem(camera);
                cameraContainerElement.appendChild(cameraItem);
            });
            
            // 璁剧疆绛涢€夊櫒鍜屾悳绱㈠姛鑳?            const cameraFilter = document.getElementById('camera-filter');
            const cameraSearch = document.getElementById('camera-search');
            
            cameraFilter.addEventListener('change', function() {
                filterCameras();
            });
            
            cameraSearch.addEventListener('input', function() {
                filterCameras();
            });
            
            // 璁剧疆瑙嗗浘鍒囨崲鍔熻兘
            const viewGrid = document.getElementById('view-grid');
            const viewList = document.getElementById('view-list');
            
            viewGrid.addEventListener('click', function() {
                cameraContainer.className = 'camera-grid';
                this.classList.add('secondary');
                viewList.classList.remove('secondary');
            });
            
            viewList.addEventListener('click', function() {
                cameraContainer.className = 'camera-list';
                this.classList.add('secondary');
                viewGrid.classList.remove('secondary');
            });
            
            // 鏇存柊绯荤粺鐘舵€?            updateSystemStatus(cameraLocations);
        }

        // 鍒涘缓鍗曚釜鎽勫儚澶撮」
        function createCameraItem(camera) {
            const cameraItem = document.createElement('div');
            cameraItem.className = 'camera-item';
            cameraItem.dataset.cameraId = camera.id;
            cameraItem.dataset.status = camera.status;
            cameraItem.dataset.sensorId = camera.sensorId;
            
            // 鍒涘缓鎽勫儚澶村ご閮?            const cameraHeader = document.createElement('div');
            cameraHeader.className = 'camera-header';
            
            const cameraName = document.createElement('span');
            cameraName.className = 'camera-name';
            cameraName.textContent = `鎽勫儚澶?#${camera.id}`;
            
            const cameraStatus = document.createElement('span');
            cameraStatus.className = `camera-status ${camera.status}`;
            cameraStatus.textContent = getStatusText(camera.status);
            
            cameraHeader.appendChild(cameraName);
            cameraHeader.appendChild(cameraStatus);
            cameraItem.appendChild(cameraHeader);
            
            // 娣诲姞浣嶇疆鏍囩
            const locationTag = document.createElement('span');
            locationTag.className = 'location-tag';
            locationTag.textContent = camera.name;
            cameraItem.appendChild(locationTag);
            
            // 娣诲姞浼犳劅鍣↖D
            const sensorId = document.createElement('div');
            sensorId.className = 'sensor-id';
            sensorId.innerHTML = `<strong>浼犳劅鍣?</strong> ${camera.sensorId}`;
            cameraItem.appendChild(sensorId);
            
            // 鍒涘缓鎽勫儚澶磋鍥?            const cameraView = document.createElement('div');
            cameraView.className = 'camera-view';
            
            // 鍙湁鍦ㄧ嚎鐨勬憚鍍忓ご鎵嶅姞杞介殢鏈哄浘鍍?            if (camera.status === 'online' || camera.status === 'warning') {
                // 鍒涘缓鍥惧儚鍗犱綅绗?                const placeholder = document.createElement('div');
                placeholder.className = 'camera-placeholder';
                
                const cameraIcon = document.createElement('span');
                cameraIcon.className = 'material-icons camera-icon';
                cameraIcon.textContent = 'videocam';
                
                const message = document.createElement('div');
                message.className = 'camera-message';
                message.textContent = '鐐瑰嚮鏌ョ湅瀹炴椂鐩戞帶';
                
                placeholder.appendChild(cameraIcon);
                placeholder.appendChild(message);
                cameraView.appendChild(placeholder);
            } else {
                // 鍒涘缓绂荤嚎鍗犱綅绗?                const placeholder = document.createElement('div');
                placeholder.className = 'camera-placeholder';
                
                const cameraIcon = document.createElement('span');
                cameraIcon.className = 'material-icons camera-icon';
                cameraIcon.textContent = 'videocam_off';
                
                const message = document.createElement('div');
                message.className = 'camera-message';
                message.textContent = '鎽勫儚澶寸绾?;
                
                placeholder.appendChild(cameraIcon);
                placeholder.appendChild(message);
                cameraView.appendChild(placeholder);
            }
            
            // 鍒涘缓鎽勫儚澶磋鐩栧眰
            const cameraOverlay = document.createElement('div');
            cameraOverlay.className = 'camera-overlay';
            
            // 娣诲姞鎿嶄綔鎸夐挳
            const viewButton = document.createElement('button');
            viewButton.className = 'camera-control-btn';
            viewButton.innerHTML = '<span class="material-icons">fullscreen</span>';
            viewButton.dataset.action = 'view';
            viewButton.dataset.camera = camera.id;
            viewButton.addEventListener('click', function(e) {
                e.stopPropagation();
                viewCamera(camera.id);
            });
            
            cameraOverlay.appendChild(viewButton);
            cameraView.appendChild(cameraOverlay);
            
            // 璁剧疆鎽勫儚澶寸偣鍑讳簨浠?            cameraView.addEventListener('click', function() {
                if (camera.status !== 'offline') {
                    viewCamera(camera.id);
                } else {
                    alert(`鎽勫儚澶?#${camera.id} (${camera.name}) 褰撳墠绂荤嚎锛屾棤娉曟煡鐪嬬敾闈);
                }
            });
            
            cameraItem.appendChild(cameraView);
            
            // 娣诲姞鎽勫儚澶存帶鍒舵寜閽?            const cameraControls = document.createElement('div');
            cameraControls.className = 'camera-controls';
            
            // 鍙湁鍦ㄧ嚎鐨勬憚鍍忓ご鎵嶈兘鎺у埗
            if (camera.status !== 'offline') {
                const controlButtons = [
                    { action: 'history', icon: 'history', text: '鍘嗗彶璁板綍' },
                    { action: 'refresh', icon: 'refresh', text: '鍒锋柊' }
                ];
                
                controlButtons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = 'camera-control-btn';
                    button.title = btn.text;
                    button.innerHTML = `<span class="material-icons">${btn.icon}</span>`;
                    button.dataset.action = btn.action;
                    button.dataset.camera = camera.id;
                    button.addEventListener('click', function() {
                        controlCamera(camera.id, btn.action);
                    });
                    cameraControls.appendChild(button);
                });
            } else {
                const reconnectButton = document.createElement('button');
                reconnectButton.className = 'camera-control-btn';
                reconnectButton.title = '灏濊瘯閲嶈繛';
                reconnectButton.innerHTML = '<span class="material-icons">sync</span>';
                reconnectButton.dataset.action = 'reconnect';
                reconnectButton.dataset.camera = camera.id;
                reconnectButton.addEventListener('click', function() {
                    attemptReconnect(camera.id);
                });
                cameraControls.appendChild(reconnectButton);
            }
            
            cameraItem.appendChild(cameraControls);
            
            return cameraItem;
        }

        // 绛涢€夋憚鍍忓ご
        function filterCameras() {
            const filterValue = document.getElementById('camera-filter').value;
            const searchText = document.getElementById('camera-search').value.toLowerCase();
            
            const cameraItems = document.querySelectorAll('.camera-item');
            
            cameraItems.forEach(item => {
                const cameraStatus = item.dataset.status;
                const cameraId = item.dataset.cameraId;
                const cameraName = item.querySelector('.camera-name').textContent.toLowerCase();
                const locationName = item.querySelector('.location-tag').textContent.toLowerCase();
                const sensorId = item.dataset.sensorId.toLowerCase();
                
                let statusMatch = true;
                if (filterValue !== 'all') {
                    statusMatch = cameraStatus === filterValue;
                }
                
                const searchMatch = 
                    cameraName.includes(searchText) || 
                    locationName.includes(searchText) || 
                    sensorId.includes(searchText) ||
                    `鎽勫儚澶?${cameraId}`.toLowerCase().includes(searchText);
                
                if (statusMatch && searchMatch) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // 鏇存柊鏃犵粨鏋滄秷鎭?            let visibleCount = 0;
            cameraItems.forEach(item => {
                if (item.style.display !== 'none') {
                    visibleCount++;
                }
            });
            
            if (visibleCount === 0) {
                // 濡傛灉娌℃湁鍖归厤椤癸紝鏄剧ず娑堟伅
                let noResultMessage = document.getElementById('no-camera-results');
                if (!noResultMessage) {
                    noResultMessage = document.createElement('div');
                    noResultMessage.id = 'no-camera-results';
                    noResultMessage.className = 'no-data-message';
                    noResultMessage.textContent = '娌℃湁鍖归厤鐨勬憚鍍忓ご';
                    cameraContainer.appendChild(noResultMessage);
                } else {
                    noResultMessage.style.display = 'block';
                }
            } else {
                // 闅愯棌娑堟伅锛堝鏋滃瓨鍦級
                const noResultMessage = document.getElementById('no-camera-results');
                if (noResultMessage) {
                    noResultMessage.style.display = 'none';
                }
            }
        }

        // 鏌ョ湅鎽勫儚澶寸敾闈?        function viewCamera(cameraId) {
            console.log(`鏌ョ湅鎽勫儚澶?#${cameraId} 鐢婚潰`);
            
            // 鍦ㄥ疄闄呭簲鐢ㄤ腑锛岃繖閲屼細寮瑰嚭涓€涓ā鎬佹鏄剧ず瀹炴椂瑙嗛
            alert(`姝ｅ湪鎵撳紑鎽勫儚澶?#${cameraId} 鐨勫疄鏃剁洃鎺х敾闈);
            
            // 妯℃嫙鍔犺浇鏂扮敾闈?            const camera = document.querySelector(`.camera-item[data-camera-id="${cameraId}"] .camera-placeholder`);
            if (camera) {
                camera.querySelector('.camera-message').textContent = '姝ｅ湪鍔犺浇瀹炴椂鐢婚潰...';
                camera.querySelector('.camera-icon').textContent = 'sync';
                
                // 2绉掑悗鎭㈠
                setTimeout(() => {
                    camera.querySelector('.camera-message').textContent = '鐐瑰嚮鏌ョ湅瀹炴椂鐩戞帶';
                    camera.querySelector('.camera-icon').textContent = 'videocam';
                }, 2000);
            }
        }

        // 灏濊瘯閲嶈繛鎽勫儚澶?        function attemptReconnect(cameraId) {
            console.log(`灏濊瘯閲嶈繛鎽勫儚澶?#${cameraId}`);
            
            const cameraItem = document.querySelector(`.camera-item[data-camera-id="${cameraId}"]`);
            if (!cameraItem) return;
            
            // 淇敼鎽勫儚澶村崰浣嶇鏄剧ず閲嶈繛鐘舵€?            const placeholder = cameraItem.querySelector('.camera-placeholder');
            placeholder.querySelector('.camera-message').textContent = '姝ｅ湪灏濊瘯閲嶆柊杩炴帴...';
            placeholder.querySelector('.camera-icon').textContent = 'sync';
            
            // 妯℃嫙閲嶈繛杩囩▼
            let connectionAttempts = 0;
            const maxAttempts = 3;
            
            const attemptInterval = setInterval(() => {
                connectionAttempts++;
                console.log(`閲嶈繛灏濊瘯 ${connectionAttempts}/${maxAttempts}`);
                
                if (connectionAttempts >= maxAttempts && Math.random() > 0.7) {
                    // 妯℃嫙閲嶈繛鎴愬姛
                    clearInterval(attemptInterval);
                    
                    // 鏇存柊鐘舵€佷负鍦ㄧ嚎
                    const statusBadge = cameraItem.querySelector('.camera-status');
                    statusBadge.textContent = '鍦ㄧ嚎';
                    statusBadge.className = 'camera-status online';
                    cameraItem.dataset.status = 'online';
                    
                    // 鏇存柊鍥炬爣鍜屾秷鎭?                    placeholder.querySelector('.camera-message').textContent = '鎽勫儚澶村凡鎭㈠杩炴帴';
                    placeholder.querySelector('.camera-icon').textContent = 'videocam';
                    
                    // 鏇挎崲鎺у埗鎸夐挳
                    const cameraControls = cameraItem.querySelector('.camera-controls');
                    cameraControls.innerHTML = '';
                    
                    const controlButtons = [
                        { action: 'history', icon: 'history', text: '鍘嗗彶璁板綍' },
                        { action: 'refresh', icon: 'refresh', text: '鍒锋柊' }
                    ];
                    
                    controlButtons.forEach(btn => {
                        const button = document.createElement('button');
                        button.className = 'camera-control-btn';
                        button.title = btn.text;
                        button.innerHTML = `<span class="material-icons">${btn.icon}</span>`;
                        button.dataset.action = btn.action;
                        button.dataset.camera = cameraId;
                        button.addEventListener('click', function() {
                            controlCamera(cameraId, btn.action);
                        });
                        cameraControls.appendChild(button);
                    });
                    
                    // 鏄剧ず鎴愬姛娑堟伅
                    showActionFeedback(cameraId, '鎽勫儚澶村凡鎭㈠杩炴帴');
                    
                    // 鏇存柊绯荤粺鐘舵€?                    updateSystemStatus();
                } else if (connectionAttempts >= maxAttempts) {
                    // 妯℃嫙閲嶈繛澶辫触
                    clearInterval(attemptInterval);
                    
                    // 鎭㈠绂荤嚎鐘舵€?                    placeholder.querySelector('.camera-message').textContent = '閲嶈繛澶辫触锛屾憚鍍忓ご绂荤嚎';
                    placeholder.querySelector('.camera-icon').textContent = 'videocam_off';
                    
                    // 鏄剧ず澶辫触娑堟伅
                    showActionFeedback(cameraId, '閲嶈繛澶辫触');
                }
            }, 1000);
        }

        // 鏇存柊绯荤粺鐘舵€佷俊鎭?        function updateSystemStatus() {
            // 缁熻鎽勫儚澶寸姸鎬?            const cameras = document.querySelectorAll('.camera-item');
            let onlineCount = 0;
            let offlineCount = 0;
            let warningCount = 0;
            
            cameras.forEach(camera => {
                const status = camera.dataset.status;
                if (status === 'online') onlineCount++;
                else if (status === 'offline') offlineCount++;
                else if (status === 'warning') warningCount++;
            });
            
            const systemStatus = document.getElementById('system-status');
            
            if (offlineCount > 0 || warningCount > 0) {
                let statusMessage = `鎽勫儚澶寸姸鎬? ${onlineCount} 鍦ㄧ嚎`;
                if (warningCount > 0) statusMessage += `, ${warningCount} 璀﹀憡`;
                if (offlineCount > 0) statusMessage += `, ${offlineCount} 绂荤嚎`;
                
                systemStatus.textContent = statusMessage;
                
                if (offlineCount > 0) {
                    document.getElementById('cameraAlert').style.color = '#dc3545';
                } else {
                    document.getElementById('cameraAlert').style.color = '#ffc107';
                }
            } else {
                systemStatus.textContent = '鐩戞帶绯荤粺杩愯姝ｅ父锛屾墍鏈夋憚鍍忓ご鍦ㄧ嚎';
                document.getElementById('cameraAlert').style.color = '#28a745';
            }
        }

        // 妯℃嫙鎽勫儚澶存帶鍒?        function controlCamera(cameraId, action) {
            console.log(`鎺у埗鎽勫儚澶?#${cameraId}锛屽姩浣? ${action}`);
            
            const cameraItem = document.querySelector(`.camera-item[data-camera-id="${cameraId}"]`);
            if (!cameraItem) return;
            
            // 鏄剧ず鎺у埗鍙嶉锛堥棯鐑佹晥鏋滐級
            const placeholder = cameraItem.querySelector('.camera-placeholder');
            placeholder.style.opacity = '0.7';
            setTimeout(() => {
                placeholder.style.opacity = '1';
            }, 200);
            
            // 鏍规嵁鍔ㄤ綔鎵ц涓嶅悓鐨勬ā鎷熸搷浣?            switch(action) {
                case 'history':
                    // 妯℃嫙鏌ョ湅鍘嗗彶璁板綍
                    showActionFeedback(cameraId, '姝ｅ湪鍔犺浇鍘嗗彶璁板綍');
                    break;
                case 'refresh':
                    // 鍒锋柊鎽勫儚澶?                    showActionFeedback(cameraId, '姝ｅ湪鍒锋柊杩炴帴');
                    break;
            }
        }

        // 鏄剧ず鎽勫儚澶存搷浣滃弽棣?        function showActionFeedback(cameraId, message) {
            const cameraItem = document.querySelector(`.camera-item[data-camera-id="${cameraId}"]`);
            if (!cameraItem) return;
            
            // 鍒涘缓鍙嶉鍏冪礌
            const feedback = document.createElement('div');
            feedback.className = 'camera-feedback';
            feedback.style.position = 'absolute';
            feedback.style.bottom = '10px';
            feedback.style.left = '50%';
            feedback.style.transform = 'translateX(-50%)';
            feedback.style.backgroundColor = 'rgba(0,0,0,0.7)';
            feedback.style.color = 'white';
            feedback.style.padding = '5px 10px';
            feedback.style.borderRadius = '4px';
            feedback.style.fontSize = '12px';
            feedback.style.zIndex = '100';
            feedback.textContent = message;
            
            // 娣诲姞鍒版憚鍍忓ご瑙嗗浘
            const cameraView = cameraItem.querySelector('.camera-view');
            cameraView.appendChild(feedback);
            
            // 2绉掑悗绉婚櫎鍙嶉
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.remove();
                }
            }, 2000);
        }

        // 鏍囩椤靛垏鎹㈠姛鑳?        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // 鏇存柊鏍囩椤电姸鎬?                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // 鏇存柊鍐呭鍖哄煙
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // 濡傛灉鍒囨崲鍒扮洃鎺ф爣绛撅紝鍒濆鍖栫浉搴斿姛鑳?                if (tabId === 'monitor') {
                    // 鍒濆鍖栨憚鍍忓ご鐩戞帶鑰屼笉鏄ˉ姊佺洃鎺?                    initCameraMonitor();
                }
            });
        });

        // 鏂囦欢涓婁紶浜嬩欢
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                const file = this.files[0];
                fileInfo.textContent = `宸查€夋嫨鏂囦欢: ${file.name} (${formatFileSize(file.size)})`;
                uploadButton.disabled = false;
            } else {
                fileInfo.textContent = '鏈€夋嫨鏂囦欢';
                uploadButton.disabled = true;
            }
        });

        // 涓婁紶鎸夐挳浜嬩欢
        uploadButton.addEventListener('click', function() {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const content = e.target.result;
                        // 娣诲姞璋冭瘯淇℃伅
                        console.log("鏂囦欢鍐呭璇诲彇鎴愬姛锛岄暱搴︼細", content.length);
                        processData(content);
                        
                        // 纭繚鏁版嵁澶勭悊鍚庡惎鐢ㄦ娴嬫寜閽?                        if (sensorData.length > 0) {
                            console.log("鎴愬姛鍔犺浇鏁版嵁鐐癸細", sensorData.length);
                            detectButton.disabled = false;
                        } else {
                            console.warn("鏁版嵁澶勭悊瀹屾垚锛屼絾娌℃湁鏈夋晥鏁版嵁鐐?);
                            alert('鏈兘浠庢枃浠朵腑鎻愬彇鏈夋晥鏁版嵁锛岃妫€鏌ユ枃浠舵牸寮?);
                            detectButton.disabled = true;
                        }
                    } catch (error) {
                        console.error('鏁版嵁瑙ｆ瀽閿欒:', error);
                        alert('鏁版嵁瑙ｆ瀽閿欒: ' + error.message);
                    }
                };
                reader.onerror = function(e) {
                    console.error('鏂囦欢璇诲彇閿欒:', e);
                    alert('鏂囦欢璇诲彇閿欒!');
                };
                reader.readAsText(file);
            } else {
                alert('璇峰厛閫夋嫨涓€涓枃浠?');
            }
        });

        // 閲嶇疆鎸夐挳浜嬩欢
        resetButton.addEventListener('click', function() {
            resetAll();
        });

        // 寮€濮嬫娴嬫寜閽簨浠?        detectButton.addEventListener('click', function() {
            console.log("鐐瑰嚮妫€娴嬫寜閽紝褰撳墠鏁版嵁鐐规暟閲?", sensorData.length);
            if (sensorData && sensorData.length > 0) {
                console.log("寮€濮嬪紓甯告娴?..");
                startAnomalyDetection();
            } else {
                console.warn("娌℃湁鏁版嵁鍙緵妫€娴?);
                alert('璇峰厛涓婁紶鏁版嵁!');
            }
        });

        // 鐧诲綍鎸夐挳浜嬩欢
        loginButton.addEventListener('click', handleLogin);

        // 閫€鍑烘寜閽簨浠?        logoutButton.addEventListener('click', handleLogout);

        // 鏀寔鍥炶溅鐧诲綍
        passwordInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                handleLogin();
            }
        });

        // 妯℃嫙寮傚父妫€娴嬭繃绋?        function startAnomalyDetection() {
            noAnalysisMessage.style.display = 'none';
            analysisLoader.style.display = 'block';
            analysisSummary.style.display = 'none';
            anomalyList.innerHTML = '';
            
            // 妯℃嫙寮傚父妫€娴嬪欢杩?            setTimeout(() => {
                // 鎵ц寮傚父妫€娴?                const result = detectAnomalies();
                
                analysisLoader.style.display = 'none';
                analysisSummary.style.display = 'block';
                
                // 鍒涘缓鍥捐〃
                createAnomalyChart();
                
                // 鏇存柊鐩戞帶瑙嗗浘
                initBridgeMonitor();
                
                // 娣诲姞鍒板巻鍙茶褰?                addToDetectionHistory(result);
                
                // 鑷姩鍒囨崲鍒板垎鏋愭爣绛?                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector('.tab[data-tab="analysis"]').classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById('analysis-tab').classList.add('active');
            }, 2000);
        }

        // 澶勭悊涓婁紶鐨勬暟鎹?        function processData(content) {
            try {
                const lines = content.split('\n');
                console.log("鏂囦欢琛屾暟:", lines.length);
                
                sensorData = [];
                
                let validLines = 0;
                let skippedLines = 0;
                
                lines.forEach((line, index) => {
                    if (line.trim() !== '') {
                        const parts = line.split(',');
                        // 淇敼閫昏緫锛屾敮鎸佹洿鐏垫椿鐨勬暟鎹牸寮?                        if (parts.length >= 2) {
                            try {
                                const timestamp = parts[0].trim();
                                const sensorId = parts.length >= 3 ? parts[1].trim() : `浼犳劅鍣?{index+1}`;
                                const valueIndex = parts.length >= 3 ? 2 : 1;
                                const valueStr = parts[valueIndex].trim();
                                const value = parseFloat(valueStr);
                                
                                if (!isNaN(value)) {
                                    sensorData.push({
                                        timestamp: timestamp,
                                        sensorId: sensorId,
                                        value: value,
                                        status: 'normal'
                                    });
                                    validLines++;
                                } else {
                                    console.warn(`绗?{index+1}琛屾暟鍊兼棤鏁? "${valueStr}"`);
                                    skippedLines++;
                                }
                            } catch (e) {
                                console.warn(`瑙ｆ瀽绗?{index+1}琛屾椂鍑洪敊:`, e.message, "琛屽唴瀹?", line);
                                skippedLines++;
                            }
                        } else {
                            console.warn(`绗?{index+1}琛屾牸寮忎笉姝ｇ‘锛岃嚦灏戦渶瑕?涓€? ${line}`);
                            skippedLines++;
                        }
                    }
                });
                
                console.log(`鏁版嵁澶勭悊瀹屾垚: 鏈夋晥琛屾暟=${validLines}, 璺宠繃琛屾暟=${skippedLines}`);
                
                // 纭繚鍗充娇娌℃湁鏁版嵁涔熶笉浼氭姤閿?                if (sensorData.length === 0) {
                    console.warn("娌℃湁鎵惧埌鏈夋晥鏁版嵁");
                }
                
                displayData();
                createChart();
                
            } catch (error) {
                console.error("澶勭悊鏁版嵁鏃跺彂鐢熼敊璇?", error);
                alert("澶勭悊鏁版嵁鏃跺彂鐢熼敊璇? " + error.message);
            }
        }

        // 浼樺寲鏁版嵁鏄剧ず鍑芥暟
        function displayData() {
            if (!sensorData || sensorData.length === 0) {
                noDataMessage.style.display = 'block';
                noChartDataMessage.style.display = 'block';
                return;
            }
            
            // 闅愯棌鏃犳暟鎹彁绀?            noDataMessage.style.display = 'none';
            
            // 娓呯┖琛ㄦ牸
            const tableBody = dataTable.getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            
            // 浣跨敤鏂囨。鐗囨鍑忓皯DOM鎿嶄綔
            const fragment = document.createDocumentFragment();
            
            // 鏄剧ず鏈€鏂扮殑鏁版嵁鐐癸紙涓轰簡鎬ц兘锛屾渶澶氭樉绀?00鏉★級
            const dataToShow = sensorData.slice(-100);
            
            // 鎵归噺鍒涘缓DOM鍏冪礌
            dataToShow.forEach(item => {
                const row = document.createElement('tr');
                
                const timestampCell = document.createElement('td');
                timestampCell.textContent = item.timestamp;
                
                const sensorIdCell = document.createElement('td');
                sensorIdCell.textContent = item.sensorId;
                
                const valueCell = document.createElement('td');
                valueCell.textContent = item.value.toFixed(2);
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                statusBadge.className = `status-badge status-${item.status}`;
                statusBadge.textContent = item.status === 'normal' ? '姝ｅ父' : 
                                         item.status === 'warning' ? '璀﹀憡' : '寮傚父';
                statusCell.appendChild(statusBadge);
                
                row.appendChild(timestampCell);
                row.appendChild(sensorIdCell);
                row.appendChild(valueCell);
                row.appendChild(statusCell);
                
                fragment.appendChild(row);
            });
            
            // 涓€娆℃€ф坊鍔犳墍鏈夎锛屽噺灏戦〉闈㈤噸鎺?            tableBody.appendChild(fragment);
        }

        // 鍒涘缓鍥捐〃
        function createChart() {
            if (sensorData.length > 0) {
                noChartDataMessage.style.display = 'none';
                
                const ctx = document.getElementById('dataChart').getContext('2d');
                
                // 閿€姣佺幇鏈夊浘琛?                if (dataChart) {
                    dataChart.destroy();
                }
                
                // 鎸変紶鎰熷櫒绫诲瀷鍒嗙粍
                const sensorTypes = ['娓╁害', '搴斿彉', '鎸姩', '鍊捐', '鍏朵粬'];
                let datasetsByType = {};
                
                // 鍒濆鍖栨瘡绉嶇被鍨嬬殑鏁版嵁闆?                sensorTypes.forEach(type => {
                    datasetsByType[type] = [];
                });
                
                // 鑾峰彇鍞竴鐨勪紶鎰熷櫒ID
                const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
                
                // 涓烘瘡涓紶鎰熷櫒ID鍒嗛厤涓€绉嶉鑹?                const sensorColors = {};
                const baseColors = [
                    { r: 255, g: 99, b: 132 },   // 绾㈣壊绯?                    { r: 54, g: 162, b: 235 },   // 钃濊壊绯?                    { r: 255, g: 206, b: 86 },   // 榛勮壊绯?                    { r: 75, g: 192, b: 192 },   // 闈掕壊绯?                    { r: 153, g: 102, b: 255 },  // 绱壊绯?                    { r: 255, g: 159, b: 64 },   // 姗欒壊绯?                    { r: 99, g: 255, b: 132 },   // 缁胯壊绯?                    { r: 235, g: 54, b: 162 }    // 绮夎壊绯?                ];
                
                uniqueSensors.forEach((sensorId, index) => {
                    // 寰幆浣跨敤棰滆壊
                    const colorIndex = index % baseColors.length;
                    const baseColor = baseColors[colorIndex];
                    
                    // 绋嶅井璋冩暣棰滆壊锛岀‘淇濆悓涓€浼犳劅鍣ㄧ被鍨嬬殑棰滆壊鐩歌繎浣嗗彲鍖哄垎
                    const variant = Math.floor(index / baseColors.length);
                    const r = Math.max(0, Math.min(255, baseColor.r - variant * 20));
                    const g = Math.max(0, Math.min(255, baseColor.g - variant * 20));
                    const b = Math.max(0, Math.min(255, baseColor.b - variant * 20));
                    
                    sensorColors[sensorId] = {
                        border: `rgba(${r}, ${g}, ${b}, 1)`,
                        background: `rgba(${r}, ${g}, ${b}, 0.1)`
                    };
                });
                
                // 鎸変紶鎰熷櫒ID鍒嗙粍鏁版嵁
                const datasets = [];
                
                uniqueSensors.forEach(sensorId => {
                    // 纭畾浼犳劅鍣ㄧ被鍨?                    let sensorType = '鍏朵粬';
                    if (sensorId.includes('娓╁害')) sensorType = '娓╁害';
                    else if (sensorId.includes('搴斿彉')) sensorType = '搴斿彉';
                    else if (sensorId.includes('鎸姩')) sensorType = '鎸姩';
                    else if (sensorId.includes('鍊捐')) sensorType = '鍊捐';
                    
                    // 鑾峰彇璇ヤ紶鎰熷櫒鐨勬墍鏈夋暟鎹偣
                    const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                    
                    // 涓烘瘡涓紶鎰熷櫒鍒涘缓鏁版嵁闆?                    const dataset = {
                        label: `${sensorType}: ${sensorId}`,
                        data: sensorPoints.map(item => ({
                            x: item.timestamp,
                            y: item.value
                        })),
                        borderColor: sensorColors[sensorId].border,
                        backgroundColor: sensorColors[sensorId].background,
                        borderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        tension: 0.3,
                        fill: false,
                        hidden: false // 榛樿鏄剧ず鎵€鏈変紶鎰熷櫒鏁版嵁
                    };
                    
                    // 灏嗘暟鎹泦娣诲姞鍒板搴旂殑浼犳劅鍣ㄧ被鍨嬬粍
                    datasetsByType[sensorType].push(dataset);
                });
                
                // 鍚堝苟鎵€鏈夋暟鎹泦
                sensorTypes.forEach(type => {
                    if (datasetsByType[type].length > 0) {
                        datasets.push(...datasetsByType[type]);
                    }
                });
                
                // 鍒涘缓鏂板浘琛紝浣跨敤鏁ｇ偣鍥句互鏀寔涓嶅悓鏃堕棿杞寸殑鏁版嵁
                dataChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    boxWidth: 12,
                                    usePointStyle: true,
                                    generateLabels: function(chart) {
                                        // 鐢熸垚鍥句緥鏍囩
                                        const labels = Chart.defaults.plugins.legend.labels.generateLabels(chart);
                                        
                                        // 鎸変紶鎰熷櫒绫诲瀷鍒嗙粍鍥句緥
                                        const groupedLabels = {};
                                        sensorTypes.forEach(type => {
                                            groupedLabels[type] = [];
                                        });
                                        
                                        labels.forEach(label => {
                                            // 浠庢爣绛炬枃鏈腑鎻愬彇浼犳劅鍣ㄧ被鍨?                                            const typeMatch = label.text.match(/^([^:]+):/);
                                            if (typeMatch) {
                                                const type = typeMatch[1].trim();
                                                if (sensorTypes.includes(type)) {
                                                    groupedLabels[type].push(label);
                                                } else {
                                                    groupedLabels['鍏朵粬'].push(label);
                                                }
                                            } else {
                                                groupedLabels['鍏朵粬'].push(label);
                                            }
                                        });
                                        
                                        // 鎵佸钩鍖栧垎缁勫悗鐨勬爣绛?                                        const result = [];
                                        sensorTypes.forEach(type => {
                                            if (groupedLabels[type].length > 0) {
                                                // 娣诲姞绫诲瀷鏍囬锛堜笉鍙偣鍑伙級
                                                result.push({
                                                    text: `${type}浼犳劅鍣╜,
                                                    fillStyle: 'rgba(0,0,0,0.1)',
                                                    strokeStyle: 'rgba(0,0,0,0.1)',
                                                    lineWidth: 0,
                                                    hidden: false,
                                                    index: -1, // 纭繚涓嶄笌瀹為檯鏁版嵁闆嗗啿绐?                                                    isGroup: true
                                                });
                                                result.push(...groupedLabels[type]);
                                            }
                                        });
                                        
                                        return result;
                                    },
                                    onClick: function(e, legendItem, legend) {
                                        if (legendItem.isGroup) return; // 濡傛灉鐐瑰嚮鐨勬槸鍒嗙粍鏍囬锛屼笉鍋氫换浣曟搷浣?                                        
                                        // 榛樿鍥句緥鐐瑰嚮琛屼负
                                        const index = legendItem.datasetIndex;
                                        const ci = legend.chart;
                                        if (ci.isDatasetVisible(index)) {
                                            ci.hide(index);
                                            legendItem.hidden = true;
                                        } else {
                                            ci.show(index);
                                            legendItem.hidden = false;
                                        }
                                    }
                                }
                            },
                            tooltip: {
                                mode: 'nearest',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        const dataset = context.dataset;
                                        const value = context.raw.y;
                                        return `${dataset.label}: ${value.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        scales: {
                            x: {
                                type: 'category',
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            },
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: '浼犳劅鍣ㄥ€?
                                }
                            }
                        }
                    }
                });
                
                // 娣诲姞鎺у埗闈㈡澘锛岀敤浜庢寜浼犳劅鍣ㄧ被鍨嬬瓫閫夋樉绀?                createChartControls(sensorTypes);
            } else {
                noChartDataMessage.style.display = 'block';
            }
        }

        // 鍒涘缓鍥捐〃鎺у埗闈㈡澘
        function createChartControls(sensorTypes) {
            // 妫€鏌ユ槸鍚﹀凡瀛樺湪鎺у埗闈㈡澘
            let controlPanel = document.getElementById('chart-controls');
            if (!controlPanel) {
                controlPanel = document.createElement('div');
                controlPanel.id = 'chart-controls';
                controlPanel.className = 'chart-controls';
                controlPanel.style.marginBottom = '15px';
                controlPanel.style.display = 'flex';
                controlPanel.style.flexWrap = 'wrap';
                controlPanel.style.gap = '10px';
                
                const chartContainer = document.getElementById('chart-container');
                chartContainer.insertBefore(controlPanel, document.getElementById('dataChart').parentNode);
            } else {
                controlPanel.innerHTML = ''; // 娓呯┖鐜版湁鎺т欢
            }
            
            // 娣诲姞"鍏ㄩ儴鏄剧ず"鎸夐挳
            const showAllBtn = document.createElement('button');
            showAllBtn.textContent = '鏄剧ず鍏ㄩ儴';
            showAllBtn.className = 'chart-control-btn active';
            showAllBtn.style.padding = '5px 10px';
            showAllBtn.style.backgroundColor = '#4299e1';
            showAllBtn.style.color = 'white';
            showAllBtn.style.border = '1px solid #3182ce';
            showAllBtn.style.borderRadius = '4px';
            showAllBtn.style.cursor = 'pointer';
            
            showAllBtn.addEventListener('click', function() {
                if (dataChart) {
                    dataChart.data.datasets.forEach((dataset, index) => {
                        dataChart.setDatasetVisibility(index, true);
                    });
                    dataChart.update();
                    
                    // 鏇存柊鎸夐挳鐘舵€?                    document.querySelectorAll('.chart-control-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
            
            controlPanel.appendChild(showAllBtn);
            
            // 涓烘瘡绉嶄紶鎰熷櫒绫诲瀷娣诲姞绛涢€夋寜閽?            sensorTypes.forEach(type => {
                const button = document.createElement('button');
                button.textContent = `${type}浼犳劅鍣╜;
                button.className = 'chart-control-btn';
                button.style.padding = '5px 10px';
                button.style.backgroundColor = '#e2e8f0';
                button.style.border = '1px solid #cbd5e0';
                button.style.borderRadius = '4px';
                button.style.cursor = 'pointer';
                
                button.addEventListener('click', function() {
                    if (dataChart) {
                        // 闅愯棌鎵€鏈夋暟鎹泦
                        dataChart.data.datasets.forEach((dataset, index) => {
                            const isCurrentType = dataset.label.startsWith(`${type}:`);
                            dataChart.setDatasetVisibility(index, isCurrentType);
                        });
                        dataChart.update();
                        
                        // 鏇存柊鎸夐挳鐘舵€?                        document.querySelectorAll('.chart-control-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        this.classList.add('active');
                    }
                });
                
                controlPanel.appendChild(button);
            });
            
            // 娣诲姞CSS鏍峰紡
            const style = document.createElement('style');
            style.textContent = `
                .chart-control-btn {
                    transition: all 0.2s ease;
                }
                .chart-control-btn:hover {
                    opacity: 0.9;
                }
                .chart-control-btn.active {
                    background-color: #4299e1 !important;
                    color: white !important;
                    border-color: #3182ce !important;
                }
            `;
            document.head.appendChild(style);
        }

        // 鍒涘缓寮傚父妫€娴嬪浘琛?        function createAnomalyChart() {
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            
            // 閿€姣佺幇鏈夊浘琛?            if (anomalyChart) {
                anomalyChart.destroy();
            }
            
            // 鍑嗗鍥捐〃鏁版嵁
            const labels = Array.from({ length: zScores.length }, (_, i) => i + 1);
            
            // 鍒涘缓Z-score鏁版嵁闆?            const datasets = [
                {
                    label: 'Z-Score',
                    data: zScores,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderWidth: 2,
                    pointRadius: 3
                }
            ];
            
            // 娣诲姞寮傚父鐐规暟鎹泦
            if (anomalyIndices.length > 0) {
                // 鍦╖-Score鏇茬嚎涓婃爣璁板嚭寮傚父鐐?                const anomalyData = zScores.map((z, i) => anomalyIndices.includes(i) ? z : null);
                
                datasets.push({
                    label: '鍗曠偣寮傚父',
                    data: anomalyIndices.filter(i => anomalyTypes[i] === '鍗曠偣寮傚父').map(i => zScores[i]),
                    pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false,
                    pointStyle: 'circle'
                });
                
                datasets.push({
                    label: '杩炵画鎬у紓甯?,
                    data: anomalyIndices.filter(i => anomalyTypes[i] === '杩炵画鎬у紓甯?).map(i => zScores[i]),
                    pointBackgroundColor: 'rgba(255, 159, 64, 1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false,
                    pointStyle: 'triangle'
                });
                
                datasets.push({
                    label: '缇や綋寮傚父',
                    data: anomalyIndices.filter(i => anomalyTypes[i] === '缇や綋寮傚父').map(i => zScores[i]),
                    pointBackgroundColor: 'rgba(153, 102, 255, 1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false,
                    pointStyle: 'rect'
                });
            }
            
            // 鍒涘缓鍥捐〃
            anomalyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true
                            }
                        },
                        annotation: {
                            annotations: {
                                anomalyThreshold: {
                                    type: 'line',
                                    yMin: 2,
                                    yMax: 2,
                                    borderColor: 'rgba(255, 0, 0, 0.5)',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        display: true,
                                        content: '寮傚父闃堝€?(Z-score = 2)',
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: '鏁版嵁鐐?
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Z-Score'
                            }
                        }
                    }
                }
            });
            
            // 濡傛灉姝ｅ湪妯℃嫙浜嬩欢锛屾坊鍔犱簨浠跺尯鍩熸敞閲?            if (currentEventSimulation && currentEventSimulation !== bridgeEvents.NORMAL) {
                const eventName = eventSettings[currentEventSimulation].name;
                
                anomalyChart.options.plugins.annotation.annotations.eventRegion = {
                    type: 'box',
                    xMin: 0,
                    xMax: anomalyChart.data.labels.length - 1,
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    borderColor: 'rgba(255, 99, 132, 0.3)',
                    borderWidth: 1,
                    label: {
                        display: true,
                        content: `${eventName} 褰卞搷鍖哄煙`,
                        position: 'start'
                    }
                };
                
                anomalyChart.update();
            }
        }

        // 妫€娴嬪紓甯?        function detectAnomalies() {
            if (!sensorData || sensorData.length === 0) {
                console.warn("娌℃湁鏁版嵁鍙緵妫€娴?);
                return {
                    totalPoints: 0,
                    anomalyCount: 0,
                    singlePointCount: 0,
                    continuousCount: 0,
                    clusterCount: 0,
                    anomalies: {}
                };
            }
            
            // 鎸変紶鎰熷櫒鍒嗙粍鏁版嵁
            const sensorGroups = {};
            
            sensorData.forEach(item => {
                if (!sensorGroups[item.sensorId]) {
                    sensorGroups[item.sensorId] = [];
                }
                sensorGroups[item.sensorId].push(item);
            });
            
            // 鐢ㄤ簬瀛樺偍姣忎釜浼犳劅鍣ㄧ殑寮傚父锛堟寜绫诲瀷鍒嗙被锛?            const anomaliesBySensor = {};
            
            // 鐢ㄤ簬Z-score鍥捐〃鏁版嵁
            zScores = [];
            anomalyIndices = [];
            anomalyTypes = [];
            
            // 缁熻鏁版嵁
            let totalDataPoints = 0;
            let totalAnomalies = 0;
            let singlePoints = 0;
            let continuousAnomalies = 0;
            let clusterAnomalies = 0;
            
            // 瀵规瘡涓紶鎰熷櫒杩涜寮傚父妫€娴?            for (const sensorId in sensorGroups) {
                const sensorDataPoints = sensorGroups[sensorId];
                
                // 璺宠繃鏁版嵁閲忓お灏戠殑浼犳劅鍣?                if (sensorDataPoints.length < 5) continue;
                
                // 璁板綍鎬绘暟鎹偣鏁?                totalDataPoints += sensorDataPoints.length;
                
                // 鎻愬彇鏁板€兼暟缁?                const values = sensorDataPoints.map(item => item.value);
                
                // 璁＄畻鍩烘湰缁熻閲?                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                
                // 璁＄畻鏍囧噯宸?                const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;
                const stddev = Math.sqrt(variance);
                
                // 濡傛灉鏍囧噯宸繃灏忥紝鍙兘琛ㄧず鏁版嵁鍑犱箮娌℃湁娉㈠姩锛岃繖绉嶆儏鍐典笅寮傚父妫€娴嬪彲鑳戒笉閫傜敤
                if (stddev < 0.001) continue;
                
                // 璁＄畻Z-score
                const zScoreThreshold = 2.0; // 鏍囧噯璁剧疆涓?锛屽搴旂害5%鐨勫紓甯哥巼
                const zScoreValues = values.map(value => Math.abs((value - mean) / stddev));
                
                // 娣诲姞鍒癦-score闆嗗悎鐢ㄤ簬鍥捐〃
                zScores = zScores.concat(zScoreValues);
                
                // 妫€娴嬪紓甯?                const currentSensorAnomalies = [];
                
                // 鍒ゆ柇浼犳劅鍣ㄧ被鍨?                let sensorType = '鍏朵粬';
                if (sensorId.includes('娓╁害')) sensorType = '娓╁害';
                else if (sensorId.includes('搴斿彉')) sensorType = '搴斿彉';
                else if (sensorId.includes('鎸姩')) sensorType = '鎸姩';
                else if (sensorId.includes('鍊捐')) sensorType = '鍊捐';
                
                // 鍗曠偣寮傚父妫€娴?                zScoreValues.forEach((zScore, index) => {
                    if (zScore > zScoreThreshold) {
                        // 纭畾寮傚父绫诲瀷
                        let anomalyType = '鍗曠偣寮傚父';
                        
                        // 妫€鏌ユ槸鍚﹁繛缁紓甯?                        if (index > 0 && index < zScoreValues.length - 1) {
                            if (zScoreValues[index-1] > zScoreThreshold || zScoreValues[index+1] > zScoreThreshold) {
                                anomalyType = '杩炵画鎬у紓甯?;
                            }
                        }
                        
                        // 娣诲姞寮傚父璁板綍
                        const dataPoint = sensorDataPoints[index];
                        currentSensorAnomalies.push({
                            sensorId: sensorId,
                            sensorType: sensorType,
                            timestamp: dataPoint.timestamp,
                            value: dataPoint.value,
                            zScore: zScore,
                            mean: mean,
                            stddev: stddev,
                            type: anomalyType
                        });
                        
                        // 娣诲姞鍒板叏灞€anomalyIndices鐢ㄤ簬鍥捐〃
                        anomalyIndices.push(zScores.length - zScoreValues.length + index);
                        anomalyTypes.push(anomalyType);
                        
                        // 缁熻璁℃暟
                        totalAnomalies++;
                        if (anomalyType === '鍗曠偣寮傚父') {
                            singlePoints++;
                        } else if (anomalyType === '杩炵画鎬у紓甯?) {
                            continuousAnomalies++;
                        }
                    }
                });
                
                // 缇や綋寮傚父妫€娴嬶紙浣跨敤婊戝姩绐楀彛妫€娴嬪紓甯搁泦缇わ級
                const windowSize = 5; // 婊戝姩绐楀彛澶у皬
                for (let i = 0; i <= zScoreValues.length - windowSize; i++) {
                    const window = zScoreValues.slice(i, i + windowSize);
                    const windowMean = window.reduce((a, b) => a + b, 0) / windowSize;
                    
                    // 濡傛灉绐楀彛鍐呭钩鍧嘮-score瓒呰繃闃堝€硷紙浣嗕笉鏄洜涓哄崟涓瀬绔€煎紩璧风殑锛?                    if (windowMean > zScoreThreshold * 0.7 && window.filter(z => z > zScoreThreshold).length >= 2) {
                        // 妫€鏌ヨ繖涓獥鍙ｆ槸鍚﹀凡缁忓寘鍚簡鏍囪涓鸿繛缁€у紓甯哥殑鐐?                        const hasMarkedAnomaly = window.some((_, idx) => {
                            const globalIdx = zScores.length - zScoreValues.length + i + idx;
                            return anomalyIndices.includes(globalIdx);
                        });
                        
                        // 濡傛灉杩欎釜绐楀彛娌℃湁琚爣璁拌繃锛屽垯鏍囪涓虹兢浣撳紓甯?                        if (!hasMarkedAnomaly) {
                            // 鍙栫獥鍙ｄ腑闂寸偣浣滀负浠ｈ〃
                            const midIdx = i + Math.floor(windowSize / 2);
                            const dataPoint = sensorDataPoints[midIdx];
                            
                            currentSensorAnomalies.push({
                                sensorId: sensorId,
                                sensorType: sensorType,
                                timestamp: dataPoint.timestamp,
                                value: dataPoint.value,
                                zScore: zScoreValues[midIdx],
                                mean: mean,
                                stddev: stddev,
                                type: '缇や綋寮傚父'
                            });
                            
                            // 娣诲姞鍒板叏灞€indices
                            anomalyIndices.push(zScores.length - zScoreValues.length + midIdx);
                            anomalyTypes.push('缇や綋寮傚父');
                            
                            // 缁熻
                            totalAnomalies++;
                            clusterAnomalies++;
                        }
                    }
                }
                
                // 淇濆瓨褰撳墠浼犳劅鍣ㄧ殑寮傚父
                if (currentSensorAnomalies.length > 0) {
                    anomaliesBySensor[sensorId] = currentSensorAnomalies;
                }
            }
            
            // 杩斿洖妫€娴嬬粨鏋?            return {
                totalPoints: totalDataPoints,
                anomalyCount: totalAnomalies,
                singlePointCount: singlePoints,
                continuousCount: continuousAnomalies,
                clusterCount: clusterAnomalies,
                anomalies: anomaliesBySensor
            };
        }

        // 鐢熸垚鎸変紶鎰熷櫒绫诲瀷鍒嗙粍鐨勫紓甯稿垪琛?        function generateAnomalyList(anomaliesByType, sensorTypes) {
            anomalyList.innerHTML = '';  // 纭繚娓呯┖涔嬪墠鐨勫垪琛?            
            const totalAnomalies = Object.values(anomaliesByType).reduce((sum, arr) => sum + arr.length, 0);
            
            if (totalAnomalies > 0) {
                // 鍒涘缓绫诲瀷閫夋嫨鍣?                const typeSelector = document.createElement('div');
                typeSelector.className = 'anomaly-type-selector';
                typeSelector.style.marginBottom = '15px';
                typeSelector.style.display = 'flex';
                typeSelector.style.flexWrap = 'wrap';
                typeSelector.style.gap = '8px';
                
                // 娣诲姞"鍏ㄩ儴"閫夐」
                const allTypesBtn = document.createElement('button');
                allTypesBtn.textContent = '鍏ㄩ儴寮傚父';
                allTypesBtn.className = 'anomaly-type-btn active';
                allTypesBtn.dataset.type = 'all';
                allTypesBtn.style.padding = '5px 12px';
                allTypesBtn.style.backgroundColor = '#4299e1';
                allTypesBtn.style.color = 'white';
                allTypesBtn.style.border = 'none';
                allTypesBtn.style.borderRadius = '4px';
                allTypesBtn.style.cursor = 'pointer';
                typeSelector.appendChild(allTypesBtn);
                
                // 涓烘瘡绉嶄紶鎰熷櫒绫诲瀷娣诲姞鎸夐挳
                sensorTypes.forEach(type => {
                    if (anomaliesByType[type].length > 0) {
                        const button = document.createElement('button');
                        button.textContent = `${type}浼犳劅鍣?(${anomaliesByType[type].length})`;
                        button.className = 'anomaly-type-btn';
                        button.dataset.type = type;
                        button.style.padding = '5px 12px';
                        button.style.backgroundColor = '#e2e8f0';
                        button.style.border = 'none';
                        button.style.borderRadius = '4px';
                        button.style.cursor = 'pointer';
                        typeSelector.appendChild(button);
                    }
                });
                
                // 娣诲姞鎸夐挳浜嬩欢鐩戝惉
                typeSelector.addEventListener('click', function(e) {
                    if (e.target.classList.contains('anomaly-type-btn')) {
                        // 鏇存柊鎸夐挳鐘舵€?                        document.querySelectorAll('.anomaly-type-btn').forEach(btn => {
                            btn.classList.remove('active');
                            btn.style.backgroundColor = '#e2e8f0';
                            btn.style.color = 'black';
                        });
                        e.target.classList.add('active');
                        e.target.style.backgroundColor = '#4299e1';
                        e.target.style.color = 'white';
                        
                        // 鏄剧ず鐩稿簲绫诲瀷鐨勫紓甯?                        const type = e.target.dataset.type;
                        showAnomaliesByType(type, anomaliesByType, sensorTypes);
                    }
                });
                
                // 娣诲姞绫诲瀷閫夋嫨鍣ㄥ埌寮傚父鍒楄〃鍓?                anomalyList.parentNode.insertBefore(typeSelector, anomalyList);
                
                // 榛樿鏄剧ず鎵€鏈夊紓甯?                showAnomaliesByType('all', anomaliesByType, sensorTypes);
            } else {
                // 濡傛灉娌℃湁寮傚父锛屾樉绀轰竴鏉′俊鎭?                const noAnomalyItem = document.createElement('li');
                noAnomalyItem.textContent = '鏈娴嬪埌浠讳綍寮傚父鏁版嵁鐐?;
                noAnomalyItem.style.textAlign = 'center';
                noAnomalyItem.style.color = '#28a745';
                anomalyList.appendChild(noAnomalyItem);
            }
        }

        // 鏄剧ず鎸囧畾绫诲瀷鐨勫紓甯?        function showAnomaliesByType(type, anomaliesByType, sensorTypes) {
            anomalyList.innerHTML = '';
            
            let anomaliesToShow = [];
            
            if (type === 'all') {
                // 鏄剧ず鎵€鏈夌被鍨嬬殑寮傚父
                sensorTypes.forEach(t => {
                    if (anomaliesByType[t].length > 0) {
                        anomaliesToShow = anomaliesToShow.concat(anomaliesByType[t]);
                    }
                });
            } else {
                // 鏄剧ず鐗瑰畾绫诲瀷鐨勫紓甯?                anomaliesToShow = anomaliesByType[type];
            }
            
            // 鎸変弗閲嶇▼搴︽帓搴忥紙Z-score闄嶅簭锛?            anomaliesToShow.sort((a, b) => b.zScore - a.zScore);
            
            // 鏄剧ず寮傚父鍒楄〃
            anomaliesToShow.forEach(anomaly => {
                const listItem = document.createElement('li');
                listItem.classList.add('anomaly-item');
                
                if (anomaly.zScore > 3.0) {
                    listItem.classList.add('severe');
                }
                
                // 鑾峰彇浼犳劅鍣ㄧ被鍨嬪搴旂殑鍗曚綅
                let unit = '';
                if (anomaly.sensorType === '娓╁害') unit = '掳C';
                else if (anomaly.sensorType === '搴斿彉') unit = '渭蔚';
                else if (anomaly.sensorType === '鎸姩') unit = 'Hz';
                else if (anomaly.sensorType === '鍊捐') unit = '掳';
                
                listItem.innerHTML = `
                    <strong>鏃堕棿:</strong> ${anomaly.timestamp} | 
                    <strong>浼犳劅鍣?</strong> <span class="sensor-type">${anomaly.sensorType}</span>: ${anomaly.sensorId} | 
                    <strong>鏁板€?</strong> ${anomaly.value.toFixed(2)}${unit} | 
                    <strong>Z寰楀垎:</strong> ${anomaly.zScore.toFixed(2)} | 
                    <strong>绫诲瀷:</strong> ${anomaly.type}
                `;
                
                // 涓轰笉鍚屼紶鎰熷櫒绫诲瀷娣诲姞涓嶅悓鐨勯鑹叉爣璁?                const sensorTypeSpan = listItem.querySelector('.sensor-type');
                if (sensorTypeSpan) {
                    if (anomaly.sensorType === '娓╁害') {
                        sensorTypeSpan.style.color = '#e53e3e';
                    } else if (anomaly.sensorType === '搴斿彉') {
                        sensorTypeSpan.style.color = '#3182ce';
                    } else if (anomaly.sensorType === '鎸姩') {
                        sensorTypeSpan.style.color = '#805ad5';
                    } else if (anomaly.sensorType === '鍊捐') {
                        sensorTypeSpan.style.color = '#dd6b20';
                    }
                }
                
                anomalyList.appendChild(listItem);
            });
            
            // 濡傛灉绛涢€夊悗娌℃湁寮傚父锛屾樉绀烘彁绀?            if (anomaliesToShow.length === 0) {
                const noFilteredItem = document.createElement('li');
                noFilteredItem.textContent = `鏈娴嬪埌${type}浼犳劅鍣ㄧ殑寮傚父鏁版嵁鐐筦;
                noFilteredItem.style.textAlign = 'center';
                noFilteredItem.style.color = '#718096';
                anomalyList.appendChild(noFilteredItem);
            }
        }

        // 鍒涘缓寮傚父鍥捐〃鎺у埗闈㈡澘
        function createAnomalyChartControls(sensorTypes, anomaliesByType, chart) {
            // 妫€鏌ユ槸鍚﹀凡瀛樺湪鎺у埗闈㈡澘
            let controlPanel = document.getElementById('anomaly-chart-controls');
            if (!controlPanel) {
                controlPanel = document.createElement('div');
                controlPanel.id = 'anomaly-chart-controls';
                controlPanel.className = 'chart-controls';
                controlPanel.style.marginBottom = '15px';
                controlPanel.style.display = 'flex';
                controlPanel.style.flexWrap = 'wrap';
                controlPanel.style.gap = '10px';
                
                const chartContainer = document.getElementById('anomaly-chart-container');
                chartContainer.insertBefore(controlPanel, document.getElementById('anomalyChart'));
            } else {
                controlPanel.innerHTML = ''; // 娓呯┖鐜版湁鎺т欢
            }
            
            // 娣诲姞"鍏ㄩ儴鏄剧ず"鎸夐挳
            const showAllBtn = document.createElement('button');
            showAllBtn.textContent = '鏄剧ず鍏ㄩ儴';
            showAllBtn.className = 'chart-control-btn active';
            showAllBtn.style.padding = '5px 10px';
            showAllBtn.style.backgroundColor = '#4299e1';
            showAllBtn.style.color = 'white';
            showAllBtn.style.border = '1px solid #3182ce';
            showAllBtn.style.borderRadius = '4px';
            showAllBtn.style.cursor = 'pointer';
            
            showAllBtn.addEventListener('click', function() {
                if (chart) {
                    chart.data.datasets.forEach((dataset, index) => {
                        chart.setDatasetVisibility(index, true);
                    });
                    chart.update();
                    
                    // 鏇存柊鎸夐挳鐘舵€?                    document.querySelectorAll('#anomaly-chart-controls .chart-control-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
            
            controlPanel.appendChild(showAllBtn);
            
            // 涓烘瘡绉嶄紶鎰熷櫒绫诲瀷娣诲姞绛涢€夋寜閽?            sensorTypes.forEach(type => {
                if (anomaliesByType[type].length > 0) {
                    const button = document.createElement('button');
                    button.textContent = `${type}浼犳劅鍣?(${anomaliesByType[type].length})`;
                    button.className = 'chart-control-btn';
                    button.style.padding = '5px 10px';
                    button.style.backgroundColor = '#e2e8f0';
                    button.style.border = '1px solid #cbd5e0';
                    button.style.borderRadius = '4px';
                    button.style.cursor = 'pointer';
                    
                    button.addEventListener('click', function() {
                        if (chart) {
                            // 闅愯棌鎵€鏈夋暟鎹泦
                            chart.data.datasets.forEach((dataset, index) => {
                                const isCurrentType = dataset.label.includes(`${type}:`);
                                chart.setDatasetVisibility(index, isCurrentType);
                            });
                            chart.update();
                            
                            // 鏇存柊鎸夐挳鐘舵€?                            document.querySelectorAll('#anomaly-chart-controls .chart-control-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            this.classList.add('active');
                        }
                    });
                    
                    controlPanel.appendChild(button);
                }
            });
        }

        // 閲嶇疆鎵€鏈夋暟鎹拰鐘舵€?        function resetAll() {
            // 閲嶇疆鏁版嵁
            sensorData = [];
            
            // 閲嶇疆鏂囦欢杈撳叆
            fileInput.value = '';
            fileInfo.textContent = '鏈€夋嫨鏂囦欢';
            uploadButton.disabled = true;  // 纭繚妫€娴嬫寜閽垵濮嬬姸鎬佷负绂佺敤
            
            // 娓呴櫎琛ㄦ牸鏁版嵁
            const tableBody = dataTable.getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            noDataMessage.style.display = 'block';
            
            // 娓呴櫎鍥捐〃
            if (dataChart) {
                dataChart.destroy();
                dataChart = null;
            }
            noChartDataMessage.style.display = 'block';
            
            // 娓呴櫎寮傚父鍒嗘瀽缁撴灉
            noAnalysisMessage.style.display = 'block';
            analysisLoader.style.display = 'none';
            analysisSummary.style.display = 'none';
            anomalyList.innerHTML = '';
            
            // 闅愯棌妗ユ鐩戞帶
            noMonitorMessage.style.display = 'block';
            
            // 鍋滄鏁版嵁鏇存柊
            stopDataUpdates();
            
            // 鍒囨崲鍒版暟鎹煡鐪嬫爣绛?            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="data"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('data-tab').classList.add('active');
        }

        // 鏍煎紡鍖栨枃浠跺ぇ灏?        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // 鐢熸垚绀轰緥鏁版嵁
        function createSampleData() {
            console.log("寮€濮嬬敓鎴愭牱鏈暟鎹?);
            
            // 鏄剧ず鍔犺浇鐘舵€?            const fileInfoElement = document.getElementById('fileInfo');
            if (fileInfoElement) {
                fileInfoElement.textContent = '姝ｅ湪鐢熸垚绀轰緥鏁版嵁...';
            }
            
            // 绂佺敤鎸夐挳闃叉閲嶅鐐瑰嚮
            const sampleBtnElement = document.getElementById('sampleButton');
            if (sampleBtnElement) {
                sampleBtnElement.disabled = true;
            }
            
            // 閲嶇疆鏁版嵁
            sensorData = [];
            
            // 妫€鏌ヨ〃鏍煎厓绱犳槸鍚﹀瓨鍦?            const dataTable = document.getElementById('sensorDataTable');
            if (dataTable && dataTable.querySelector('tbody')) {
                dataTable.querySelector('tbody').innerHTML = '<tr><td colspan="5" class="text-center">姝ｅ湪鐢熸垚鏁版嵁锛岃绋嶅€?..</td></tr>';
            }
            
            // 瀹氫箟浼犳劅鍣ㄧ被鍨嬪拰浣嶇疆
            const sensorTypes = [
                { type: '娓╁害', count: 15, unit: '掳C' },
                { type: '搴斿彉', count: 15, unit: '渭蔚' },
                { type: '鎸姩', count: 15, unit: 'Hz' },
                { type: '鍊捐', count: 10, unit: '掳' },
                { type: '浣嶇Щ', count: 10, unit: 'mm' },
                { type: '鍔犻€熷害', count: 10, unit: 'm/s虏' },
                { type: '杞介噸', count: 5, unit: 'kN' },
                { type: '椋庨€?, count: 5, unit: 'm/s' },
                { type: '鍘嬪姏', count: 5, unit: 'kPa' },
                { type: '婀垮害', count: 5, unit: '%' }
            ];
            
            const sections = ['鍖楁', '涓', '鍗楁', '涓滄', '瑗挎', '鏀拺缁撴瀯', '杩炴帴閮ㄤ綅'];
            const positions = ['妗ラ潰', '妗ュⅸ', '妗ュ', '鍚婄储', '鏀骇', '浼哥缉缂?, '浜ら€氱洃鎺?];
            
            // 寮傛澶勭悊閬垮厤鐣岄潰鍐荤粨
            setTimeout(function() {
                try {
                    // 鍒涘缓浼犳劅鍣ㄦ暟鎹?                    let sensorId = 1;
                    
                    // 涓烘瘡绉嶄紶鎰熷櫒绫诲瀷鐢熸垚鏍锋湰鏁版嵁
                    sensorTypes.forEach(sensor => {
                        for (let i = 0; i < sensor.count; i++) {
                            const section = sections[Math.floor(Math.random() * sections.length)];
                            const position = positions[Math.floor(Math.random() * positions.length)];
                            const sensorName = `${sensor.type}-${section}-${position}-${sensorId.toString().padStart(3, '0')}`;
                            
                            // 鏍规嵁浼犳劅鍣ㄧ被鍨嬬‘瀹氬熀鍑嗗€煎拰鑼冨洿
                            let baseValue, minValue, maxValue, warningThreshold, alarmThreshold;
                            
                            switch(sensor.type) {
                                case '娓╁害':
                                    baseValue = 25;
                                    minValue = 5;
                                    maxValue = 55;
                                    warningThreshold = 40;
                                    alarmThreshold = 45;
                                    break;
                                case '搴斿彉':
                                    baseValue = 200;
                                    minValue = 50;
                                    maxValue = 400;
                                    warningThreshold = 300;
                                    alarmThreshold = 350;
                                    break;
                                case '鎸姩':
                                    baseValue = 0.5;
                                    minValue = 0.05;
                                    maxValue = 3.0;
                                    warningThreshold = 1.5;
                                    alarmThreshold = 2.0;
                                    break;
                                case '鍊捐':
                                    baseValue = 0.5;
                                    minValue = 0;
                                    maxValue = 3.0;
                                    warningThreshold = 1.5;
                                    alarmThreshold = 2.0;
                                    break;
                                case '浣嶇Щ':
                                    baseValue = 5;
                                    minValue = 0;
                                    maxValue = 30;
                                    warningThreshold = 15;
                                    alarmThreshold = 20;
                                    break;
                                case '鍔犻€熷害':
                                    baseValue = 0.2;
                                    minValue = 0;
                                    maxValue = 1.5;
                                    warningThreshold = 0.8;
                                    alarmThreshold = 1.0;
                                    break;
                                case '杞介噸':
                                    baseValue = 1000;
                                    minValue = 0;
                                    maxValue = 3000;
                                    warningThreshold = 2000;
                                    alarmThreshold = 2500;
                                    break;
                                case '椋庨€?:
                                    baseValue = 5;
                                    minValue = 0;
                                    maxValue = 30;
                                    warningThreshold = 18;
                                    alarmThreshold = 25;
                                    break;
                                case '鍘嬪姏':
                                    baseValue = 100;
                                    minValue = 50;
                                    maxValue = 200;
                                    warningThreshold = 160;
                                    alarmThreshold = 180;
                                    break;
                                case '婀垮害':
                                    baseValue = 60;
                                    minValue = 20;
                                    maxValue = 95;
                                    warningThreshold = 85;
                                    alarmThreshold = 90;
                                    break;
                                default:
                                    baseValue = 50;
                                    minValue = 0;
                                    maxValue = 100;
                                    warningThreshold = 80;
                                    alarmThreshold = 90;
                            }
                            
                            // 鍒涘缓鏃堕棿鎴筹紝姣忓崐灏忔椂涓€涓暟鎹偣锛屾渶澶氬垱寤?2灏忔椂鐨勬暟鎹紙24涓偣锛?                            const now = new Date();
                            const timestamps = [];
                            for (let t = 0; t < 24; t++) {
                                const timestamp = new Date(now.getTime() - (t * 30 * 60000));
                                timestamps.push(timestamp.toLocaleString('zh-CN', {
                                    year: 'numeric',
                                    month: '2-digit',
                                    day: '2-digit',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                }));
                            }
                            
                            // 鐢熸垚鏁版嵁鐐?                            for (let j = 0; j < timestamps.length; j++) {
                                // 涓轰簡妯℃嫙鐪熷疄鏁版嵁锛屾牴鎹煇绉嶆ā寮忕敓鎴愭暟鎹€?                                let value;
                                if (sensor.type === '娓╁害') {
                                    // 娓╁害闅忔椂闂村憟鐜版寮︽尝鍔?                                    const hour = new Date(timestamps[j]).getHours();
                                    value = baseValue + 5 * Math.sin((hour / 24) * Math.PI * 2) + (Math.random() * 3 - 1.5);
                                } else if (sensor.type === '椋庨€?) {
                                    // 椋庨€熷湪鐧藉ぉ杈冨ぇ
                                    const hour = new Date(timestamps[j]).getHours();
                                    value = baseValue + 3 * Math.sin((hour / 24) * Math.PI) + (Math.random() * 2);
                                } else if (sensor.type === '杞介噸') {
                                    // 杞介噸鍦ㄤ氦閫氶珮宄版湡杈冨ぇ
                                    const hour = new Date(timestamps[j]).getHours();
                                    const trafficPeak = (hour >= 7 && hour <= 9) || (hour >= 17 && hour <= 19);
                                    value = baseValue + (trafficPeak ? 800 : 200) * Math.random();
                                } else {
                                    // 鍏朵粬浼犳劅鍣ㄦ暟鎹熀浜庨殢鏈烘尝鍔?                                    value = baseValue + (Math.random() * 2 - 1) * (maxValue - minValue) * 0.2;
                                }
                                
                                // 寮傚父姒傜巼
                                if (Math.random() < 0.2) { // 澧炲姞鍒?0%鐨勫紓甯告鐜?                                    // 鐢熸垚寮傚父鏁版嵁
                                    const anomalyDirection = Math.random() > 0.5 ? 1 : -1;
                                    const anomalyMagnitude = (Math.random() * 0.4 + 0.1) * (maxValue - minValue);
                                    value += anomalyDirection * anomalyMagnitude;
                                }
                                
                                // 纭繚鍊煎湪鍚堢悊鑼冨洿鍐?                                value = Math.max(minValue, Math.min(maxValue, value));
                                
                                // 纭畾浼犳劅鍣ㄧ姸鎬?                                let status = 'normal';
                                if (value > warningThreshold && value < alarmThreshold) {
                                    status = 'warning';
                                } else if (value > alarmThreshold || value < minValue) {
                                    status = 'danger';
                                }
                                
                                // 娣诲姞鍒版暟鎹泦
                                sensorData.push({
                                    timestamp: timestamps[j],
                                    sensorId: sensorName,
                                    value: parseFloat(value.toFixed(2)),
                                    status: status,
                                    sensorType: sensor.type,
                                    location: section,
                                    position: position,
                                    unit: sensor.unit
                                });
                            }
                            
                            sensorId++;
                        }
                    });
                    
                    // 鏇存柊UI
                    displayData();
                    
                    // 濡傛灉鍑芥暟瀛樺湪鍒欒皟鐢?                    if (typeof createChart === 'function') {
                        createChart();
                    }
                    
                    // 鍒濆鍖栨ˉ姊佺姸鎬?                    if (typeof initBridgeMonitor === 'function') {
                        initBridgeMonitor();
                    }
                    
                    // 鍒濆鍖栦簨浠堕娴?                    if (typeof initializeEventPredictions === 'function') {
                        initializeEventPredictions();
                    } else {
                        console.warn("initializeEventPredictions 鍑芥暟涓嶅瓨鍦?);
                    }
                    
                    // 浣挎娴嬫寜閽彲鐢?                    const detectBtn = document.getElementById('detectButton');
                    if (detectBtn) {
                        detectBtn.disabled = false;
                    }
                    
                } catch (error) {
                    console.error("鐢熸垚绀轰緥鏁版嵁鏃跺嚭閿?", error);
                    if (fileInfoElement) {
                        fileInfoElement.textContent = `鐢熸垚绀轰緥鏁版嵁澶辫触: ${error.message}`;
                    }
                } finally {
                    // 閲嶆柊鍚敤鎸夐挳
                    const sampleBtn = document.getElementById('sampleButton');
                    if (sampleBtn) {
                        sampleBtn.disabled = false;
                    }
                }
            }, 10);
        }

        // 鐢熸垚骞朵笅杞界ず渚嬫枃浠?        function generateExampleFile() {
            // 闃绘榛樿閾炬帴鐐瑰嚮琛屼负
            event.preventDefault();
            
            // 鐢熸垚绀轰緥鏁版嵁
            const exampleData = [];
            const now = new Date();
            
            // 娣诲姞琛ㄥご
            exampleData.push("鏃堕棿鎴?浼犳劅鍣↖D,鏁板€?);
            
            // 娣诲姞娓╁害浼犳劅鍣ㄦ暟鎹ず渚?            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(now.getTime() - (19-i) * 30 * 60 * 1000); // 30鍒嗛挓闂撮殧
                const timeStr = timestamp.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(',', ' ');
                
                // 娓╁害鍊?鎽勬皬搴?锛岀害25搴﹀乏鍙虫尝鍔?                let tempValue = 25 + Math.sin(i/3) * 2 + (Math.random() - 0.5);
                exampleData.push(`${timeStr},娓╁害浼犳劅鍣?涓绘ˉ鍖楁,${tempValue.toFixed(2)}`);
            }
            
            // 娣诲姞搴斿彉浼犳劅鍣ㄦ暟鎹ず渚?            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(now.getTime() - (19-i) * 30 * 60 * 1000); // 30鍒嗛挓闂撮殧
                const timeStr = timestamp.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(',', ' ');
                
                // 搴斿彉鍊?渭蔚)锛岀害200宸﹀彸娉㈠姩
                let strainValue = 200 + Math.sin(i/4) * 15 + (Math.random() - 0.5) * 5;
                exampleData.push(`${timeStr},搴斿彉浼犳劅鍣?涓绘ˉ涓,${strainValue.toFixed(2)}`);
            }
            
            // 娣诲姞鎸姩浼犳劅鍣ㄦ暟鎹ず渚?            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(now.getTime() - (19-i) * 30 * 60 * 1000); // 30鍒嗛挓闂撮殧
                const timeStr = timestamp.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(',', ' ');
                
                // 鎸姩鍊?g)锛岀害0.5宸﹀彸娉㈠姩
                let vibValue = 0.5 + Math.sin(i/2) * 0.1 + (Math.random() - 0.5) * 0.1;
                if (i === 10) vibValue = 1.2; // 娣诲姞寮傚父鍊?                exampleData.push(`${timeStr},鎸姩浼犳劅鍣?涓绘ˉ鍗楁,${vibValue.toFixed(2)}`);
            }
            
            // 灏嗙ず渚嬫暟鎹浆鎹负CSV鏂囨湰
            const csvContent = exampleData.join('\n');
            
            // 鍒涘缓Blob瀵硅薄
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // 鍒涘缓涓嬭浇閾炬帴
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', '妗ユ鐩戞祴鏁版嵁绀轰緥.csv');
            link.style.visibility = 'hidden';
            
            // 娣诲姞鍒癉OM锛岃Е鍙戜笅杞斤紝鐒跺悗绉婚櫎
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 闅忔満鍒锋柊鏁版嵁鍔熻兘
        function startRandomDataUpdates() {
            // 鍋滄涔嬪墠鐨勬洿鏂?            stopDataUpdates();
            
            // 纭繚鏈夋暟鎹?            if (!sensorData || sensorData.length === 0) {
                alert('璇峰厛涓婁紶鏁版嵁鎴栫敓鎴愮ず渚嬫暟鎹?);
                return;
            }
            
            // 鏄剧ず姝ｅ湪鍒锋柊鎻愮ず
            fileInfo.textContent = '鏁版嵁鍒锋柊涓?..';
            refreshButton.textContent = '鍋滄鍒锋柊';
            refreshButton.classList.add('danger');
            
            // 鍚敤妫€娴嬫寜閽紝纭繚鍦ㄦ暟鎹埛鏂版椂鍙互杩涜妫€娴?            detectButton.disabled = false;
            
            // 姣?绉掓洿鏂颁竴娆℃暟鎹紙鏇寸鍚堟ˉ姊佺洃娴嬬殑瀹為檯棰戠巼锛?            dataUpdateInterval = setInterval(() => {
                randomlyUpdateData();
            }, 5000);
        }
        
        // 鍋滄鏁版嵁鏇存柊
        function stopDataUpdates() {
            if (dataUpdateInterval) {
                clearInterval(dataUpdateInterval);
                dataUpdateInterval = null;
                
                refreshButton.textContent = '闅忔満鍒锋柊鏁版嵁';
                refreshButton.classList.remove('danger');
                
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    fileInfo.textContent = `宸查€夋嫨鏂囦欢: ${file.name} (${formatFileSize(file.size)})`;
                } else {
                    fileInfo.textContent = '鏈€夋嫨鏂囦欢';
                }
            }
        }
        
        // 闅忔満鏇存柊鏁版嵁锛屼娇妯℃嫙鏁版嵁鏇寸鍚堢墿鐞嗙幇瀹炲苟娣诲姞浜嬩欢
        function randomlyUpdateData() {
            if (!sensorData || sensorData.length === 0) return;
            
            // 鑾峰彇褰撳墠鏃堕棿浣滀负鏂扮殑鏁版嵁鐐规椂闂存埑
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // 鑾峰彇鍞竴鐨勪紶鎰熷櫒ID鍒楄〃
            const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
            
            // 鍒涘缓鐜鍥犵礌锛岀‘淇濇暟鎹箣闂寸殑鍏宠仈鎬?            const environmentalFactor = Math.sin(Date.now() / 10000000) * 0.15; // 缂撴參鍙樺寲鐨勭幆澧冨洜绱?            const timeOfDayFactor = Math.sin(now.getHours() / 24 * Math.PI) * 0.1; // 鏃ラ棿鍙樺寲鍥犵礌
            const bridgeLoadFactor = Math.sin(Date.now() / 3600000) * 0.08; // 妗ユ璐熻浇鍙樺寲
            
            // 鍏ㄥ眬娓╁害褰卞搷
            const temperature = 20 + Math.sin(now.getHours() / 24 * Math.PI * 2) * 5 + Math.random() * 2;
            
            // 闅忔満鐢熸垚浜嬩欢
            let currentEvent = null;
            const eventProbability = Math.random();
            let eventImpact = 0;
            let eventLocation = '';
            let eventSeverity = 'low';
            let affectedSensorTypes = [];
            let affectedSections = [];
            let eventReasoning = '鎵€鏈変紶鎰熷櫒鏁版嵁鍦ㄦ甯歌寖鍥村唴锛屾棤寮傚父妯″紡';
            
            // 瀹氫箟鍙兘鐨勪簨浠剁被鍨?            const possibleEvents = [
                {
                    type: '姝ｅ父杩愮淮涓?,
                    probability: 0.80, // 80%姒傜巼姝ｅ父杩愯
                    impact: 0,
                    severity: 'low',
                    affectedTypes: [],
                    affectedSections: []
                },
                {
                    type: '浜ら€氳礋杞借繃楂?,
                    probability: 0.05, // 5%姒傜巼
                    impact: 0.4,
                    severity: 'medium',
                    affectedTypes: ['搴斿彉', '鎸姩', '杞介噸'],
                    affectedSections: ['涓', '鍖楁']
                },
                {
                    type: '缁撴瀯搴斿彉寮傚父',
                    probability: 0.03, // 3%姒傜巼
                    impact: 0.6,
                    severity: 'high',
                    affectedTypes: ['搴斿彉', '浣嶇Щ', '鍊捐'],
                    affectedSections: ['鍗楁', '鏀拺缁撴瀯']
                },
                {
                    type: '娓╁害寮傚父娉㈠姩',
                    probability: 0.04, // 4%姒傜巼
                    impact: 0.3,
                    severity: 'medium',
                    affectedTypes: ['娓╁害', '搴斿彉'],
                    affectedSections: ['鍏ㄦˉ']
                },
                {
                    type: '澶栭儴闇囧姩骞叉壈',
                    probability: 0.03, // 3%姒傜巼
                    impact: 0.5,
                    severity: 'medium',
                    affectedTypes: ['鎸姩', '鍔犻€熷害'],
                    affectedSections: ['涓滄', '瑗挎']
                },
                {
                    type: '椋庡姏褰卞搷鏄庢樉',
                    probability: 0.03, // 3%姒傜巼
                    impact: 0.35,
                    severity: 'low',
                    affectedTypes: ['鎸姩', '鍊捐'],
                    affectedSections: ['鍏ㄦˉ']
                },
                {
                    type: '鏀骇浣嶇Щ寮傚父',
                    probability: 0.01, // 1%姒傜巼
                    impact: 0.7,
                    severity: 'high',
                    affectedTypes: ['浣嶇Щ', '搴斿彉', '鍊捐'],
                    affectedSections: ['杩炴帴閮ㄤ綅', '鏀拺缁撴瀯']
                },
                {
                    type: '鍚婄储寮犲姏鍙樺寲',
                    probability: 0.01, // 1%姒傜巼
                    impact: 0.5,
                    severity: 'medium',
                    affectedTypes: ['搴斿彉', '鍔犻€熷害'],
                    affectedSections: ['杩炴帴閮ㄤ綅']
                }
            ];
            
            // 绱Н姒傜巼纭畾浜嬩欢
            let cumulativeProbability = 0;
            for (const event of possibleEvents) {
                cumulativeProbability += event.probability;
                if (eventProbability <= cumulativeProbability) {
                    currentEvent = event;
                    eventImpact = event.impact;
                    eventSeverity = event.severity;
                    affectedSensorTypes = event.affectedTypes;
                    
                    // 纭畾褰卞搷鍖烘
                    if (event.affectedSections.includes('鍏ㄦˉ')) {
                        affectedSections = ['鍖楁', '涓', '鍗楁', '涓滄', '瑗挎', '鏀拺缁撴瀯', '杩炴帴閮ㄤ綅'];
                    } else {
                        affectedSections = event.affectedSections;
                    }
                    
                    // 涓轰笉鍚屼簨浠剁被鍨嬬敓鎴愪笉鍚岀殑鍒ゆ柇渚濇嵁
                    switch (event.type) {
                        case '浜ら€氳礋杞借繃楂?:
                            eventReasoning = '涓杞介噸浼犳劅鍣ㄦ暟鎹寔缁亸楂橈紝鎸姩棰戠巼澧炲姞锛屼笌浜ら€氶珮宄版湡妯″紡鍖归厤';
                            break;
                        case '缁撴瀯搴斿彉寮傚父':
                            eventReasoning = '鍗楁搴斿彉浼犳劅鍣ㄥ拰鏀拺缁撴瀯浣嶇Щ鏁版嵁寮傚父锛屼笌鍘嗗彶搴斿彉妯″紡涓嶇';
                            break;
                        case '娓╁害寮傚父娉㈠姩':
                            eventReasoning = '鍏ㄦˉ娓╁害浼犳劅鍣ㄦ暟鎹嚭鐜伴潪姝ｅ父娓╁害鍙樺寲锛岃秴鍑哄鑺傛€ч鏈熻寖鍥?;
                            break;
                        case '澶栭儴闇囧姩骞叉壈':
                            eventReasoning = '涓滆タ涓ゆ鍔犻€熷害鍜屾尟鍔ㄤ紶鎰熷櫒妫€娴嬪埌寮傚父闇囧姩妯″紡锛屽彲鑳藉彈澶栭儴宸ョ▼褰卞搷';
                            break;
                        case '椋庡姏褰卞搷鏄庢樉':
                            eventReasoning = '鍏ㄦˉ鎸姩鍜屽€捐浼犳劅鍣ㄦ暟鎹尝鍔ㄥ澶э紝涓庢皵璞＄珯椋庨€熸暟鎹浉鍏?;
                            break;
                        case '鏀骇浣嶇Щ寮傚父':
                            eventReasoning = '杩炴帴閮ㄤ綅浣嶇Щ浼犳劅鍣ㄦ暟鎹獊鍙橈紝鏀拺缁撴瀯鍊捐鍙樺寲鏄捐憲';
                            break;
                        case '鍚婄储寮犲姏鍙樺寲':
                            eventReasoning = '杩炴帴閮ㄤ綅鍚婄储搴斿彉鍜屽姞閫熷害浼犳劅鍣ㄦ暟鎹尝鍔ㄥ紓甯革紝鍙兘闇€瑕佹鏌ュ悐绱㈠紶鍔?;
                            break;
                        default:
                            eventReasoning = '鎵€鏈変紶鎰熷櫒鏁版嵁鍦ㄦ甯歌寖鍥村唴锛屾棤寮傚父妯″紡';
                    }
                    
                    break;
                }
            }
            
            // 鏇存柊浜嬩欢棰勬祴
            if (currentEvent && currentEvent.type !== '姝ｅ父杩愮淮涓?) {
                // 娓呴櫎鏃ч娴?                eventPredictions.length = 0;
                
                // 娣诲姞鏂伴娴?                eventPredictions.push({
                    id: Date.now(),
                    eventType: currentEvent.type,
                    probability: 0.5 + Math.random() * 0.4, // 50%-90%姒傜巼
                    reasoning: eventReasoning,
                    timestamp: timeStr,
                    severity: eventSeverity,
                    relatedSensors: generateAffectedSensorList(affectedSensorTypes, affectedSections)
                });
                
                // 鏄剧ず浜嬩欢棰勬祴
                displayEventPredictions();
            } else if (Math.random() > 0.9) { // 10%鐨勬鐜囨洿鏂版甯歌繍琛岀姸鎬?                eventPredictions.length = 0;
                eventPredictions.push({
                    id: Date.now(),
                    eventType: '姝ｅ父杩愮淮涓?,
                    probability: 0.9 + Math.random() * 0.09, // 90%-99%姒傜巼
                    reasoning: '鎵€鏈変紶鎰熷櫒鏁版嵁鍦ㄦ甯歌寖鍥村唴锛屾棤寮傚父妯″紡',
                    timestamp: timeStr,
                    severity: 'low',
                    relatedSensors: ['绯荤粺鐘舵€?, '鎵€鏈変紶鎰熷櫒']
                });
                displayEventPredictions();
            }
            
            // 涓烘瘡涓紶鎰熷櫒鍒涘缓鏂扮殑鏁版嵁鐐?            uniqueSensors.forEach(sensorId => {
                // 鑾峰彇璇ヤ紶鎰熷櫒鐨勫巻鍙叉暟鎹?                const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                if (sensorPoints.length === 0) return;
                
                const currentSensor = sensorPoints[sensorPoints.length - 1];
                const currentValue = currentSensor.value;
                
                // 鏍规嵁浼犳劅鍣↖D鍒嗘瀽浼犳劅鍣ㄧ被鍨嬪拰鍖烘
                let sensorType = currentSensor.sensorType || '鍏朵粬';
                let sensorLocation = currentSensor.location || '涓';
                
                // 纭畾鏄惁鍙楀綋鍓嶄簨浠跺奖鍝?                const isAffectedType = affectedSensorTypes.includes(sensorType);
                const isAffectedSection = affectedSections.includes(sensorLocation);
                const isAffected = isAffectedType && isAffectedSection;
                
                // 鏍规嵁浼犳劅鍣ㄧ被鍨嬭幏鍙栨暟鎹寖鍥?                let baseValue, minValue, maxValue, warningThreshold, alarmThreshold;
                
                switch(sensorType) {
                    case '娓╁害':
                        baseValue = 25;
                        minValue = 5;
                        maxValue = 55;
                        warningThreshold = 40;
                        alarmThreshold = 45;
                        break;
                    case '搴斿彉':
                        baseValue = 200;
                        minValue = 50;
                        maxValue = 400;
                        warningThreshold = 300;
                        alarmThreshold = 350;
                        break;
                    case '鎸姩':
                        baseValue = 0.5;
                        minValue = 0.05;
                        maxValue = 3.0;
                        warningThreshold = 1.5;
                        alarmThreshold = 2.0;
                        break;
                    case '鍊捐':
                        baseValue = 0.5;
                        minValue = 0;
                        maxValue = 3.0;
                        warningThreshold = 1.5;
                        alarmThreshold = 2.0;
                        break;
                    case '浣嶇Щ':
                        baseValue = 5;
                        minValue = 0;
                        maxValue = 30;
                        warningThreshold = 15;
                        alarmThreshold = 20;
                        break;
                    case '鍔犻€熷害':
                        baseValue = 0.2;
                        minValue = 0;
                        maxValue = 1.5;
                        warningThreshold = 0.8;
                        alarmThreshold = 1.0;
                        break;
                    case '杞介噸':
                        baseValue = 1000;
                        minValue = 0;
                        maxValue = 3000;
                        warningThreshold = 2000;
                        alarmThreshold = 2500;
                        break;
                    default:
                        baseValue = 50;
                        minValue = 0;
                        maxValue = 100;
                        warningThreshold = 80;
                        alarmThreshold = 90;
                }
                
                // 璁＄畻鍩虹鍙樺寲閲?                const randomFactor = (Math.random() * 2 - 1) * 0.01 * currentValue; // 鍩虹闅忔満娉㈠姩 (灏忓箙)
                
                // 鐜鍥犵礌褰卞搷
                let environmentalImpact = 0;
                if (sensorType === '娓╁害') {
                    environmentalImpact = environmentalFactor * 1.2 + (temperature - 20) * 0.1;
                } else if (sensorType === '搴斿彉') {
                    environmentalImpact = bridgeLoadFactor * 1.5 + timeOfDayFactor * 0.5;
                } else if (sensorType === '鎸姩') {
                    environmentalImpact = bridgeLoadFactor * 1.2 + environmentalFactor * 0.8;
                } else if (sensorType === '鍊捐') {
                    environmentalImpact = bridgeLoadFactor * 0.9 + environmentalFactor * 1.1;
                } else if (sensorType === '浣嶇Щ') {
                    environmentalImpact = bridgeLoadFactor * 1.3 + environmentalFactor * 0.7;
                } else if (sensorType === '鍔犻€熷害') {
                    environmentalImpact = bridgeLoadFactor * 1.4 + environmentalFactor * 1.2;
                } else if (sensorType === '杞介噸') {
                    environmentalImpact = bridgeLoadFactor * 2.0 + timeOfDayFactor * 1.5;
                } else {
                    environmentalImpact = environmentalFactor * 0.8 + timeOfDayFactor * 0.7;
                }
                
                // 浜嬩欢褰卞搷
                let eventEffect = 0;
                if (isAffected) {
                    // 浜嬩欢褰卞搷鏍规嵁浼犳劅鍣ㄧ被鍨嬩笉鍚岃€屼笉鍚?                    let typeMultiplier = 1.0;
                    if (currentEvent) {
                        switch(currentEvent.type) {
                            case '浜ら€氳礋杞借繃楂?:
                                if (sensorType === '杞介噸') typeMultiplier = 2.0;
                                else if (sensorType === '鎸姩') typeMultiplier = 1.5;
                                else if (sensorType === '搴斿彉') typeMultiplier = 1.3;
                                break;
                            case '缁撴瀯搴斿彉寮傚父':
                                if (sensorType === '搴斿彉') typeMultiplier = 2.0;
                                else if (sensorType === '浣嶇Щ') typeMultiplier = 1.8;
                                else if (sensorType === '鍊捐') typeMultiplier = 1.5;
                                break;
                            case '娓╁害寮傚父娉㈠姩':
                                if (sensorType === '娓╁害') typeMultiplier = 1.8;
                                else if (sensorType === '搴斿彉') typeMultiplier = 1.2;
                                break;
                            case '澶栭儴闇囧姩骞叉壈':
                                if (sensorType === '鎸姩') typeMultiplier = 2.0;
                                else if (sensorType === '鍔犻€熷害') typeMultiplier = 1.8;
                                break;
                            case '椋庡姏褰卞搷鏄庢樉':
                                if (sensorType === '鎸姩') typeMultiplier = 1.5;
                                else if (sensorType === '鍊捐') typeMultiplier = 1.3;
                                break;
                            case '鏀骇浣嶇Щ寮傚父':
                                if (sensorType === '浣嶇Щ') typeMultiplier = 2.2;
                                else if (sensorType === '搴斿彉') typeMultiplier = 1.5;
                                else if (sensorType === '鍊捐') typeMultiplier = 1.7;
                                break;
                            case '鍚婄储寮犲姏鍙樺寲':
                                if (sensorType === '搴斿彉') typeMultiplier = 1.8;
                                else if (sensorType === '鍔犻€熷害') typeMultiplier = 1.6;
                                break;
                        }
                    }
                    
                    // 璁＄畻浜嬩欢褰卞搷
                    const directionFactor = eventImpact * typeMultiplier;
                    const randomDirection = Math.random() > 0.3; // 70%姒傜巼涓烘鍚戝彉鍖?                    eventEffect = (randomDirection ? 1 : -1) * directionFactor * baseValue * 0.2;
                }
                
                // 寮傚父姒傜巼(闅忔満寮傚父銆佷笉鍙椾簨浠跺奖鍝?
                let anomalyEffect = 0;
                if (!isAffected && Math.random() < 0.05) { // 5%姒傜巼浜х敓闅忔満寮傚父
                    anomalyEffect = (Math.random() < 0.5 ? 1 : -1) * Math.random() * 0.3 * baseValue;
                }
                
                // 鍩虹鐜褰卞搷
                let baseChange = (environmentalImpact * currentValue * 0.05) + randomFactor;
                
                // 璁＄畻鎬诲彉鍖栭噺
                let totalChange = baseChange + eventEffect + anomalyEffect;
                
                // 璁＄畻鏂板€?                let newValue = currentValue + totalChange;
                
                // 纭繚鏂板€煎湪鍚堢悊鑼冨洿鍐?                newValue = Math.max(minValue, Math.min(maxValue, newValue));
                
                // 纭繚鏁版嵁鐨勮繛缁€?                const maxChange = currentValue * 0.25; // 鏈€澶у厑璁?5%鐨勫彉鍖?                if (Math.abs(newValue - currentValue) > maxChange) {
                    newValue = currentValue + (Math.sign(newValue - currentValue) * maxChange * Math.random());
                }
                
                // 纭畾浼犳劅鍣ㄧ姸鎬?                let status = 'normal';
                if (newValue > warningThreshold && newValue < alarmThreshold) {
                    status = 'warning';
                }
                if (newValue > alarmThreshold || newValue < minValue) {
                    status = 'danger';
                }
                
                // 鍒涘缓鏂扮殑鏁版嵁鐐?                const newDataPoint = {
                    timestamp: timeStr,
                    sensorId: sensorId,
                    value: newValue,
                    status: status,
                    sensorType: sensorType,
                    location: sensorLocation
                };
                
                // 娣诲姞鍒版暟鎹泦
                sensorData.push(newDataPoint);
                
                // 鏇存柊UI
                addDataToTable(newDataPoint);
                
                // 鏇存柊鍥捐〃
                updateCharts();
                
                // 鏇存柊鐩稿叧鎽勫儚澶寸姸鎬?                updateCameraStatus(sensorId, status);
            });
            
            // 闄愬埗鏁版嵁鐐规暟閲忥紝淇濈暀鏈€杩戠殑2000涓暟鎹偣
            if (sensorData.length > 2000) {
                sensorData = sensorData.slice(sensorData.length - 2000);
                refreshTable();
            }
        }

        // 杈呭姪鍑芥暟锛氭牴鎹紶鎰熷櫒绫诲瀷鍜屽尯娈电敓鎴愬彈褰卞搷鐨勪紶鎰熷櫒鍒楄〃
        function generateAffectedSensorList(types, sections) {
            if (types.length === 0 || sections.length === 0) {
                return ['绯荤粺鐘舵€?];
            }
            
            // 浠庣幇鏈変紶鎰熷櫒涓壘鍑哄彈褰卞搷鐨勪紶鎰熷櫒ID
            const affectedSensors = [];
            const sensorsByType = {};
            
            // 鎸夌被鍨嬪垎缁勪紶鎰熷櫒
            sensorData.forEach(item => {
                if (!sensorsByType[item.sensorType]) {
                    sensorsByType[item.sensorType] = new Set();
                }
                sensorsByType[item.sensorType].add(item.sensorId);
            });
            
            // 涓烘瘡绉嶇被鍨嬫壘鍑烘渶澶?涓紶鎰熷櫒
            types.forEach(type => {
                if (sensorsByType[type]) {
                    // 杞负鏁扮粍骞剁瓫閫夌鍚堝尯娈电殑浼犳劅鍣?                    const sensors = Array.from(sensorsByType[type]).filter(id => {
                        const sensorPoint = sensorData.find(s => s.sensorId === id);
                        return sensorPoint && sections.includes(sensorPoint.location);
                    });
                    
                    // 闅忔満閫夋嫨鏈€澶?涓紶鎰熷櫒
                    const selectedCount = Math.min(3, sensors.length);
                    for (let i = 0; i < selectedCount; i++) {
                        const randomIndex = Math.floor(Math.random() * sensors.length);
                        if (sensors[randomIndex] && !affectedSensors.includes(sensors[randomIndex])) {
                            affectedSensors.push(sensors[randomIndex]);
                            sensors.splice(randomIndex, 1);
                        }
                    }
                }
            });
            
            return affectedSensors.length > 0 ? affectedSensors : ['绯荤粺鐘舵€?];
        }

        // 鎽勫儚澶存暟鎹敓鎴?        function generateCameras() {
            allCameras = [];
            const sections = ['鍖楁', '涓', '鍗楁', '涓滄', '瑗挎', '鏀拺缁撴瀯', '杩炴帴閮ㄤ綅'];
            const positions = ['妗ラ潰', '妗ュⅸ', '妗ュ', '鍚婄储', '鏀骇', '浼哥缉缂?, '浜ら€氱洃鎺?];
            
            // 鏀堕泦鐜版湁浼犳劅鍣↖D
            const existingSensorIds = new Set(sensorData.map(item => item.sensorId));
            
            // 涓烘瘡涓紶鎰熷櫒鍒涘缓鍏宠仈鎽勫儚澶?            let cameraCount = 0;
            existingSensorIds.forEach(sensorId => {
                // 鍒ゆ柇浼犳劅鍣ㄤ綅缃?                let section = '涓';
                let position = '妗ラ潰';
                
                for (const s of sections) {
                    if (sensorId.includes(s)) {
                        section = s;
                        break;
                    }
                }
                
                for (const p of positions) {
                    if (sensorId.includes(p)) {
                        position = p;
                        break;
                    }
                }
                
                // 鍒涘缓鎽勫儚澶?                const statusChance = Math.random();
                let status;
                
                if (statusChance > 0.9) {
                    status = 'offline';
                } else if (statusChance > 0.8) {
                    status = 'warning';
                } else {
                    status = 'online';
                }
                
                cameraCount++;
                allCameras.push({
                    id: `CAM-${cameraCount.toString().padStart(3, '0')}`,
                    name: `${section}${position}鎽勫儚澶?${cameraCount}`,
                    status: status,
                    sensorId: sensorId,
                    section: section,
                    position: position,
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 3600000)).toLocaleString('zh-CN')
                });
            });
            
            // 濡傛灉鎽勫儚澶存暟閲忎笉瓒?0涓紝娣诲姞棰濆鐨勬憚鍍忓ご
            while (allCameras.length < 50) {
                cameraCount++;
                const section = sections[Math.floor(Math.random() * sections.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                const statusChance = Math.random();
                let status;
                
                if (statusChance > 0.9) {
                    status = 'offline';
                } else if (statusChance > 0.8) {
                    status = 'warning';
                } else {
                    status = 'online';
                }
                
                allCameras.push({
                    id: `CAM-${cameraCount.toString().padStart(3, '0')}`,
                    name: `${section}${position}鎽勫儚澶?${cameraCount}`,
                    status: status,
                    sensorId: `浼犳劅鍣?${section}-${position}-${cameraCount.toString().padStart(2, '0')}`,
                    section: section,
                    position: position,
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 3600000)).toLocaleString('zh-CN')
                });
            }
            
            return allCameras;
        }

        // 娣诲姞绀轰緥鏁版嵁鎸夐挳鍜屼笅杞界ず渚嬫枃浠跺姛鑳?        document.getElementById('sampleButton').addEventListener('click', function() {
            // 鐢熸垚绀轰緥鏁版嵁
            createSampleData();
            
            // 纭繚妫€娴嬫寜閽惎鐢?            document.getElementById('detectButton').disabled = false;
        });
        downloadExample.addEventListener('click', generateExampleFile);
        
        // 闅忔満鍒锋柊鎸夐挳鐐瑰嚮浜嬩欢
        refreshButton.addEventListener('click', function() {
            if (dataUpdateInterval) {
                stopDataUpdates();
            } else {
                startRandomDataUpdates();
            }
        });
        
        // 鍒濆鍖?        resetAll();
        // 妫€鏌ョ櫥褰曠姸鎬?        checkLoginStatus();
        // 鍒濆鍖栦簨浠舵帶鍒堕潰鏉?        initEventControls();

        // 纭畾寮傚父绫诲瀷
        function determineAnomalyType(index, values, zScore) {
            try {
                // 妫€鏌ュ墠鍚庢槸鍚︿篃鏄紓甯革紝鍒ゆ柇杩炵画鎬у紓甯?                let isContinuous = false;
                
                if (index > 1) {  // 纭繚鏈夊墠涓や釜鐐?                    try {
                        isContinuous = Math.abs((values[index-1] - values[index-2]) / Math.max(0.01, Math.abs(values[index-2]))) > 0.1;
                    } catch (e) {
                        console.warn("璁＄畻鍓嶅鐐硅繛缁€у紓甯告椂鍑洪敊:", e.message);
                    }
                }
                
                if (!isContinuous && index < values.length - 1) {  // 妫€鏌ュ悗涓€涓偣
                    try {
                        isContinuous = Math.abs((values[index+1] - values[index]) / Math.max(0.01, Math.abs(values[index]))) > 0.1;
                    } catch (e) {
                        console.warn("璁＄畻鍚庣户鐐硅繛缁€у紓甯告椂鍑洪敊:", e.message);
                    }
                }
                
                // 妫€鏌ュ懆鍥寸偣鏄惁褰㈡垚缇や綋
                const startIdx = Math.max(0, index - 3);
                const endIdx = Math.min(values.length, index + 4);
                const nearbyPoints = values.slice(startIdx, endIdx);
                
                const nearbyMean = nearbyPoints.reduce((acc, val) => acc + val, 0) / nearbyPoints.length;
                const globalMean = values.reduce((acc, val) => acc + val, 0) / values.length;
                
                // 閬垮厤闄や互闆讹紝鍔犲叆瀹夊叏妫€鏌?                const denominator = Math.max(0.01, Math.abs(globalMean));
                const isCluster = Math.abs((nearbyMean - globalMean) / denominator) > 0.1 && nearbyPoints.length >= 3;
                
                if (isCluster) {
                    return '缇や綋寮傚父';
                } else if (isContinuous) {
                    return '杩炵画鎬у紓甯?;
                } else {
                    return '鍗曠偣寮傚父';
                }
            } catch (error) {
                console.error("纭畾寮傚父绫诲瀷鏃跺嚭閿?", error);
                return '鏈垎绫诲紓甯?;  // 杩斿洖涓€涓粯璁ゅ€?            }
        }

        // 鍒濆鍖栦簨浠舵帶鍒堕潰鏉?        function initEventControls() {
            console.log("鍒濆鍖栦簨浠舵帶鍒堕潰鏉?);
            
            // 鑾峰彇浜嬩欢鐩稿叧鐨凞OM鍏冪礌
            eventNameElement = document.getElementById('currentEventName');
            eventDescElement = document.getElementById('currentEventDescription');
            eventProgressContainer = document.getElementById('eventProgressContainer');
            eventProgressBar = document.getElementById('eventProgressBar');
            eventProgressText = document.getElementById('eventProgressText');
            eventDetails = document.getElementById('eventDetails');
            
            // 浜嬩欢鎸夐挳鐐瑰嚮澶勭悊
            const eventButtons = document.querySelectorAll('#eventButtons button');
            eventButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const eventType = this.getAttribute('data-event');
                    
                    // 濡傛灉鐐瑰嚮鐨勬槸褰撳墠娲诲姩浜嬩欢锛屽垯蹇界暐
                    if (currentEventSimulation === eventType) return;
                    
                    // 鏇存柊鎸夐挳鐘舵€?                    eventButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 寮€濮嬫ā鎷熸柊浜嬩欢
                    startEventSimulation(eventType);
                });
            });
            
            // 鍒濆鍖栨竻绌哄巻鍙叉寜閽?            document.getElementById('clearHistoryBtn').addEventListener('click', function() {
                clearDetectionHistory();
            });
            
            // 榛樿璁剧疆涓烘甯歌繍琛岀姸鎬?            startEventSimulation(bridgeEvents.NORMAL);
        }

        // 寮€濮嬩簨浠舵ā鎷?        function startEventSimulation(eventType) {
            // 妫€鏌ヤ簨浠剁被鍨?            if (!eventType) {
                console.warn("鏈寚瀹氫簨浠剁被鍨嬶紝浣跨敤榛樿鍊?);
                eventType = "NORMAL"; // 浣跨敤榛樿鍊?            }
            
            // 妫€鏌ヤ簨浠惰缃槸鍚﹀瓨鍦?            if (typeof eventSettings === 'undefined' || !eventSettings || !eventSettings[eventType]) {
                console.error(`浜嬩欢璁剧疆鏈畾涔夋垨浜嬩欢绫诲瀷 ${eventType} 涓嶅瓨鍦╜);
                return;
            }
            
            // 鍋滄褰撳墠浜嬩欢妯℃嫙
            if (currentEventSimulation !== null) {
                console.log(`鍋滄褰撳墠浜嬩欢妯℃嫙: ${currentEventSimulation}`);
            }
            
            // 璁剧疆鏂扮殑浜嬩欢妯℃嫙
            currentEventSimulation = eventType;
            const eventConfig = eventSettings[eventType];
            
            console.log(`寮€濮嬫ā鎷熶簨浠? ${eventType}, 鍚嶇О: ${eventConfig.name}`);
            
            // 鏇存柊UI - 娣诲姞楠岃瘉浠ラ槻姝㈠null鐨勫紩鐢?            if (eventNameElement) eventNameElement.textContent = eventConfig.name;
            if (eventDescElement) eventDescElement.textContent = eventConfig.description;
            
            // 娓呴櫎涓婁竴涓簨浠剁殑绫?            if (eventDetails) {
                eventDetails.className = 'event-details';
                
                // 娣诲姞褰撳墠浜嬩欢鐨勭被
                if (eventConfig.severity === 'warning') {
                    eventDetails.classList.add('event-warning');
                } else if (eventConfig.severity === 'alert') {
                    eventDetails.classList.add('event-alert');
                }
            }
            
            // 璁剧疆浜嬩欢杩涘害
            if (eventType === bridgeEvents.NORMAL) {
                // 姝ｅ父鐘舵€佹病鏈夎繘搴︽潯
                eventProgressContainer.style.display = 'none';
                eventProgress = 0;
                eventDuration = 0;
            } else {
                // 璁剧疆浜嬩欢鎸佺画鏃堕棿锛堥殢鏈哄湪閰嶇疆鐨勮寖鍥村唴锛?                eventDuration = Math.floor(Math.random() * 
                    (eventConfig.duration[1] - eventConfig.duration[0] + 1)) + 
                    eventConfig.duration[0];
                
                eventProgress = 0;
                updateEventProgress();
                
                // 鏄剧ず杩涘害鏉?                eventProgressContainer.style.display = 'block';
            }
        }

        // 鏇存柊浜嬩欢杩涘害
        function updateEventProgress() {
            if (!currentEventSimulation || currentEventSimulation === bridgeEvents.NORMAL) return;
            
            // 澧炲姞杩涘害
            eventProgress += (100 / eventDuration);
            
            // 纭繚涓嶈秴杩?00%
            if (eventProgress > 100) {
                eventProgress = 100;
                
                // 浜嬩欢缁撴潫锛屾仮澶嶆甯哥姸鎬?                setTimeout(() => {
                    document.querySelector('#eventButtons button[data-event="normal"]').click();
                }, 1000);
            }
            
            // 鏇存柊杩涘害鏉?            eventProgressBar.style.width = `${eventProgress}%`;
            eventProgressText.textContent = `${Math.round(eventProgress)}%`;
        }

        // 灏嗗紓甯告娴嬬粨鏋滄坊鍔犲埌鍘嗗彶璁板綍
        function addToDetectionHistory(result) {
            const historyList = document.getElementById('detectionHistory');
            const noHistoryMsg = historyList.querySelector('.no-history-message');
            
            if (noHistoryMsg) {
                noHistoryMsg.remove();
            }
            
            // 鍒涘缓鍘嗗彶璁板綍椤?            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.dataset.timestamp = new Date().toISOString();
            
            // 鑾峰彇褰撳墠浜嬩欢鍚嶇О
            const eventName = currentEventSimulation ? 
                eventSettings[currentEventSimulation].name : '姝ｅ父杩愯';
                
            // 鍒涘缓鍘嗗彶璁板綍鍐呭
            historyItem.innerHTML = `
                <div class="history-item-header">
                    <div class="history-item-title">妫€娴嬬粨鏋?#${document.querySelectorAll('.history-item').length + 1}</div>
                    <div class="history-item-time">${new Date().toLocaleString('zh-CN')}</div>
                </div>
                <div class="history-item-stats">
                    <div>浜嬩欢鐘舵€? ${eventName}</div>
                    <div>鏁版嵁鐐? ${result.totalPoints}, 寮傚父: ${result.anomalyCount}</div>
                    <div>鍗曠偣寮傚父: ${result.singlePointCount}, 杩炵画鎬у紓甯? ${result.continuousCount}, 缇や綋寮傚父: ${result.clusterCount}</div>
                </div>
            `;
            
            // 鐐瑰嚮鍘嗗彶璁板綍椤规仮澶嶈妫€娴嬬粨鏋?            historyItem.addEventListener('click', function() {
                restoreDetectionResult(this.dataset.timestamp);
            });
            
            // 娣诲姞鍒板巻鍙茶褰曞垪琛?            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // 瀛樺偍褰撳墠妫€娴嬬粨鏋?            saveDetectionResult(historyItem.dataset.timestamp, result);
        }

        // 淇濆瓨妫€娴嬬粨鏋?        function saveDetectionResult(timestamp, result) {
            // 鑾峰彇宸叉湁鐨勫巻鍙茶褰?            let history = JSON.parse(localStorage.getItem('detectionHistory') || '[]');
            
            // 娣诲姞鏂拌褰?            history.push({
                timestamp: timestamp,
                result: result,
                anomalyChartData: dataChart ? dataChart.data : null,
                event: currentEventSimulation,
                eventName: eventSettings[currentEventSimulation || bridgeEvents.NORMAL].name
            });
            
            // 闄愬埗鏈€澶у巻鍙茶褰曟暟
            if (history.length > 10) {
                history = history.slice(history.length - 10);
            }
            
            // 淇濆瓨鍒發ocalStorage
            localStorage.setItem('detectionHistory', JSON.stringify(history));
        }

        // 鎭㈠妫€娴嬬粨鏋?        function restoreDetectionResult(timestamp) {
            // 鑾峰彇鍘嗗彶璁板綍
            const history = JSON.parse(localStorage.getItem('detectionHistory') || '[]');
            
            // 鏌ユ壘瀵瑰簲鐨勮褰?            const record = history.find(item => item.timestamp === timestamp);
            if (!record) return;
            
            // 鎭㈠妫€娴嬬粨鏋滄樉绀?            const result = record.result;
            
            // 鏇存柊缁熻鏁板瓧
            document.getElementById('totalPoints').textContent = result.totalPoints;
            document.getElementById('anomalyCount').textContent = result.anomalyCount;
            document.getElementById('singlePointCount').textContent = result.singlePointCount;
            document.getElementById('continuousCount').textContent = result.continuousCount;
            document.getElementById('clusterCount').textContent = result.clusterCount;
            
            // 鎭㈠寮傚父鍒楄〃
            document.getElementById('anomalyList').innerHTML = '';
            
            // 鏄剧ず鍒嗘瀽缁撴灉
            analysisSummary.style.display = 'block';
            analysisLoader.style.display = 'none';
            noAnalysisMessage.style.display = 'none';
            
            // 濡傛灉鏈夊浘琛ㄦ暟鎹紝鎭㈠鍥捐〃
            if (record.anomalyChartData) {
                restoreAnomalyChart(record.anomalyChartData);
            }
            
            // 鏄剧ず鎭㈠鎻愮ず
            alert(`宸叉仮澶?${new Date(timestamp).toLocaleString('zh-CN')} 鐨勬娴嬬粨鏋滐紝鍦?${record.eventName}"鐘舵€佷笅杩涜鐨勬娴媊);
        }

        // 鎭㈠寮傚父妫€娴嬪浘琛?        function restoreAnomalyChart(chartData) {
            if (!chartData) return;
            
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            
            // 閿€姣佺幇鏈夊浘琛?            if (anomalyChart) {
                anomalyChart.destroy();
            }
            
            // 鍒涘缓鏂板浘琛?            anomalyChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true
                            }
                        },
                        annotation: {
                            annotations: {
                                anomalyThreshold: {
                                    type: 'line',
                                    yMin: 2,
                                    yMax: 2,
                                    borderColor: 'rgba(255, 0, 0, 0.5)',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        display: true,
                                        content: '寮傚父闃堝€?(Z-score = 2)',
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: '鏁版嵁鐐?
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Z-Score'
                            }
                        }
                    }
                }
            });
        }

        // 娓呯┖妫€娴嬪巻鍙?        function clearDetectionHistory() {
            if (confirm('纭畾瑕佹竻绌烘墍鏈夊巻鍙茶褰曞悧锛熸鎿嶄綔涓嶅彲鎾ら攢銆?)) {
                // 娓呯┖localStorage
                localStorage.removeItem('detectionHistory');
                
                // 娓呯┖鍘嗗彶鍒楄〃
                const historyList = document.getElementById('detectionHistory');
                historyList.innerHTML = '<div class="no-history-message">鏆傛棤鍘嗗彶璁板綍</div>';
            }
        }

        // 鍔犺浇鍘嗗彶璁板綍
        function loadDetectionHistory() {
            const history = JSON.parse(localStorage.getItem('detectionHistory') || '[]');
            const historyList = document.getElementById('detectionHistory');
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="no-history-message">鏆傛棤鍘嗗彶璁板綍</div>';
                return;
            }
            
            // 娓呯┖鐜版湁鍒楄〃
            historyList.innerHTML = '';
            
            // 娣诲姞鍘嗗彶璁板綍
            history.forEach((record, index) => {
                const result = record.result;
                
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.timestamp = record.timestamp;
                
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-title">妫€娴嬬粨鏋?#${history.length - index}</div>
                        <div class="history-item-time">${new Date(record.timestamp).toLocaleString('zh-CN')}</div>
                    </div>
                    <div class="history-item-stats">
                        <div>浜嬩欢鐘舵€? ${record.eventName || '姝ｅ父杩愯'}</div>
                        <div>鏁版嵁鐐? ${result.totalPoints}, 寮傚父: ${result.anomalyCount}</div>
                        <div>鍗曠偣寮傚父: ${result.singlePointCount}, 杩炵画鎬у紓甯? ${result.continuousCount}, 缇や綋寮傚父: ${result.clusterCount}</div>
                    </div>
                `;
                
                // 鐐瑰嚮鍘嗗彶璁板綍椤规仮澶嶈妫€娴嬬粨鏋?                historyItem.addEventListener('click', function() {
                    restoreDetectionResult(this.dataset.timestamp);
                });
                
                historyList.appendChild(historyItem);
            });
        }

        // 浜嬩欢棰勬祴鏁版嵁缁撴瀯
        eventPredictions = [
            {
                id: 1,
                eventType: '缁撴瀯搴斿彉寮傚父',
                probability: 0.85,
                reasoning: '鍖楁搴斿彉浼犳劅鍣ㄨ繛缁?灏忔椂鏁版嵁鍋忛珮锛岃秴杩囨甯歌寖鍥?0%',
                timestamp: '2023-11-18 08:45',
                severity: 'high',
                relatedSensors: ['搴斿彉浼犳劅鍣?涓绘ˉ鍖楁', '搴斿彉浼犳劅鍣?涓绘ˉ涓']
            },
            {
                id: 2,
                eventType: '浜ら€氳礋杞借繃楂?,
                probability: 0.68,
                reasoning: '涓鎸姩浼犳劅鍣ㄦ暟鎹尝鍔ㄩ绻侊紝涓庡巻鍙蹭氦閫氶珮宄版湡妯″紡鍖归厤',
                timestamp: '2023-11-18 17:30',
                severity: 'medium',
                relatedSensors: ['鎸姩浼犳劅鍣?涓绘ˉ涓', '鎸姩浼犳劅鍣?涓绘ˉ鍗楁']
            },
            {
                id: 3,
                eventType: '娓╁害寮傚父娉㈠姩',
                probability: 0.52,
                reasoning: '鍗楁娓╁害浼犳劅鍣ㄨ繎鏈熸暟鎹尝鍔ㄨ秴鍑哄鑺傛甯歌寖鍥?,
                timestamp: '2023-11-18 14:15',
                severity: 'low',
                relatedSensors: ['娓╁害浼犳劅鍣?涓绘ˉ鍗楁']
            }
        ];

        // 鎽勫儚澶存暟鎹?        function generateCameras() {
            const cameras = [];
            const sections = ['鍖楁', '涓', '鍗楁', '涓滄', '瑗挎'];
            const positions = ['妗ラ潰', '妗ュⅸ', '妗ュ', '鍚婄储', '鏀骇'];
            
            // 鐢熸垚50涓憚鍍忓ご鏁版嵁
            for (let i = 1; i <= 50; i++) {
                const section = sections[Math.floor(Math.random() * sections.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                const statusChance = Math.random();
                let status;
                
                if (statusChance > 0.85) {
                    status = 'offline';
                } else if (statusChance > 0.7) {
                    status = 'warning';
                } else {
                    status = 'online';
                }
                
                cameras.push({
                    id: `CAM-${i.toString().padStart(3, '0')}`,
                    name: `${section}${position}鎽勫儚澶?${i}`,
                    status: status,
                    sensorId: `浼犳劅鍣?${section}-${position}-${i.toString().padStart(2, '0')}`,
                    section: section,
                    position: position,
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 3600000)).toLocaleString('zh-CN')
                });
            }
            
            return cameras;
        }

        // 鏄剧ず浜嬩欢棰勬祴
        function displayEventPredictions() {
            const container = document.getElementById('event-prediction-container');
            if (!container) return;
            
            // 娓呯┖瀹瑰櫒
            container.innerHTML = '';
            
            if (eventPredictions.length === 0) {
                container.innerHTML = '<div class="no-predictions">鏆傛棤寮傚父浜嬩欢棰勬祴</div>';
                return;
            }
            
            // 鎸夋鐜囬檷搴忔帓搴?            eventPredictions.sort((a, b) => b.probability - a.probability);
            
            // 涓烘瘡涓簨浠跺垱寤轰竴涓娴嬪崱鐗?            eventPredictions.forEach(event => {
                let severityClass = '';
                switch (event.severity) {
                    case 'high':
                        severityClass = 'severity-high';
                        break;
                    case 'medium':
                        severityClass = 'severity-medium';
                        break;
                    default:
                        severityClass = 'severity-low';
                }
                
                const probability = (event.probability * 100).toFixed(1);
                
                // 鍒涘缓棰勬祴鍗＄墖
                const card = document.createElement('div');
                card.className = `event-prediction-card ${severityClass}`;
                card.innerHTML = `
                    <div class="event-header">
                        <div class="event-type">${event.eventType}</div>
                        <div class="event-probability">${probability}%</div>
                    </div>
                    <div class="event-reasoning">${event.reasoning}</div>
                    <div class="event-details">
                        <span class="event-timestamp">妫€娴嬫椂闂? ${event.timestamp}</span>
                        <span class="event-sensors">鍏宠仈浼犳劅鍣? ${event.relatedSensors.join(', ')}</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // 鏄剧ず鎽勫儚澶?        function displayCameras(cameras) {
            const cameraGrid = document.getElementById('cameraGrid');
            cameraGrid.innerHTML = '';
            
            if (!cameras || cameras.length === 0) {
                cameraGrid.innerHTML = '<div class="no-cameras-message">鏈壘鍒板尮閰嶇殑鎽勫儚澶?/div>';
                return;
            }
            
            cameras.forEach(camera => {
                const cameraItem = document.createElement('div');
                cameraItem.className = 'camera-item';
                cameraItem.dataset.id = camera.id;
                cameraItem.dataset.section = camera.section;
                cameraItem.dataset.status = camera.status;
                
                let statusClass, statusText;
                switch (camera.status) {
                    case 'offline':
                        statusClass = 'camera-offline';
                        statusText = '绂荤嚎';
                        break;
                    case 'warning':
                        statusClass = 'camera-warning';
                        statusText = '璀﹀憡';
                        break;
                    default:
                        statusClass = 'camera-online';
                        statusText = '鍦ㄧ嚎';
                }
                
                // 澧炲姞鎽勫儚澶磋鍥?- 绌虹櫧妗?                cameraItem.innerHTML = `
                    <div class="camera-header">
                        <div class="camera-name">${camera.name}</div>
                        <div class="camera-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="camera-view">
                        <!-- 鎽勫儚澶磋鍥惧尯鍩?-->
                        <div class="camera-placeholder">
                            <div class="camera-no-signal ${camera.status === 'offline' ? 'visible' : ''}">鏃犱俊鍙?/div>
                        </div>
                    </div>
                    <div class="camera-footer">
                        <div class="camera-id">${camera.id}</div>
                        <div class="camera-update">鏇存柊: ${camera.lastUpdate}</div>
                    </div>
                `;
                
                // 娣诲姞鐐瑰嚮浜嬩欢锛屾樉绀鸿鎯?                cameraItem.addEventListener('click', function() {
                    showCameraDetails(camera);
                });
                
                cameraGrid.appendChild(cameraItem);
            });
        }

        // 鏄剧ず鎽勫儚澶磋鎯?        function showCameraDetails(camera) {
            const modal = document.getElementById('cameraDetailModal') || createCameraDetailModal();
            const modalTitle = modal.querySelector('.modal-title');
            const modalBody = modal.querySelector('.modal-body');
            
            modalTitle.textContent = `${camera.name} (${camera.id})`;
            
            let statusClass, statusText;
            switch (camera.status) {
                case 'offline':
                    statusClass = 'badge-danger';
                    statusText = '绂荤嚎';
                    break;
                case 'warning':
                    statusClass = 'badge-warning';
                    statusText = '璀﹀憡';
                    break;
                default:
                    statusClass = 'badge-success';
                    statusText = '鍦ㄧ嚎';
            }
            
            modalBody.innerHTML = `
                <div class="camera-detail-view">
                    <div class="camera-placeholder large">
                        <div class="camera-no-signal ${camera.status === 'offline' ? 'visible' : ''}">鏃犱俊鍙?/div>
                    </div>
                </div>
                <div class="camera-detail-info">
                    <p><strong>ID:</strong> ${camera.id}</p>
                    <p><strong>浣嶇疆:</strong> ${camera.section} - ${camera.position}</p>
                    <p><strong>鐘舵€?</strong> <span class="badge ${statusClass}">${statusText}</span></p>
                    <p><strong>鍏宠仈浼犳劅鍣?</strong> ${camera.sensorId}</p>
                    <p><strong>鏈€鍚庢洿鏂?</strong> ${camera.lastUpdate}</p>
                </div>
                <div class="camera-controls">
                    <button class="btn btn-primary" disabled>鏀惧ぇ</button>
                    <button class="btn btn-primary" disabled>鏃嬭浆</button>
                    <button class="btn btn-primary" disabled>鎴浘</button>
                    <button class="btn btn-primary" disabled>涓嬭浇褰曞儚</button>
                </div>
            `;
            
            // 鏄剧ず妯℃€佹
            $(modal).modal('show');
        }

        // 鍒涘缓鎽勫儚澶磋鎯呮ā鎬佹
        function createCameraDetailModal() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'cameraDetailModal';
            modal.tabIndex = '-1';
            modal.role = 'dialog';
            modal.setAttribute('aria-labelledby', 'cameraDetailModalLabel');
            modal.setAttribute('aria-hidden', 'true');
            
            modal.innerHTML = `
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="cameraDetailModalLabel">鎽勫儚澶磋鎯?/h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- 鍐呭灏嗗姩鎬佸～鍏?-->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">鍏抽棴</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            return modal;
        }

        // 娣诲姞鎽勫儚澶寸浉鍏崇殑CSS鏍峰紡
        function addCameraStyles() {
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                .camera-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                    grid-gap: 20px;
                    margin-top: 20px;
                }
                
                .camera-card {
                    position: relative;
                    border-radius: 6px;
                    overflow: hidden;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    transition: transform 0.2s, box-shadow 0.2s;
                    background-color: #fff;
                }
                
                .camera-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
                }
                
                .camera-feed {
                    height: 180px;
                    position: relative;
                    overflow: hidden;
                    background-color: #eee;
                }
                
                .camera-feed img, .camera-feed canvas {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
                
                .camera-status {
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                    background-color: rgba(0,0,0,0.5);
                    color: white;
                }
                
                .camera-status.online {
                    background-color: rgba(40, 167, 69, 0.8);
                }
                
                .camera-status.offline {
                    background-color: rgba(108, 117, 125, 0.8);
                }
                
                .camera-status.warning {
                    background-color: rgba(255, 193, 7, 0.8);
                }
                
                .camera-info {
                    padding: 12px;
                }
                
                .camera-name {
                    font-weight: bold;
                    margin-bottom: 5px;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
                
                .camera-location {
                    color: #666;
                    font-size: 12px;
                    margin-bottom: 8px;
                }
                
                .camera-metrics {
                    display: flex;
                    justify-content: space-between;
                    font-size: 12px;
                    color: #666;
                }
                
                .camera-timestamp {
                    color: #888;
                    font-style: italic;
                }
                
                .camera-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                    color: white;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    opacity: 0;
                    transition: opacity 0.3s;
                }
                
                .camera-feed:hover .camera-overlay {
                    opacity: 1;
                }
                
                .camera-actions {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                }
                
                .camera-action-btn {
                    background-color: rgba(255,255,255,0.2);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 5px;
                    cursor: pointer;
                    transition: background-color 0.2s;
                }
                
                .camera-action-btn:hover {
                    background-color: rgba(255,255,255,0.4);
                }
                
                .no-data-message {
                    text-align: center;
                    padding: 40px;
                    background-color: #f8f9fa;
                    border-radius: 6px;
                    color: #6c757d;
                    margin-top: 20px;
                }
                
                .offline-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                }
                
                .no-camera-results {
                    text-align: center;
                    padding: 20px;
                    color: #6c757d;
                    display: none;
                }
                
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(styleElement);
        }

        // 娣诲姞鎽勫儚澶存牱寮?        addCameraStyles();

        // 鍒濆鍖栦簨浠堕娴?        function initializeEventPredictions() {
            // 闅忔満鐢熸垚涓€浜涘垵濮嬩簨浠堕娴?            eventPredictions = [];
            
            // 濡傛灉鏈夊紓甯告暟鎹紝鐢熸垚鐩稿簲鐨勪簨浠堕娴?            const abnormalData = sensorData.filter(item => item.status !== 'normal');
            
            if (abnormalData.length > 0) {
                // 鎸変紶鎰熷櫒绫诲瀷鍒嗙粍寮傚父鏁版嵁
                const groupedByType = {};
                abnormalData.forEach(item => {
                    if (!groupedByType[item.sensorType]) {
                        groupedByType[item.sensorType] = [];
                    }
                    groupedByType[item.sensorType].push(item);
                });
                
                // 涓轰富瑕佺殑寮傚父绫诲瀷鍒涘缓浜嬩欢棰勬祴
                Object.keys(groupedByType).forEach(type => {
                    const count = groupedByType[type].length;
                    if (count > 5) { // 鑷冲皯鏈?涓紓甯哥偣鎵嶅垱寤洪娴?                        const locations = [...new Set(groupedByType[type].map(item => item.location))];
                        const sensorIds = [...new Set(groupedByType[type].map(item => item.sensorId))].slice(0, 3);
                        let eventType, reasoning, severity;
                        
                        switch(type) {
                            case '娓╁害':
                                eventType = '娓╁害寮傚父娉㈠姩';
                                reasoning = `${locations.join('銆?)}娓╁害浼犳劅鍣ㄦ暟鎹嚭鐜伴潪姝ｅ父娉㈠姩锛屽彲鑳藉彈鐜鍥犵礌褰卞搷`;
                                severity = 'medium';
                                break;
                            case '搴斿彉':
                                eventType = '缁撴瀯搴斿彉寮傚父';
                                reasoning = `${locations.join('銆?)}搴斿彉浼犳劅鍣ㄦ暟鎹寔缁亸楂橈紝缁撴瀯鎵垮彈鍘嬪姏寮傚父`;
                                severity = 'high';
                                break;
                            case '鎸姩':
                                eventType = '寮傚父鎸姩';
                                reasoning = `${locations.join('銆?)}鎸姩浼犳劅鍣ㄦ娴嬪埌瓒呭嚭姝ｅ父鑼冨洿鐨勬尟鍔╜;
                                severity = 'medium';
                                break;
                            case '鍊捐':
                                eventType = '缁撴瀯鍊炬枩';
                                reasoning = `${locations.join('銆?)}鍊捐浼犳劅鍣ㄦ暟鎹樉绀虹粨鏋勮搴﹀紓甯竊;
                                severity = 'high';
                                break;
                            case '浣嶇Щ':
                                eventType = '缁撴瀯浣嶇Щ寮傚父';
                                reasoning = `${locations.join('銆?)}浣嶇Щ浼犳劅鍣ㄦ樉绀烘ˉ姊侀儴浠跺嚭鐜板紓甯哥Щ鍔╜;
                                severity = 'high';
                                break;
                            case '杞介噸':
                                eventType = '璐熻浇杩囬珮';
                                reasoning = `${locations.join('銆?)}杞介噸浼犳劅鍣ㄦ樉绀烘ˉ姊佹壙鍙楀帇鍔涜秴鍑哄畨鍏ㄨ寖鍥碻;
                                severity = 'medium';
                                break;
                            default:
                                eventType = `${type}鏁版嵁寮傚父`;
                                reasoning = `${locations.join('銆?)}${type}浼犳劅鍣ㄦ暟鎹嚭鐜板紓甯告尝鍔╜;
                                severity = 'low';
                        }
                        
                        eventPredictions.push({
                            id: Date.now() + Math.random(),
                            eventType: eventType,
                            probability: 0.5 + Math.random() * 0.4,
                            reasoning: reasoning,
                            timestamp: new Date().toLocaleString('zh-CN'),
                            severity: severity,
                            relatedSensors: sensorIds
                        });
                    }
                });
            }
            
            // 濡傛灉娌℃湁鍩轰簬鏁版嵁鐢熸垚鐨勯娴嬶紝鍒欑敓鎴愪竴涓?姝ｅ父杩愯"鐨勯娴?            if (eventPredictions.length === 0) {
                eventPredictions.push({
                    id: Date.now(),
                    eventType: '姝ｅ父杩愮淮涓?,
                    probability: 0.95,
                    reasoning: '鎵€鏈変紶鎰熷櫒鏁版嵁鍦ㄦ甯歌寖鍥村唴锛屾棤寮傚父妯″紡',
                    timestamp: new Date().toLocaleString('zh-CN'),
                    severity: 'low',
                    relatedSensors: ['绯荤粺鐘舵€?]
                });
            }
            
            // 鏄剧ず浜嬩欢棰勬祴
            displayEventPredictions();
        }

        // 鎼滅储鍜岀瓫閫夋憚鍍忓ご
        function searchAndFilterCameras() {
            const searchTerm = document.getElementById('camera-search').value.toLowerCase();
            const statusFilter = document.getElementById('camera-filter').value;
            const sectionFilter = document.getElementById('section-filter').value;
            
            const filteredCameras = allCameras.filter(camera => {
                // 鎼滅储鏉′欢
                const matchesSearch = 
                    camera.name.toLowerCase().includes(searchTerm) ||
                    camera.id.toLowerCase().includes(searchTerm) ||
                    camera.sensorId.toLowerCase().includes(searchTerm);
                
                // 鐘舵€佺瓫閫?                const matchesStatus = 
                    statusFilter === 'all' || 
                    (statusFilter === 'online' && camera.status === 'online') ||
                    (statusFilter === 'offline' && camera.status === 'offline') ||
                    (statusFilter === 'warning' && camera.status === 'warning');
                
                // 鍖烘绛涢€?                const matchesSection = 
                    sectionFilter === 'all' ||
                    (sectionFilter === 'north' && camera.section === '鍖楁') ||
                    (sectionFilter === 'center' && camera.section === '涓') ||
                    (sectionFilter === 'south' && camera.section === '鍗楁') ||
                    (sectionFilter === 'east' && camera.section === '涓滄') ||
                    (sectionFilter === 'west' && camera.section === '瑗挎');
                
                return matchesSearch && matchesStatus && matchesSection;
            });
            
            displayCameras(filteredCameras);
        }

        // 妯℃嫙鎵撳紑鎽勫儚澶寸洿鎾?        function openCameraFeed(cameraId) {
            const camera = allCameras.find(cam => cam.id === cameraId);
            if (!camera) return;
            
            if (camera.status === 'offline') {
                alert(`鏃犳硶杩炴帴鎽勫儚澶?${camera.id}锛氳澶囩绾縛);
                return;
            }
            
            alert(`姝ｅ湪杩炴帴鍒版憚鍍忓ご锛?{camera.name}\n浼犳劅鍣↖D锛?{camera.sensorId}`);
            // 杩欓噷鍙互瀹炵幇瀹為檯鐨勬憚鍍忓ご杩炴帴閫昏緫
        }

        // 闅忔満鏇存柊浼犳劅鍣ㄦ暟鎹?        function randomlyUpdateData() {
            if (!sensorData || sensorData.length === 0) return;
            
            // 鑾峰彇褰撳墠鏃堕棿浣滀负鏂扮殑鏁版嵁鐐规椂闂存埑
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // 鑾峰彇鍞竴鐨勪紶鎰熷櫒ID鍒楄〃
            const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
            
            // 鍒涘缓鐜鍥犵礌锛岀‘淇濇暟鎹箣闂寸殑鍏宠仈鎬?            const environmentalFactor = Math.sin(Date.now() / 10000000) * 0.15; // 缂撴參鍙樺寲鐨勭幆澧冨洜绱?            const timeOfDayFactor = Math.sin(now.getHours() / 24 * Math.PI) * 0.1; // 鏃ラ棿鍙樺寲鍥犵礌
            const bridgeLoadFactor = Math.sin(Date.now() / 3600000) * 0.08; // 妗ユ璐熻浇鍙樺寲
            
            // 鍏ㄥ眬娓╁害褰卞搷
            const temperature = 20 + Math.sin(now.getHours() / 24 * Math.PI * 2) * 5 + Math.random() * 2;
            
            // 涓烘瘡涓紶鎰熷櫒鍒涘缓鏂扮殑鏁版嵁鐐?            uniqueSensors.forEach(sensorId => {
                // 鑾峰彇璇ヤ紶鎰熷櫒鐨勫巻鍙叉暟鎹?                const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                const currentValue = sensorPoints[sensorPoints.length - 1].value;
                
                // 鏍规嵁浼犳劅鍣↖D鍒嗘瀽浼犳劅鍣ㄧ被鍨嬪拰鍖烘
                let sensorType = '鍏朵粬';
                let sensorLocation = '涓';
                
                if (sensorId.includes('娓╁害')) sensorType = '娓╁害';
                else if (sensorId.includes('搴斿彉')) sensorType = '搴斿彉';
                else if (sensorId.includes('鎸姩')) sensorType = '鎸姩';
                else if (sensorId.includes('鍊捐')) sensorType = '鍊捐';
                
                for (const section of ['鍖楁', '涓', '鍗楁', '涓滄', '瑗挎']) {
                    if (sensorId.includes(section)) {
                        sensorLocation = section;
                        break;
                    }
                }
                
                // 璁＄畻鍖烘闂寸殑"璺濈"浠ョ‘淇濈浉閭诲尯娈电殑鏁版嵁瓒嬪娍鐩镐技
                function getSectionDistance(section1, section2) {
                    const sections = ['鍖楁', '涓', '鍗楁', '涓滄', '瑗挎'];
                    const idx1 = sections.indexOf(section1);
                    const idx2 = sections.indexOf(section2);
                    return Math.abs(idx1 - idx2);
                }
                
                // 鏍规嵁浼犳劅鍣ㄧ被鍨嬭幏鍙栨暟鎹寖鍥?                const range = sensorRanges[sensorType] || sensorRanges['鍏朵粬'];
                
                // 璁＄畻鍩虹鍙樺寲閲?                let baseChange = 0;
                let multiplier = 1.0;
                
                // 鍩虹闅忔満娉㈠姩 (灏忓箙)
                const randomFactor = (Math.random() * 2 - 1) * 0.01 * currentValue;
                
                // 鐜鍥犵礌褰卞搷
                let environmentalImpact = 0;
                if (sensorType === '娓╁害') {
                    environmentalImpact = environmentalFactor * 1.2 + (temperature - 20) * 0.1;
                } else if (sensorType === '搴斿彉') {
                    environmentalImpact = bridgeLoadFactor * 1.5 + timeOfDayFactor * 0.5;
                } else if (sensorType === '鎸姩') {
                    environmentalImpact = bridgeLoadFactor * 1.2 + environmentalFactor * 0.8;
                } else if (sensorType === '鍊捐') {
                    environmentalImpact = bridgeLoadFactor * 0.9 + environmentalFactor * 1.1;
                } else {
                    environmentalImpact = environmentalFactor * 0.8 + timeOfDayFactor * 0.7;
                }
                
                // 鎬诲彉鍖栭噺 = 鐜褰卞搷 + 闅忔満鍣０
                baseChange = (environmentalImpact * currentValue * 0.05) + randomFactor;
                
                // 搴旂敤褰卞搷鍥犲瓙
                baseChange *= multiplier;
                
                // 璁＄畻鏂板€?                let newValue = currentValue + baseChange;
                
                // 纭繚鏂板€煎湪鍚堢悊鑼冨洿鍐?                const minValue = range.normal[0] * 0.9;
                const maxValue = range.normal[1] * 1.1;
                
                if (newValue < minValue) newValue = minValue + Math.random() * (range.normal[0] - minValue);
                if (newValue > maxValue) newValue = maxValue - Math.random() * (maxValue - range.normal[1]);
                
                // 纭繚鏁版嵁鐨勮繛缁€?                const maxChange = currentValue * 0.15; // 鏈€澶у厑璁?5%鐨勫彉鍖?                if (Math.abs(newValue - currentValue) > maxChange) {
                    newValue = currentValue + (Math.sign(newValue - currentValue) * maxChange * Math.random());
                }
                
                // 纭畾浼犳劅鍣ㄧ姸鎬?                let status = 'normal';
                if (newValue > range.warning[1] || newValue < range.warning[0]) {
                    status = 'warning';
                }
                if (newValue > range.danger[1] || newValue < range.danger[0]) {
                    status = 'danger';
                }
                
                // 鍒涘缓鏂扮殑鏁版嵁鐐?                const newDataPoint = {
                    timestamp: timeStr,
                    sensorId: sensorId,
                    value: newValue,
                    status: status
                };
                
                // 娣诲姞鍒版暟鎹泦
                sensorData.push(newDataPoint);
                
                // 鏇存柊UI
                addDataToTable(newDataPoint);
                
                // 鏇存柊鍥捐〃
                updateCharts();
                
                // 鏇存柊鐩稿叧鎽勫儚澶寸姸鎬?                updateCameraStatus(sensorId, status);
            });
            
            // 浜嬩欢棰勬祴姒傜巼鏇存柊
            updateEventPredictions();
            
            // 闄愬埗鏁版嵁鐐规暟閲忥紝淇濈暀鏈€杩戠殑2000涓暟鎹偣
            if (sensorData.length > 2000) {
                sensorData = sensorData.slice(sensorData.length - 2000);
                refreshTable();
            }
        }

        // 鏇存柊浜嬩欢棰勬祴姒傜巼
        function updateEventPredictions() {
            // 鏍规嵁浼犳劅鍣ㄦ暟鎹洿鏂颁簨浠堕娴嬫鐜?            eventPredictions.forEach(prediction => {
                // 妫€鏌ョ浉鍏充紶鎰熷櫒鐨勬渶鏂扮姸鎬?                const relevantSensors = prediction.relatedSensors;
                let abnormalCount = 0;
                
                relevantSensors.forEach(sensorId => {
                    const sensorData = findLastSensorData(sensorId);
                    if (sensorData && (sensorData.status === 'warning' || sensorData.status === 'danger')) {
                        abnormalCount++;
                    }
                });
                
                // 鏇存柊姒傜巼锛堝紓甯镐紶鎰熷櫒瓒婂锛屾鐜囪秺楂橈級
                const ratio = abnormalCount / relevantSensors.length;
                // 澧炲姞涓€浜涢殢鏈烘尝鍔ㄤ娇棰勬祴鏄惧緱鏇磋嚜鐒?                const randomFactor = Math.random() * 0.1 - 0.05;
                
                prediction.probability = Math.max(0.1, Math.min(0.95, prediction.probability * 0.6 + ratio * 0.4 + randomFactor));
                
                // 鏇存柊鏃堕棿鎴?                prediction.timestamp = new Date().toLocaleString('zh-CN');
                
                // 鏇存柊涓ラ噸绋嬪害
                if (prediction.probability > 0.75) {
                    prediction.severity = 'high';
                } else if (prediction.probability > 0.5) {
                    prediction.severity = 'medium';
                } else {
                    prediction.severity = 'low';
                }
            });
            
            // 鍒锋柊棰勬祴鏄剧ず
            displayEventPredictions();
        }

        // 鏌ユ壘浼犳劅鍣ㄦ渶鏂版暟鎹?        function findLastSensorData(sensorId) {
            const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
            if (sensorPoints.length > 0) {
                return sensorPoints[sensorPoints.length - 1];
            }
            return null;
        }

        // 鏇存柊鎽勫儚澶寸姸鎬?        function updateCameraStatus(sensorId, sensorStatus) {
            // 鏌ユ壘涓庤浼犳劅鍣ㄥ叧鑱旂殑鎵€鏈夋憚鍍忓ご
            const relatedCameras = allCameras.filter(cam => cam.sensorId === sensorId);
            
            if (relatedCameras.length === 0) return;
            
            // 鏍规嵁浼犳劅鍣ㄧ姸鎬佹洿鏂版憚鍍忓ご鐘舵€?            relatedCameras.forEach(camera => {
                // 鍙湁褰撴憚鍍忓ご涓嶆槸绂荤嚎鐘舵€佹椂鎵嶈繘琛屾洿鏂?                if (camera.status !== 'offline') {
                    if (sensorStatus === 'danger') {
                        camera.status = 'warning'; // 浼犳劅鍣ㄥ憡璀︽椂锛屾憚鍍忓ご鐘舵€佽涓鸿鍛?                    } else {
                        // 80%鐨勬鐜囦繚鎸佸師鐘舵€侊紝20%鐨勬鐜囨洿鏂颁负浼犳劅鍣ㄧ姸鎬?                        if (Math.random() > 0.8) {
                            camera.status = sensorStatus === 'warning' ? 'warning' : 'online';
                        }
                    }
                    camera.lastUpdate = new Date().toLocaleString('zh-CN');
                }
            });
            
            // 鏇存柊鎽勫儚澶存樉绀?            displayCameras();
        }

        // 鏂囨。鍔犺浇瀹屾垚鍚庣殑鍒濆鍖?        document.addEventListener('DOMContentLoaded', function() {
            console.log("椤甸潰宸插姞杞斤紝寮€濮嬪垵濮嬪寲...");
            
            // 妫€鏌ョ櫥褰曠姸鎬?            checkLoginStatus();
            
            // 鍒濆鍖栧叾浠栧姛鑳?..
            
            // 缁戝畾鐧诲綍鎸夐挳浜嬩欢
            if (loginButton) {
                loginButton.addEventListener('click', handleLogin);
            } else {
                console.warn("鎵句笉鍒扮櫥褰曟寜閽紝璇锋鏌TML缁撴瀯");
            }
            
            // 缁戝畾鐧诲嚭鎸夐挳浜嬩欢
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }
            
            // 濡傛灉鎵惧埌鐧诲綍琛ㄥ崟锛岀粦瀹氬洖杞﹂敭鐧诲綍鍔熻兘
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            }
            
            // ... 鍏朵粬鍒濆鍖栦唬鐮?...
        });

        // 鍦ㄩ〉闈㈠姞杞芥椂鍒濆鍖栦簨浠堕娴嬪尯鍩?        function initEventPredictionArea() {
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) return;
            
            // 鍒涘缓浜嬩欢棰勬祴瀹瑰櫒
            const eventArea = document.createElement('div');
            eventArea.className = 'event-prediction-area';
            eventArea.innerHTML = `
                <div class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>浜嬩欢棰勬祴</span>
                </div>
                <div id="event-prediction-container" class="prediction-container">
                    <div class="no-predictions">鏆傛棤寮傚父浜嬩欢棰勬祴</div>
                </div>
            `;
            
            // 灏嗕簨浠堕娴嬪尯鍩熸彃鍏ュ埌涓诲唴瀹瑰尯鍩熺殑鏈€鍓嶉潰
            mainContent.insertBefore(eventArea, mainContent.firstChild);
            
            // 娣诲姞浜嬩欢棰勬祴鐩稿叧鐨凜SS
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                .event-prediction-area {
                    margin-bottom: 20px;
                    background-color: #fff;
                    border-radius: 8px;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                    padding: 15px;
                }
                
                .prediction-container {
                    margin-top: 10px;
                }
                
                .no-predictions {
                    color: #888;
                    text-align: center;
                    padding: 10px;
                }
                
                .event-prediction-card {
                    padding: 12px;
                    border-radius: 6px;
                    margin-bottom: 10px;
                    border-left: 4px solid #5cb85c;
                    background-color: #f9f9f9;
                }
                
                .event-prediction-card.severity-high {
                    border-left-color: #d9534f;
                }
                
                .event-prediction-card.severity-medium {
                    border-left-color: #f0ad4e;
                }
                
                .event-prediction-card.severity-low {
                    border-left-color: #5bc0de;
                }
                
                .event-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 8px;
                }
                
                .event-type {
                    font-weight: bold;
                    font-size: 16px;
                }
                
                .event-probability {
                    font-weight: bold;
                    color: #d9534f;
                }
                
                .event-reasoning {
                    margin-bottom: 10px;
                    line-height: 1.4;
                }
                
                .event-details {
                    display: flex;
                    flex-direction: column;
                    font-size: 12px;
                    color: #777;
                }
                
                .event-timestamp, .event-sensors {
                    margin-bottom: 2px;
                }
            `;
            document.head.appendChild(styleElement);
        }

        // 鍒濆鍖栦簨浠堕娴嬫暟鎹?        let eventPredictions = []; 

        // 娣诲姞鎽勫儚澶存牱寮?        addCameraStyles();

        // 娣诲姞浜嬩欢棰勬祴鏍峰紡
        function addEventPredictionStyles() {
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                .event-predictions-section {
                    margin-top: 10px;
                }
                
                .no-predictions {
                    color: #888;
                    text-align: center;
                    padding: 10px;
                }
                
                .event-prediction-card {
                    padding: 12px;
                    border-radius: 6px;
                    margin-bottom: 10px;
                    border-left: 4px solid #5cb85c;
                    background-color: #f9f9f9;
                }
                
                .event-prediction-card.severity-high {
                    border-left-color: #d9534f;
                }
                
                .event-prediction-card.severity-medium {
                    border-left-color: #f0ad4e;
                }
                
                .event-prediction-card.severity-low {
                    border-left-color: #5bc0de;
                }
                
                .event-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 8px;
                }
                
                .event-type {
                    font-weight: bold;
                    font-size: 16px;
                }
                
                .event-probability {
                    font-weight: bold;
                    color: #d9534f;
                }
                
                .event-reasoning {
                    margin-bottom: 10px;
                    line-height: 1.4;
                }
                
                .event-details {
                    display: flex;
                    flex-direction: column;
                    font-size: 12px;
                    color: #777;
                }
                
                .event-timestamp, .event-sensors {
                    margin-bottom: 2px;
                }
            `;
            document.head.appendChild(styleElement);
        }

        // 娣诲姞鎽勫儚澶存牱寮?        addCameraStyles();
    </script>
</body>
</html> 
