<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈªëÈæôÊ±üÂ§ßÊ°•ÁõëÊµãÁ≥ªÁªü</title>
    <!-- Ê∑ªÂä†ÁΩëÈ°µÂõæÊ†á -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåâ</text></svg>">
    <!-- ÂºïÂÖ•Chart.jsÂ∫ìÁî®‰∫éÊï∞ÊçÆÂèØËßÜÂåñ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- ÂºïÂÖ•Material IconsÂ∫ì -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f9fc;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #2c5282, #1a365d);
            color: white;
            padding: 20px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        .header-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c5282;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .logout-btn {
            background-color: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .logout-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }
        /* ÁôªÂΩïÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .login-container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            width: 350px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h2 {
            color: #007aff;
            margin: 0;
        }
        .login-form .form-group {
            margin-bottom: 20px;
        }
        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .login-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .login-form .login-button {
            background-color: #007aff;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 4px;
            width: 100%;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .login-form .login-button:hover {
            background-color: #0056b3;
        }
        .error-message {
            color: #dc3545;
            margin-top: 10px;
            text-align: center;
        }
        /* Ê°•Ê¢ÅÁ§∫ÊÑèÂõæÊ†∑Âºè */
        .bridge-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
            position: relative;
            height: 300px;
            overflow: hidden;
        }
        .bridge {
            position: relative;
            height: 100%;
            width: 100%;
        }
        .bridge-deck {
            position: absolute;
            bottom: 120px;
            left: 5%;
            width: 90%;
            height: 20px;
            background-color: #6c757d;
        }
        .bridge-pier {
            position: absolute;
            bottom: 0;
            width: 40px;
            height: 120px;
            background-color: #495057;
        }
        .bridge-pier:nth-child(1) {
            left: 10%;
        }
        .bridge-pier:nth-child(2) {
            left: 50%;
            transform: translateX(-50%);
        }
        .bridge-pier:nth-child(3) {
            right: 10%;
        }
        .sensor-point {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #28a745;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
            cursor: pointer;
        }
        .sensor-point:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 10;
        }
        .sensor-point.warning {
            background-color: #ffc107;
        }
        .sensor-point.danger {
            background-color: #dc3545;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        .sensor-tooltip {
            position: absolute;
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid rgba(0,0,0,0.03);
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 18px;
            color: #2c5282;
            border-bottom: 1px solid #edf2f7;
            padding-bottom: 12px;
            display: flex;
            align-items: center;
        }
        .card-title::before {
            content: "";
            display: inline-block;
            width: 4px;
            height: 18px;
            background-color: #2c5282;
            margin-right: 10px;
            border-radius: 2px;
        }
        .example-file-link {
            margin-top: 12px;
            display: block;
            font-size: 14px;
            color: #2c5282;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            background-color: #edf2f7;
            transition: all 0.2s;
            width: fit-content;
        }
        .example-file-link:hover {
            background-color: #e2e8f0;
            text-decoration: none;
            transform: translateY(-2px);
        }
        .file-format-info {
            background-color: #f8fafc;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 13px;
            border-left: 3px solid #2c5282;
        }
        .upload-area {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .file-input-container {
            position: relative;
            margin-right: 15px;
            margin-bottom: 10px;
        }
        .custom-file-input {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
        }
        .custom-file-input:hover {
            background-color: #e0e0e0;
        }
        #fileInput {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .button {
            background-color: #2c5282;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        .button:hover {
            background-color: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.12);
        }
        .button:active {
            transform: translateY(0);
        }
        .button.secondary {
            background-color: #718096;
        }
        .button.secondary:hover {
            background-color: #4a5568;
        }
        .button.danger {
            background-color: #e53e3e;
        }
        .button.danger:hover {
            background-color: #c53030;
        }
        .button .material-icons {
            font-size: 16px;
            margin-right: 6px;
        }
        .button:disabled {
            background-color: #cbd5e0;
            color: #718096;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .data-table-container {
            overflow-x: auto;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .data-table th, .data-table td {
            border: 1px solid #edf2f7;
            padding: 10px 14px;
            text-align: left;
        }
        .data-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #4a5568;
        }
        .data-table tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .data-table tr:hover {
            background-color: #ebf4ff;
        }
        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }
        .result-area {
            margin-top: 30px;
        }
        .anomaly-list {
            list-style-type: none;
            padding: 0;
        }
        .anomaly-item {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .anomaly-item.severe {
            background-color: #f8d7da;
            border-left-color: #dc3545;
        }
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            margin-right: 5px;
        }
        .status-normal {
            background-color: #28a745;
        }
        .status-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .status-danger {
            background-color: #dc3545;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 24px;
            background-color: white;
            border-radius: 8px 8px 0 0;
            padding: 0 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .tab {
            padding: 16px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.2s;
            position: relative;
            display: flex;
            align-items: center;
        }
        .tab:hover {
            color: #2c5282;
        }
        .tab.active {
            border-bottom-color: #2c5282;
            color: #2c5282;
            font-weight: 600;
        }
        .tab.active::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: #2c5282;
            border-radius: 50%;
        }
        .tab-content {
            display: none;
            background-color: white;
            border-radius: 0 0 8px 8px;
            padding: 10px 0;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content.active {
            display: block;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007aff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .analysis-summary {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .info-text {
            color: #6c757d;
            font-size: 14px;
            margin: 10px 0;
        }
        .anomaly-count {
            font-size: 24px;
            font-weight: bold;
            color: #dc3545;
            margin-right: 5px;
        }
        .no-data-message {
            text-align: center;
            padding: 30px;
            color: #6c757d;
        }
        .camera-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .camera-item {
            width: calc(25% - 15px);
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 5px;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .camera-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .camera-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .camera-name {
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .camera-status {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            white-space: nowrap;
        }
        .sensor-id {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 4px;
            display: inline-block;
        }
        .online {
            background-color: #28a745;
            color: white;
        }
        .offline {
            background-color: #dc3545;
            color: white;
        }
        .warning {
            background-color: #ffc107;
            color: #212529;
        }
        .camera-view {
            position: relative;
            height: 160px;
            background-color: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
        .camera-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
        }
        .camera-icon {
            font-size: 36px;
            margin-bottom: 10px;
            color: #6c757d;
        }
        .camera-message {
            font-size: 12px;
            text-align: center;
            padding: 0 10px;
        }
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .camera-view:hover .camera-overlay {
            opacity: 1;
        }
        .camera-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        .camera-control-btn {
            background-color: rgba(255,255,255,0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin: 0 2px;
            font-size: 12px;
        }
        .camera-control-btn:hover {
            background-color: rgba(255,255,255,1);
        }
        .camera-info {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .camera-alert {
            color: #007aff;
            font-size: 14px;
            margin-top: 10px;
        }
        .location-tag {
            font-size: 11px;
            color: #6c757d;
            margin-top: 4px;
            margin-bottom: 5px;
            display: block;
        }
        /* ÂàóË°®ËßÜÂõæÊ†∑Âºè */
        .camera-list {
            display: none;
            flex-direction: column;
            gap: 10px;
        }
        .camera-list-item {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px 15px;
        }
        .camera-list-icon {
            width: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 24px;
        }
        .camera-list-info {
            flex-grow: 1;
        }
        .camera-list-actions {
            display: flex;
            gap: 10px;
        }
        .event-status-display {
            padding: 10px 0;
        }
        .event-status-header {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 10px;
        }
        .event-details {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #2c5282;
            transition: all 0.3s ease;
        }
        #currentEventName {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        #currentEventDescription {
            color: #4a5568;
            margin-bottom: 10px;
        }
        .event-progress-container {
            margin-top: 10px;
        }
        .event-progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .event-progress {
            height: 100%;
            background-color: #2c5282;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .event-progress-text {
            text-align: right;
            font-size: 12px;
            color: #718096;
        }
        .event-alert {
            background-color: #fed7d7;
            border-left: 3px solid #e53e3e;
        }
        .event-alert #currentEventName {
            color: #c53030;
        }
        .event-alert .event-progress {
            background-color: #e53e3e;
        }
        .event-warning {
            background-color: #feebc8;
            border-left: 3px solid #dd6b20;
        }
        .event-warning #currentEventName {
            color: #c05621;
        }
        .event-warning .event-progress {
            background-color: #dd6b20;
        }
        .event-controls {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .event-controls h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #2d3748;
            font-size: 16px;
        }
        .event-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .event-buttons button {
            padding: 6px 12px;
            background-color: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .event-buttons button:hover {
            background-color: #e2e8f0;
        }
        .event-buttons button.active {
            background-color: #4299e1;
            color: white;
            border-color: #3182ce;
        }
        .chart-control-btn {
            transition: all 0.2s ease;
        }
        .chart-control-btn:hover {
            opacity: 0.9;
        }
        .chart-control-btn.active {
            background-color: #4299e1 !important;
            color: white !important;
            border-color: #3182ce !important;
        }
        /* ‰∫ã‰ª∂Áä∂ÊÄÅÊòæÁ§∫Ê†∑Âºè */
        .event-status-display {
            padding: 10px 0;
        }
        .event-status-header {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 10px;
        }
        .event-details {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #2c5282;
            transition: all 0.3s ease;
        }
        #currentEventName {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        #currentEventDescription {
            color: #4a5568;
            margin-bottom: 10px;
        }
        .event-progress-container {
            margin-top: 10px;
        }
        .event-progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .event-progress {
            height: 100%;
            background-color: #2c5282;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .event-progress-text {
            text-align: right;
            font-size: 12px;
            color: #718096;
        }
        .event-alert {
            background-color: #fed7d7;
            border-left: 3px solid #e53e3e;
        }
        .event-alert #currentEventName {
            color: #c53030;
        }
        .event-alert .event-progress {
            background-color: #e53e3e;
        }
        .event-warning {
            background-color: #feebc8;
            border-left: 3px solid #dd6b20;
        }
        .event-warning #currentEventName {
            color: #c05621;
        }
        .event-warning .event-progress {
            background-color: #dd6b20;
        }
        .event-controls {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .event-controls h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #2d3748;
            font-size: 16px;
        }
        .event-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .event-buttons button {
            padding: 6px 12px;
            background-color: #edf2f7;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .event-buttons button:hover {
            background-color: #e2e8f0;
        }
        .event-buttons button.active {
            background-color: #4299e1;
            color: white;
            border-color: #3182ce;
        }
        /* ÂéÜÂè≤ËÆ∞ÂΩïÂå∫ÂüüÊ†∑Âºè */
        .history-section {
            margin-bottom: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 15px;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .history-header h3 {
            margin: 0;
            font-size: 16px;
            color: #2d3748;
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-item {
            padding: 10px;
            border-left: 3px solid #4299e1;
            background-color: #f8fafc;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .history-item:hover {
            background-color: #edf2f7;
        }
        .history-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .history-item-title {
            font-weight: 500;
        }
        .history-item-time {
            font-size: 12px;
            color: #718096;
        }
        .history-item-stats {
            font-size: 13px;
            color: #4a5568;
        }
        .no-history-message {
            text-align: center;
            padding: 20px;
            color: #a0aec0;
        }
        .button.small {
            padding: 6px 12px;
            font-size: 12px;
        }
        /* Ê∑ªÂä†Êñ∞ÁöÑCSSÊ†∑Âºè */
        .event-prediction-area {
            margin-bottom: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e9ecef;
        }
        .event-prediction-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .event-prediction-header .material-icons {
            margin-right: 10px;
            color: #e53e3e;
        }
        .event-prediction-header h3 {
            margin: 0;
            color: #2d3748;
            font-size: 18px;
        }
        .prediction-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid #718096;
        }
        .prediction-item.high {
            border-left-color: #e53e3e;
        }
        .prediction-item.medium {
            border-left-color: #dd6b20;
        }
        .prediction-item.low {
            border-left-color: #3182ce;
        }
        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .prediction-type {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
        }
        .prediction-type .material-icons {
            margin-right: 8px;
        }
        .prediction-probability {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }
        .prediction-probability.high {
            background-color: #e53e3e;
        }
        .prediction-probability.medium {
            background-color: #dd6b20;
        }
        .prediction-probability.low {
            background-color: #3182ce;
        }
        .prediction-details {
            margin-bottom: 10px;
        }
        .prediction-reasoning {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 5px;
        }
        .prediction-timestamp {
            font-size: 12px;
            color: #718096;
        }
        .prediction-sensors {
            font-size: 13px;
            color: #4a5568;
            background-color: #f7fafc;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .no-prediction-message {
            text-align: center;
            padding: 20px;
            color: #718096;
            font-style: italic;
        }
        .search-filter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .search-box {
            position: relative;
            width: 300px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 35px;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            font-size: 14px;
        }
        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }
        .filter-controls {
            display: flex;
            gap: 10px;
        }
        .filter-controls select {
            padding: 8px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
        }
        .camera-last-update {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }
        .no-cameras-message {
            text-align: center;
            padding: 30px;
            color: #718096;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ÈªëÈæôÊ±üÂ§ßÊ°•ÁõëÊµãÁ≥ªÁªü</h1>
        <div class="header-subtitle">Ê°•Ê¢ÅÁªìÊûÑÂºÇÂ∏∏Ê£ÄÊµãÁ≥ªÁªü</div>
        <div class="user-info" id="userInfoDisplay" style="display:none;">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">Áî®Êà∑</span>
            <button class="logout-btn" id="logoutButton">ÈÄÄÂá∫</button>
        </div>
    </div>

    <!-- ‰∫ã‰ª∂È¢ÑÊµãÂå∫Âüü - ÁßªÂà∞È°∂ÈÉ® -->
    <div class="container">
        <div class="event-prediction-area">
            <div class="event-prediction-header">
                <span class="material-icons">warning</span>
                <h3>‰∫ã‰ª∂È¢ÑÊµã</h3>
            </div>
            <div class="event-prediction-content" id="eventPredictionContent">
                <div class="no-prediction-message">
                    Á≥ªÁªüÊ≠£Âú®ÂÆûÊó∂ÂàÜÊûê‰º†ÊÑüÂô®Êï∞ÊçÆÔºåÊöÇÊó†ÂºÇÂ∏∏‰∫ã‰ª∂È¢ÑÊµã
                </div>
                <!-- ‰∫ã‰ª∂È¢ÑÊµãÈ°πÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>

    <!-- ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <div class="login-header">
                <h2>Á≥ªÁªüÁôªÂΩï</h2>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Áî®Êà∑Âêç</label>
                    <input type="text" id="username" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç">
                </div>
                <div class="form-group">
                    <label for="password">ÂØÜÁ†Å</label>
                    <input type="password" id="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                </div>
                <button class="login-button" id="loginButton">ÁôªÂΩï</button>
                <div class="error-message" id="loginError"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-title">Êï∞ÊçÆ‰∏ä‰º†‰∏éÂàÜÊûê</div>
            <div class="upload-area">
                <div class="file-input-container">
                    <div class="custom-file-input">
                        <span class="material-icons">cloud_upload</span>
                        ÈÄâÊã©Êñá‰ª∂
                    </div>
                    <input type="file" id="fileInput" accept=".txt,.csv">
                </div>
                <button class="button" id="uploadButton">
                    <span class="material-icons">publish</span>
                    ‰∏ä‰º†Êï∞ÊçÆ
                </button>
                <button class="button secondary" id="resetButton">
                    <span class="material-icons">restart_alt</span>
                    ÈáçÁΩÆ
                </button>
                <button class="button" id="detectButton" disabled>
                    <span class="material-icons">search</span>
                    ÂºÄÂßãÊ£ÄÊµã
                </button>
                <button class="button secondary" id="sampleButton">
                    <span class="material-icons">data_object</span>
                    ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆ
                </button>
                <button class="button secondary" id="refreshButton">
                    <span class="material-icons">autorenew</span>
                    ÈöèÊú∫Âà∑Êñ∞Êï∞ÊçÆ
                </button>
            </div>
            <div class="info-text" id="fileInfo">Êú™ÈÄâÊã©Êñá‰ª∂</div>
            <a href="#" id="downloadExample" class="example-file-link">
                <span class="material-icons" style="font-size:16px;vertical-align:middle;">file_download</span> 
                ‰∏ãËΩΩÊï∞ÊçÆÊ†ºÂºèÁ§∫‰æãÊñá‰ª∂
            </a>
            <div class="file-format-info">
                <strong>ÊîØÊåÅÁöÑÊñá‰ª∂Ê†ºÂºè:</strong>
                <ul style="margin-top: 5px; margin-bottom: 5px;">
                    <li>CSVÊ†ºÂºè: Êó∂Èó¥Êà≥,‰º†ÊÑüÂô®ID,Êï∞ÂÄº (ÊØèË°å‰∏ÄÊù°ËÆ∞ÂΩï)</li>
                    <li>TXTÊ†ºÂºè: Êó∂Èó¥Êà≥,Êï∞ÂÄº (ÊØèË°å‰∏ÄÊù°ËÆ∞ÂΩïÔºåËá™Âä®ÂàÜÈÖç‰º†ÊÑüÂô®ID)</li>
                </ul>
                <div>Á§∫‰æã: 2023-06-15 14:30,‰º†ÊÑüÂô®A,23.45</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="data">
                <span class="material-icons" style="margin-right:8px;">table_chart</span>
                Êï∞ÊçÆÊü•Áúã
            </div>
            <div class="tab" data-tab="visualization">
                <span class="material-icons" style="margin-right:8px;">bar_chart</span>
                Êï∞ÊçÆÂèØËßÜÂåñ
            </div>
            <div class="tab" data-tab="analysis">
                <span class="material-icons" style="margin-right:8px;">analytics</span>
                ÂºÇÂ∏∏Ê£ÄÊµãÁªìÊûú
            </div>
            <div class="tab" data-tab="monitor">
                <span class="material-icons" style="margin-right:8px;">videocam</span>
                ÂºÇÂ∏∏ÁõëÊéß
            </div>
        </div>

        <div class="tab-content active" id="data-tab">
            <div class="card">
                <div class="card-title">‰º†ÊÑüÂô®Êï∞ÊçÆ</div>
                <div class="data-table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th>Êó∂Èó¥Êà≥</th>
                                <th>‰º†ÊÑüÂô®ID</th>
                                <th>Êï∞ÂÄº</th>
                                <th>Áä∂ÊÄÅ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Êï∞ÊçÆË°åÂ∞ÜÂä®ÊÄÅÊèíÂÖ• -->
                        </tbody>
                    </table>
                </div>
                <div class="no-data-message" id="noDataMessage">
                    ËØ∑‰∏ä‰º†Êï∞ÊçÆÊñá‰ª∂ÂºÄÂßãÂàÜÊûê
                </div>
            </div>
        </div>

        <div class="tab-content" id="visualization-tab">
            <div class="card">
                <div class="card-title">‰º†ÊÑüÂô®Êï∞ÊçÆÂèØËßÜÂåñ</div>
                <div class="chart-container">
                    <canvas id="dataChart"></canvas>
                </div>
                <div class="no-data-message" id="noChartDataMessage">
                    ËØ∑‰∏ä‰º†Êï∞ÊçÆÊñá‰ª∂Êü•ÁúãÂèØËßÜÂåñÂõæË°®
                </div>
            </div>
        </div>

        <div class="tab-content" id="analysis-tab">
            <div class="card">
                <div class="card-title">ÂºÇÂ∏∏Ê£ÄÊµãÁªìÊûú</div>
                <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂå∫Âüü -->
                <div class="history-section">
                    <div class="history-header">
                        <h3>ÂéÜÂè≤Ê£ÄÊµãËÆ∞ÂΩï</h3>
                        <button id="clearHistoryBtn" class="button secondary small">
                            <span class="material-icons">delete</span>
                            Ê∏ÖÁ©∫ÂéÜÂè≤
                        </button>
                    </div>
                    <div class="history-list" id="detectionHistory">
                        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÈ°πÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÊ∑ªÂä† -->
                        <div class="no-history-message">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>
                    </div>
                </div>
                <div class="loader" id="analysisLoader"></div>
                <div class="analysis-summary" id="analysisSummary" style="display:none;">
                    <h3>Êï∞ÊçÆÂàÜÊûêÊëòË¶Å</h3>
                    <p>ÊÄªÊï∞ÊçÆÁÇπ: <span id="totalPoints">0</span></p>
                    <p>Ê£ÄÊµãÂà∞ <span class="anomaly-count" id="anomalyCount">0</span> ‰∏™ÂºÇÂ∏∏</p>
                    <p>ÂºÇÂ∏∏Á±ªÂûãÂàÜÂ∏É:</p>
                    <ul>
                        <li>ÂçïÁÇπÂºÇÂ∏∏: <span id="singlePointCount">0</span></li>
                        <li>ËøûÁª≠ÊÄßÂºÇÂ∏∏: <span id="continuousCount">0</span></li>
                        <li>Áæ§‰ΩìÂºÇÂ∏∏: <span id="clusterCount">0</span></li>
                    </ul>
                </div>
                <div class="chart-container">
                    <canvas id="anomalyChart"></canvas>
                </div>
                <div class="result-area">
                    <h3>ËØ¶ÁªÜÂºÇÂ∏∏ÂàóË°®</h3>
                    <ul class="anomaly-list" id="anomalyList">
                        <!-- ÂºÇÂ∏∏È°πÂ∞ÜÂä®ÊÄÅÊèíÂÖ• -->
                    </ul>
                </div>
                <div class="no-data-message" id="noAnalysisMessage">
                    ËØ∑ÁÇπÂáª"ÂºÄÂßãÊ£ÄÊµã"ÊåâÈíÆËøõË°åÂºÇÂ∏∏Ê£ÄÊµã
                </div>
            </div>
        </div>

        <div class="tab-content" id="monitor-tab">
            <div class="card">
                <div class="card-title">Ê°•Ê¢ÅÁõëÊéß</div>
                
                <!-- ÊëÑÂÉèÂ§¥ÊêúÁ¥¢ÂíåÁ≠õÈÄâÂå∫Âüü -->
                <div class="camera-control-section">
                    <div class="search-filter-row">
                        <div class="search-box">
                            <input type="text" id="camera-search" placeholder="ÊêúÁ¥¢ÊëÑÂÉèÂ§¥..." aria-label="ÊêúÁ¥¢ÊëÑÂÉèÂ§¥">
                            <span class="material-icons search-icon">search</span>
                        </div>
                        <div class="filter-controls">
                            <select id="camera-filter" aria-label="ÊëÑÂÉèÂ§¥Á≠õÈÄâ">
                                <option value="all">ÂÖ®ÈÉ®ÊëÑÂÉèÂ§¥</option>
                                <option value="online">Âú®Á∫ø</option>
                                <option value="offline">Á¶ªÁ∫ø</option>
                                <option value="warning">ÂºÇÂ∏∏</option>
                            </select>
                            <select id="section-filter" aria-label="Âå∫ÊÆµÁ≠õÈÄâ">
                                <option value="all">ÂÖ®ÈÉ®Âå∫ÊÆµ</option>
                                <option value="north">ÂåóÊÆµ</option>
                                <option value="center">‰∏≠ÊÆµ</option>
                                <option value="south">ÂçóÊÆµ</option>
                                <option value="east">‰∏úÊÆµ</option>
                                <option value="west">Ë•øÊÆµ</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- ÊëÑÂÉèÂ§¥ÁΩëÊ†º -->
                <div class="camera-grid" id="cameraGrid">
                    <!-- ÊëÑÂÉèÂ§¥Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <div class="no-data-message" id="noMonitorMessage">
                    ËØ∑‰∏ä‰º†Êï∞ÊçÆÊàñÁîüÊàêÁ§∫‰æãÊï∞ÊçÆÊù•ÂêØÁî®ÁõëÊéßËßÜÂõæ
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáèÂ£∞ÊòéÂå∫Âüü - ‰øùÁïô‰∏Ä‰ªΩÂÆö‰πâÔºåÂà†Èô§ÈáçÂ§çÁöÑÂ£∞Êòé
        let sensorData = [];
        let allCameras = [];
        let dataUpdateInterval = null;
        let selectedSensors = [];
        let eventPredictions = [];
        let currentEventSimulation = null;
        let dataChart = null;
        let anomalyChart = null;
        let isLoggedIn = false;
        let currentUser = null;
        let zScores = [];
        let anomalyIndices = [];
        let anomalyTypes = [];
        
        // DOM ÂÖÉÁ¥†ÂºïÁî®
        const loginModal = document.querySelector('.login-modal');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.querySelector('.error-message');
        const userInfoDisplay = document.querySelector('.user-info');
        const userAvatar = document.querySelector('.user-avatar');
        const usernameDisplay = document.querySelector('.username-display');
        const noDataMessage = document.getElementById('noDataMessage');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const uploadButton = document.getElementById('uploadButton');
        const detectButton = document.getElementById('detectButton');
        const sampleButton = document.getElementById('sampleButton');
        const resetButton = document.getElementById('resetButton');
        const refreshButton = document.getElementById('refreshButton');
        const downloadExample = document.getElementById('downloadExample');
        const sensorTooltip = document.createElement('div');
        const eventNameElement = document.getElementById('eventName');
        const eventDescElement = document.getElementById('eventDescription');
        const eventDetails = document.querySelector('.event-details');
        const eventProgressContainer = document.querySelector('.event-progress-container');
        const eventProgressBar = document.querySelector('.event-progress-bar');
        const cameraContainer = document.getElementById('camera-container');
        const dataTable = document.getElementById('dataTable');
        const noChartDataMessage = document.getElementById('noChartDataMessage');
        const noAnalysisMessage = document.getElementById('noAnalysisMessage');
        const noMonitorMessage = document.getElementById('noMonitorMessage');
        const analysisLoader = document.getElementById('analysisLoader');
        const analysisSummary = document.getElementById('analysisSummary');
        const anomalyList = document.getElementById('anomalyList');
        const totalPoints = document.getElementById('totalPoints');
        const anomalyCount = document.getElementById('anomalyCount');
        const singlePointCount = document.getElementById('singlePointCount');
        const continuousCount = document.getElementById('continuousCount');
        const clusterCount = document.getElementById('clusterCount');
        const userName = document.getElementById('userName');
        const logoutButton = document.getElementById('logoutButton');
        
        // ‰º†ÊÑüÂô®ËåÉÂõ¥
        const sensorRanges = {
            'Ê∏©Â∫¶': {
                normal: [15, 35],
                warning: [10, 40],
                danger: [5, 45]
            },
            'Â∫îÂèò': {
                normal: [100, 300],
                warning: [80, 350],
                danger: [50, 400]
            },
            'ÊåØÂä®': {
                normal: [0.1, 1.0],
                warning: [0.05, 1.5],
                danger: [0, 2.0]
            },
            'ÂÄæËßí': {
                normal: [0, 1.0],
                warning: [-0.5, 1.5],
                danger: [-1.0, 2.0]
            },
            'ÂÖ∂‰ªñ': {
                normal: [50, 150],
                warning: [30, 170],
                danger: [10, 190]
            }
        };
        
        // ÂÖ®Â±ÄÂèòÈáè - ‰∫ã‰ª∂Ê®°ÊãüÁ±ªÂûã
        const bridgeEvents = {
            NORMAL: 'normal',
            EARTHQUAKE: 'earthquake',
            STRONG_WIND: 'strong_wind',
            HEAVY_TRAFFIC: 'heavy_traffic',
            TEMPERATURE_CHANGE: 'temperature_change',
            FLOOD: 'flood'
        };

        // ÂêÑÁ±ª‰∫ã‰ª∂ÁöÑËÆæÁΩÆ
        const eventSettings = {
            [bridgeEvents.NORMAL]: {
                name: "Ê≠£Â∏∏ËøêË°å",
                description: "Ê°•Ê¢ÅÁªìÊûÑÊ≠£Â∏∏ÔºåÊâÄÊúâÁõëÊµãÂèÇÊï∞Âú®ÂÆâÂÖ®ËåÉÂõ¥ÂÜÖ„ÄÇ",
                duration: [0, 0], // Êó†ÊåÅÁª≠Êó∂Èó¥
                severity: 'normal',
                icon: 'üü¢'
            },
            [bridgeEvents.EARTHQUAKE]: {
                name: "Âú∞Èúá‰∫ã‰ª∂",
                description: "Ê£ÄÊµãÂà∞Âú∞ÈúáÊ¥ªÂä®ÔºåÊåØÂä®‰º†ÊÑüÂô®ÊòæÁ§∫ÂºÇÂ∏∏ËØªÊï∞ÔºåÂª∫ËÆÆËøõË°åÂÆâÂÖ®Ê£ÄÊü•„ÄÇ",
                duration: [10, 20], // ÊåÅÁª≠10-20‰∏™Âë®Êúü
                severity: 'alert',
                icon: 'üî¥'
            },
            [bridgeEvents.STRONG_WIND]: {
                name: "Âº∫È£é‰∫ã‰ª∂",
                description: "ÂΩìÂâçÈ£éÈÄüËøáÈ´òÔºåÊ°•Ê¢ÅÁªìÊûÑÊâøÂèóËæÉÂ§ßÈ£éËΩΩËç∑ÔºåÂª∫ËÆÆÈôêÈÄüÈÄöË°å„ÄÇ",
                duration: [15, 30], // ÊåÅÁª≠15-30‰∏™Âë®Êúü
                severity: 'warning',
                icon: 'üü†'
            },
            [bridgeEvents.HEAVY_TRAFFIC]: {
                name: "‰∫§ÈÄöÊã•Â†µ",
                description: "Ê°•Èù¢‰∫§ÈÄöÊµÅÈáèËøáÂ§ßÔºåÊ°•Ê¢ÅÊâøÂèóÈ¢ùÂ§ñËΩΩËç∑ÔºåÂ∫îÂèò‰º†ÊÑüÂô®ËØªÊï∞ÂçáÈ´ò„ÄÇ",
                duration: [20, 40], // ÊåÅÁª≠20-40‰∏™Âë®Êúü
                severity: 'warning',
                icon: 'üü†'
            },
            [bridgeEvents.TEMPERATURE_CHANGE]: {
                name: "Ê∏©Â∫¶ÂâßÂèò",
                description: "Ê£ÄÊµãÂà∞ÁéØÂ¢ÉÊ∏©Â∫¶Âø´ÈÄüÂèòÂåñÔºåÊùêÊñôÁÉ≠ËÉÄÂÜ∑Áº©ÂØºËá¥Â∫îÂèòÂèòÂåñ„ÄÇ",
                duration: [25, 45], // ÊåÅÁª≠25-45‰∏™Âë®Êúü
                severity: 'warning',
                icon: 'üü†'
            },
            [bridgeEvents.FLOOD]: {
                name: "Ê¥™Ê∞¥Ë≠¶Êä•",
                description: "Ê£ÄÊµãÂà∞Ê∞¥‰ΩçÂºÇÂ∏∏‰∏äÊ∂®ÔºåÊ°•Â¢©ÂèóÂà∞Ê∞¥ÊµÅÂÜ≤ÂáªÔºåÊåØÂä®ÂíåÂÄæËßí‰º†ÊÑüÂô®Êï∞ÊçÆÂºÇÂ∏∏„ÄÇ",
                duration: [30, 60], // ÊåÅÁª≠30-60‰∏™Âë®Êúü
                severity: 'alert',
                icon: 'üî¥'
            }
        };

        // ÁôªÂΩïÂäüËÉΩ
        function checkLoginStatus() {
            console.log("Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ...");
            // ‰ªélocalStorageÊ£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            const storedUser = localStorage.getItem('bridgeSystemUser');
            if (storedUser) {
                try {
                    currentUser = JSON.parse(storedUser);
                    isLoggedIn = true;
                    showUserInfo();
                    hideLoginModal();
                    console.log("Áî®Êà∑Â∑≤ÁôªÂΩï:", currentUser.username);
                } catch (e) {
                    console.error('Ëß£ÊûêÂ≠òÂÇ®ÁöÑÁî®Êà∑‰ø°ÊÅØÊó∂Âá∫Èîô:', e);
                    showLoginModal();
                }
            } else {
                console.log("Êú™ÊâæÂà∞ÁôªÂΩï‰ø°ÊÅØÔºåÊòæÁ§∫ÁôªÂΩïÁïåÈù¢");
                showLoginModal();
            }
        }

        function showUserInfo() {
            console.log("ÊòæÁ§∫Áî®Êà∑‰ø°ÊÅØ");
            if (currentUser && userInfoDisplay) {
                userInfoDisplay.style.display = 'flex';
                if (userName) userName.textContent = currentUser.username;
                if (userAvatar) userAvatar.textContent = currentUser.username.charAt(0).toUpperCase();
            } else {
                console.warn("Êó†Ê≥ïÊòæÁ§∫Áî®Êà∑‰ø°ÊÅØÔºåÊ£ÄÊü•userInfoDisplayÊàñcurrentUserÊòØÂê¶Â≠òÂú®");
            }
        }

        function hideUserInfo() {
            if (userInfoDisplay) {
                userInfoDisplay.style.display = 'none';
            }
        }

        function showLoginModal() {
            console.log("ÊòæÁ§∫ÁôªÂΩïÁïåÈù¢");
            if (loginModal) {
                loginModal.style.display = 'flex';
                if (usernameInput) usernameInput.focus();
            } else {
                console.error("ÁôªÂΩïÊ®°ÊÄÅÊ°Ü‰∏çÂ≠òÂú®ÔºåÊ£ÄÊü•HTMLÁªìÊûÑ");
                // Â¶ÇÊûúÊâæ‰∏çÂà∞Ê®°ÊÄÅÊ°ÜÔºåÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÁôªÂΩïÁïåÈù¢
                createTemporaryLoginForm();
            }
        }

        function createTemporaryLoginForm() {
            console.log("ÂàõÂª∫‰∏¥Êó∂ÁôªÂΩïË°®Âçï");
            // ÂàõÂª∫‰∏¥Êó∂ÁôªÂΩïË°®ÂçïÔºå‰Ωú‰∏∫Â§áÁî®ÊñπÊ°à
            const tempLoginForm = document.createElement('div');
            tempLoginForm.id = 'tempLoginForm';
            tempLoginForm.className = 'login-modal';
            tempLoginForm.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:9999;';
            
            tempLoginForm.innerHTML = `
                <div class="login-container" style="background:white; padding:20px; border-radius:8px; width:300px; box-shadow:0 0 10px rgba(0,0,0,0.2);">
                    <h2 style="text-align:center; margin-bottom:20px;">ÈªëÈæôÊ±üÂ§ßÊ°•ÁõëÊµãÁ≥ªÁªü</h2>
                    <div style="margin-bottom:15px;">
                        <label for="temp-username" style="display:block; margin-bottom:5px;">Áî®Êà∑Âêç</label>
                        <input type="text" id="temp-username" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç">
                    </div>
                    <div style="margin-bottom:15px;">
                        <label for="temp-password" style="display:block; margin-bottom:5px;">ÂØÜÁ†Å</label>
                        <input type="password" id="temp-password" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                    </div>
                    <div id="temp-login-error" style="color:red; margin-bottom:10px; display:none;">Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ</div>
                    <button id="temp-login-button" style="width:100%; padding:10px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">ÁôªÂΩï</button>
                </div>
            `;
            
            document.body.appendChild(tempLoginForm);
            
            // Ê∑ªÂä†‰∏¥Êó∂ÁôªÂΩïË°®ÂçïÁöÑ‰∫ã‰ª∂ÁõëÂê¨
            document.getElementById('temp-login-button').addEventListener('click', function() {
                const username = document.getElementById('temp-username').value;
                const password = document.getElementById('temp-password').value;
                
                if (username && password) {
                    // Ê®°ÊãüÁôªÂΩïÈ™åËØÅ
                    currentUser = { username: username, role: 'admin' };
                    isLoggedIn = true;
                    localStorage.setItem('bridgeSystemUser', JSON.stringify(currentUser));
                    
                    // ÁßªÈô§‰∏¥Êó∂ÁôªÂΩïË°®Âçï
                    document.body.removeChild(tempLoginForm);
                    
                    // Âà∑Êñ∞È°µÈù¢‰ª•Â∫îÁî®Ê≠£Á°ÆÁöÑÁôªÂΩïÁä∂ÊÄÅ
                    location.reload();
                } else {
                    document.getElementById('temp-login-error').style.display = 'block';
                }
            });
        }

        function hideLoginModal() {
            if (loginModal) {
                loginModal.style.display = 'none';
            }
        }

        function handleLogin() {
            console.log("Â§ÑÁêÜÁôªÂΩïËØ∑Ê±Ç");
            const username = usernameInput ? usernameInput.value : '';
            const password = passwordInput ? passwordInput.value : '';
            
            if (username && password) {
                // ÁÆÄÂåñÁâàÊú¨Ôºö‰ªª‰ΩïÈùûÁ©∫Áî®Êà∑ÂêçÂíåÂØÜÁ†ÅÈÉΩË¢´Êé•Âèó
                currentUser = {
                    username: username,
                    role: 'admin',
                    loginTime: new Date().toISOString()
                };
                isLoggedIn = true;
                
                // Â∞ÜÁî®Êà∑‰ø°ÊÅØÂ≠òÂÇ®Âú®localStorage‰∏≠
                localStorage.setItem('bridgeSystemUser', JSON.stringify(currentUser));
                
                // Êõ¥Êñ∞UI
                showUserInfo();
                hideLoginModal();
                
                console.log("ÁôªÂΩïÊàêÂäü:", username);
            } else {
                if (loginError) {
                    loginError.textContent = 'ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å';
                    loginError.style.display = 'block';
                }
                console.warn("ÁôªÂΩïÂ§±Ë¥•: Áî®Êà∑ÂêçÊàñÂØÜÁ†Å‰∏∫Á©∫");
            }
        }

        function handleLogout() {
            console.log("Â§ÑÁêÜÁôªÂá∫ËØ∑Ê±Ç");
            // Ê∏ÖÈô§Áî®Êà∑‰ø°ÊÅØ
            localStorage.removeItem('bridgeSystemUser');
            currentUser = null;
            isLoggedIn = false;
            
            // Êõ¥Êñ∞UI
            hideUserInfo();
            showLoginModal();
        }

        // ÂàùÂßãÂåñÊ°•Ê¢ÅÁõëÊéßÂõæ
        function initBridgeMonitor() {
            const bridge = document.querySelector('.bridge');
            const noMonitorMessage = document.getElementById('noMonitorMessage');
            
            if (!sensorData || sensorData.length === 0) {
                noMonitorMessage.style.display = 'block';
                return;
            }
            
            noMonitorMessage.style.display = 'none';
            
            // Ê∏ÖÈô§Áé∞Êúâ‰º†ÊÑüÂô®ÁÇπ
            document.querySelectorAll('.sensor-point').forEach(point => point.remove());
            
            // ÂàõÂª∫‰º†ÊÑüÂô®ÁÇπ
            const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
            
            uniqueSensors.forEach((sensorId, index) => {
                // Ëé∑ÂèñËØ•‰º†ÊÑüÂô®ÁöÑÊâÄÊúâÊï∞ÊçÆÁÇπ
                const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                
                // Âà§Êñ≠‰º†ÊÑüÂô®Áä∂ÊÄÅ
                let status = 'normal';
                for (const point of sensorPoints) {
                    if (point.status === 'danger') {
                        status = 'danger';
                        break;
                    } else if (point.status === 'warning') {
                        status = 'warning';
                    }
                }
                
                // ËÆ°ÁÆó‰ΩçÁΩÆÔºàÂùáÂåÄÂàÜÂ∏ÉÂú®Ê°•Èù¢‰∏äÔºâ
                const xPos = 10 + (80 * index / (uniqueSensors.length > 1 ? uniqueSensors.length - 1 : 1)) + '%';
                const yPos = '120px'; // ÊîæÂú®Ê°•Èù¢‰∏ä
                
                // ÂàõÂª∫‰º†ÊÑüÂô®ÁÇπÂÖÉÁ¥†
                const sensorPoint = document.createElement('div');
                sensorPoint.className = `sensor-point ${status}`;
                sensorPoint.style.left = xPos;
                sensorPoint.style.top = yPos;
                sensorPoint.dataset.sensorId = sensorId;
                sensorPoint.dataset.status = status;
                
                // Ê∑ªÂä†ÊÇ¨ÂÅú‰∫ã‰ª∂ÊòæÁ§∫Â∑•ÂÖ∑ÊèêÁ§∫
                sensorPoint.addEventListener('mouseover', function(e) {
                    const rect = this.getBoundingClientRect();
                    
                    // ÁªüËÆ°ÂºÇÂ∏∏Êï∞Èáè
                    const abnormalCount = sensorPoints.filter(p => p.status === 'danger').length;
                    
                    sensorTooltip.innerHTML = `
                        <strong>‰º†ÊÑüÂô®:</strong> ${sensorId}<br>
                        <strong>Áä∂ÊÄÅ:</strong> ${getStatusText(status)}<br>
                        <strong>ÂºÇÂ∏∏ÁÇπÊï∞:</strong> ${abnormalCount}
                    `;
                    
                    sensorTooltip.style.top = `${rect.top - 70}px`;
                    sensorTooltip.style.left = `${rect.left}px`;
                    sensorTooltip.style.opacity = '1';
                });
                
                sensorPoint.addEventListener('mouseout', function() {
                    sensorTooltip.style.opacity = '0';
                });
                
                // ÁÇπÂáªË∑≥ËΩ¨Âà∞ÂØπÂ∫î‰º†ÊÑüÂô®ÁöÑÂàÜÊûêÁªìÊûú
                sensorPoint.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.tab[data-tab="analysis"]').classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('analysis-tab').classList.add('active');
                    
                    // ÊªöÂä®Âà∞ÂºÇÂ∏∏ÂàóË°®‰ΩçÁΩÆ
                    document.querySelector('.result-area').scrollIntoView({ behavior: 'smooth' });
                    
                    // È´ò‰∫ÆÊòæÁ§∫ÂØπÂ∫î‰º†ÊÑüÂô®ÁöÑÂºÇÂ∏∏
                    document.querySelectorAll('.anomaly-item').forEach(item => {
                        if (item.textContent.includes(sensorId)) {
                            item.style.backgroundColor = '#fff3cd';
                            setTimeout(() => {
                                item.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                });
                
                bridge.appendChild(sensorPoint);
            });
        }

        function getStatusText(status) {
            switch(status) {
                case 'normal':
                    return 'Ê≠£Â∏∏';
                case 'warning':
                    return 'Ë≠¶Âëä';
                case 'danger':
                    return 'ÂºÇÂ∏∏';
                default:
                    return 'Êú™Áü•';
            }
        }

        // ÂàùÂßãÂåñÊëÑÂÉèÂ§¥ÁõëÊéßÁ≥ªÁªü
        function initCameraMonitor() {
            console.log("ÂàùÂßãÂåñÊëÑÂÉèÂ§¥ÁõëÊéßÁ≥ªÁªü");
            
            // Ê£ÄÊü•ÊëÑÂÉèÂ§¥ÂÆπÂô®ÊòØÂê¶Â≠òÂú®
            const cameraContainerElement = document.getElementById('camera-container');
            if (!cameraContainerElement) {
                console.warn("ÊëÑÂÉèÂ§¥ÂÆπÂô®Êú™ÊâæÂà∞ÔºåÂèØËÉΩÂú®ÈîôËØØÁöÑÈ°µÈù¢‰∏äÂ∞ùËØïÂàùÂßãÂåñÊëÑÂÉèÂ§¥");
                return; // ÊèêÂâçËøîÂõûÈÅøÂÖçÈîôËØØ
            }
            
            // Ê∏ÖÁ©∫ÊëÑÂÉèÂ§¥ÂÆπÂô®
            cameraContainerElement.innerHTML = '';
            
            // ÂÆö‰πâÊëÑÂÉèÂ§¥‰ΩçÁΩÆÂíåÂØπÂ∫îÁöÑ‰º†ÊÑüÂô®
            const cameraLocations = [
                { id: 1, name: "Ê°•Ê¢ÅÂåóÁ´Ø-Â∑¶‰æß", status: "online", sensorId: "TL-101" },
                { id: 2, name: "Ê°•Ê¢ÅÂåóÁ´Ø-Âè≥‰æß", status: "online", sensorId: "TR-102" },
                { id: 3, name: "Ê°•Ê¢Å‰∏ªË∑®-A1", status: "online", sensorId: "MA-201" },
                { id: 4, name: "Ê°•Ê¢Å‰∏ªË∑®-A2", status: "online", sensorId: "MA-202" },
                { id: 5, name: "Ê°•Ê¢Å‰∏ªË∑®-B1", status: "warning", sensorId: "MB-203" },
                { id: 6, name: "Ê°•Ê¢Å‰∏ªË∑®-B2", status: "online", sensorId: "MB-204" },
                { id: 7, name: "Ê°•Ê¢Å‰∏ªË∑®-C1", status: "offline", sensorId: "MC-205" },
                { id: 8, name: "Ê°•Ê¢Å‰∏ªË∑®-C2", status: "online", sensorId: "MC-206" },
                { id: 9, name: "Ê°•Ê¢ÅÂçóÁ´Ø-Â∑¶‰æß", status: "online", sensorId: "BL-301" },
                { id: 10, name: "Ê°•Ê¢ÅÂçóÁ´Ø-Âè≥‰æß", status: "warning", sensorId: "BR-302" },
                { id: 11, name: "Ê°•Â¢©-Âåó1", status: "online", sensorId: "PN-401" },
                { id: 12, name: "Ê°•Â¢©-Âåó2", status: "online", sensorId: "PN-402" },
                { id: 13, name: "Ê°•Â¢©-‰∏≠1", status: "offline", sensorId: "PM-403" },
                { id: 14, name: "Ê°•Â¢©-‰∏≠2", status: "online", sensorId: "PM-404" },
                { id: 15, name: "Ê°•Â¢©-Âçó1", status: "online", sensorId: "PS-405" },
                { id: 16, name: "Ê°•Â¢©-Âçó2", status: "online", sensorId: "PS-406" },
                { id: 17, name: "ÂºïÊ°•ÊÆµ-Âåó", status: "warning", sensorId: "AN-501" },
                { id: 18, name: "ÂºïÊ°•ÊÆµ-Âçó", status: "online", sensorId: "AS-502" },
                { id: 19, name: "ËæÖÂä©ÈÄöÈÅì-‰∏ú", status: "offline", sensorId: "SE-601" },
                { id: 20, name: "ËæÖÂä©ÈÄöÈÅì-Ë•ø", status: "online", sensorId: "SW-602" }
            ];
            
            // ÂàõÂª∫ÊëÑÂÉèÂ§¥ÂÖÉÁ¥†
            cameraLocations.forEach(camera => {
                const cameraItem = createCameraItem(camera);
                cameraContainerElement.appendChild(cameraItem);
            });
            
            // ËÆæÁΩÆÁ≠õÈÄâÂô®ÂíåÊêúÁ¥¢ÂäüËÉΩ
            const cameraFilter = document.getElementById('camera-filter');
            const cameraSearch = document.getElementById('camera-search');
            
            cameraFilter.addEventListener('change', function() {
                filterCameras();
            });
            
            cameraSearch.addEventListener('input', function() {
                filterCameras();
            });
            
            // ËÆæÁΩÆËßÜÂõæÂàáÊç¢ÂäüËÉΩ
            const viewGrid = document.getElementById('view-grid');
            const viewList = document.getElementById('view-list');
            
            viewGrid.addEventListener('click', function() {
                cameraContainer.className = 'camera-grid';
                this.classList.add('secondary');
                viewList.classList.remove('secondary');
            });
            
            viewList.addEventListener('click', function() {
                cameraContainer.className = 'camera-list';
                this.classList.add('secondary');
                viewGrid.classList.remove('secondary');
            });
            
            // Êõ¥Êñ∞Á≥ªÁªüÁä∂ÊÄÅ
            updateSystemStatus(cameraLocations);
        }

        // ÂàõÂª∫Âçï‰∏™ÊëÑÂÉèÂ§¥È°π
        function createCameraItem(camera) {
            const cameraItem = document.createElement('div');
            cameraItem.className = 'camera-item';
            cameraItem.dataset.cameraId = camera.id;
            cameraItem.dataset.status = camera.status;
            cameraItem.dataset.sensorId = camera.sensorId;
            
            // ÂàõÂª∫ÊëÑÂÉèÂ§¥Â§¥ÈÉ®
            const cameraHeader = document.createElement('div');
            cameraHeader.className = 'camera-header';
            
            const cameraName = document.createElement('span');
            cameraName.className = 'camera-name';
            cameraName.textContent = `ÊëÑÂÉèÂ§¥ #${camera.id}`;
            
            const cameraStatus = document.createElement('span');
            cameraStatus.className = `camera-status ${camera.status}`;
            cameraStatus.textContent = getStatusText(camera.status);
            
            cameraHeader.appendChild(cameraName);
            cameraHeader.appendChild(cameraStatus);
            cameraItem.appendChild(cameraHeader);
            
            // Ê∑ªÂä†‰ΩçÁΩÆÊ†áÁ≠æ
            const locationTag = document.createElement('span');
            locationTag.className = 'location-tag';
            locationTag.textContent = camera.name;
            cameraItem.appendChild(locationTag);
            
            // Ê∑ªÂä†‰º†ÊÑüÂô®ID
            const sensorId = document.createElement('div');
            sensorId.className = 'sensor-id';
            sensorId.innerHTML = `<strong>‰º†ÊÑüÂô®:</strong> ${camera.sensorId}`;
            cameraItem.appendChild(sensorId);
            
            // ÂàõÂª∫ÊëÑÂÉèÂ§¥ËßÜÂõæ
            const cameraView = document.createElement('div');
            cameraView.className = 'camera-view';
            
            // Âè™ÊúâÂú®Á∫øÁöÑÊëÑÂÉèÂ§¥ÊâçÂä†ËΩΩÈöèÊú∫ÂõæÂÉè
            if (camera.status === 'online' || camera.status === 'warning') {
                // ÂàõÂª∫ÂõæÂÉèÂç†‰ΩçÁ¨¶
                const placeholder = document.createElement('div');
                placeholder.className = 'camera-placeholder';
                
                const cameraIcon = document.createElement('span');
                cameraIcon.className = 'material-icons camera-icon';
                cameraIcon.textContent = 'videocam';
                
                const message = document.createElement('div');
                message.className = 'camera-message';
                message.textContent = 'ÁÇπÂáªÊü•ÁúãÂÆûÊó∂ÁõëÊéß';
                
                placeholder.appendChild(cameraIcon);
                placeholder.appendChild(message);
                cameraView.appendChild(placeholder);
            } else {
                // ÂàõÂª∫Á¶ªÁ∫øÂç†‰ΩçÁ¨¶
                const placeholder = document.createElement('div');
                placeholder.className = 'camera-placeholder';
                
                const cameraIcon = document.createElement('span');
                cameraIcon.className = 'material-icons camera-icon';
                cameraIcon.textContent = 'videocam_off';
                
                const message = document.createElement('div');
                message.className = 'camera-message';
                message.textContent = 'ÊëÑÂÉèÂ§¥Á¶ªÁ∫ø';
                
                placeholder.appendChild(cameraIcon);
                placeholder.appendChild(message);
                cameraView.appendChild(placeholder);
            }
            
            // ÂàõÂª∫ÊëÑÂÉèÂ§¥Ë¶ÜÁõñÂ±Ç
            const cameraOverlay = document.createElement('div');
            cameraOverlay.className = 'camera-overlay';
            
            // Ê∑ªÂä†Êìç‰ΩúÊåâÈíÆ
            const viewButton = document.createElement('button');
            viewButton.className = 'camera-control-btn';
            viewButton.innerHTML = '<span class="material-icons">fullscreen</span>';
            viewButton.dataset.action = 'view';
            viewButton.dataset.camera = camera.id;
            viewButton.addEventListener('click', function(e) {
                e.stopPropagation();
                viewCamera(camera.id);
            });
            
            cameraOverlay.appendChild(viewButton);
            cameraView.appendChild(cameraOverlay);
            
            // ËÆæÁΩÆÊëÑÂÉèÂ§¥ÁÇπÂáª‰∫ã‰ª∂
            cameraView.addEventListener('click', function() {
                if (camera.status !== 'offline') {
                    viewCamera(camera.id);
                } else {
                    alert(`ÊëÑÂÉèÂ§¥ #${camera.id} (${camera.name}) ÂΩìÂâçÁ¶ªÁ∫øÔºåÊó†Ê≥ïÊü•ÁúãÁîªÈù¢`);
                }
            });
            
            cameraItem.appendChild(cameraView);
            
            // Ê∑ªÂä†ÊëÑÂÉèÂ§¥ÊéßÂà∂ÊåâÈíÆ
            const cameraControls = document.createElement('div');
            cameraControls.className = 'camera-controls';
            
            // Âè™ÊúâÂú®Á∫øÁöÑÊëÑÂÉèÂ§¥ÊâçËÉΩÊéßÂà∂
            if (camera.status !== 'offline') {
                const controlButtons = [
                    { action: 'history', icon: 'history', text: 'ÂéÜÂè≤ËÆ∞ÂΩï' },
                    { action: 'refresh', icon: 'refresh', text: 'Âà∑Êñ∞' }
                ];
                
                controlButtons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = 'camera-control-btn';
                    button.title = btn.text;
                    button.innerHTML = `<span class="material-icons">${btn.icon}</span>`;
                    button.dataset.action = btn.action;
                    button.dataset.camera = camera.id;
                    button.addEventListener('click', function() {
                        controlCamera(camera.id, btn.action);
                    });
                    cameraControls.appendChild(button);
                });
            } else {
                const reconnectButton = document.createElement('button');
                reconnectButton.className = 'camera-control-btn';
                reconnectButton.title = 'Â∞ùËØïÈáçËøû';
                reconnectButton.innerHTML = '<span class="material-icons">sync</span>';
                reconnectButton.dataset.action = 'reconnect';
                reconnectButton.dataset.camera = camera.id;
                reconnectButton.addEventListener('click', function() {
                    attemptReconnect(camera.id);
                });
                cameraControls.appendChild(reconnectButton);
            }
            
            cameraItem.appendChild(cameraControls);
            
            return cameraItem;
        }

        // Á≠õÈÄâÊëÑÂÉèÂ§¥
        function filterCameras() {
            const filterValue = document.getElementById('camera-filter').value;
            const searchText = document.getElementById('camera-search').value.toLowerCase();
            
            const cameraItems = document.querySelectorAll('.camera-item');
            
            cameraItems.forEach(item => {
                const cameraStatus = item.dataset.status;
                const cameraId = item.dataset.cameraId;
                const cameraName = item.querySelector('.camera-name').textContent.toLowerCase();
                const locationName = item.querySelector('.location-tag').textContent.toLowerCase();
                const sensorId = item.dataset.sensorId.toLowerCase();
                
                let statusMatch = true;
                if (filterValue !== 'all') {
                    statusMatch = cameraStatus === filterValue;
                }
                
                const searchMatch = 
                    cameraName.includes(searchText) || 
                    locationName.includes(searchText) || 
                    sensorId.includes(searchText) ||
                    `ÊëÑÂÉèÂ§¥ ${cameraId}`.toLowerCase().includes(searchText);
                
                if (statusMatch && searchMatch) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Êõ¥Êñ∞Êó†ÁªìÊûúÊ∂àÊÅØ
            let visibleCount = 0;
            cameraItems.forEach(item => {
                if (item.style.display !== 'none') {
                    visibleCount++;
                }
            });
            
            if (visibleCount === 0) {
                // Â¶ÇÊûúÊ≤°ÊúâÂåπÈÖçÈ°πÔºåÊòæÁ§∫Ê∂àÊÅØ
                let noResultMessage = document.getElementById('no-camera-results');
                if (!noResultMessage) {
                    noResultMessage = document.createElement('div');
                    noResultMessage.id = 'no-camera-results';
                    noResultMessage.className = 'no-data-message';
                    noResultMessage.textContent = 'Ê≤°ÊúâÂåπÈÖçÁöÑÊëÑÂÉèÂ§¥';
                    cameraContainer.appendChild(noResultMessage);
                } else {
                    noResultMessage.style.display = 'block';
                }
            } else {
                // ÈöêËóèÊ∂àÊÅØÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                const noResultMessage = document.getElementById('no-camera-results');
                if (noResultMessage) {
                    noResultMessage.style.display = 'none';
                }
            }
        }

        // Êü•ÁúãÊëÑÂÉèÂ§¥ÁîªÈù¢
        function viewCamera(cameraId) {
            console.log(`Êü•ÁúãÊëÑÂÉèÂ§¥ #${cameraId} ÁîªÈù¢`);
            
            // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºöÂºπÂá∫‰∏Ä‰∏™Ê®°ÊÄÅÊ°ÜÊòæÁ§∫ÂÆûÊó∂ËßÜÈ¢ë
            alert(`Ê≠£Âú®ÊâìÂºÄÊëÑÂÉèÂ§¥ #${cameraId} ÁöÑÂÆûÊó∂ÁõëÊéßÁîªÈù¢`);
            
            // Ê®°ÊãüÂä†ËΩΩÊñ∞ÁîªÈù¢
            const camera = document.querySelector(`.camera-item[data-camera-id="${cameraId}"] .camera-placeholder`);
            if (camera) {
                camera.querySelector('.camera-message').textContent = 'Ê≠£Âú®Âä†ËΩΩÂÆûÊó∂ÁîªÈù¢...';
                camera.querySelector('.camera-icon').textContent = 'sync';
                
                // 2ÁßíÂêéÊÅ¢Â§ç
                setTimeout(() => {
                    camera.querySelector('.camera-message').textContent = 'ÁÇπÂáªÊü•ÁúãÂÆûÊó∂ÁõëÊéß';
                    camera.querySelector('.camera-icon').textContent = 'videocam';
                }, 2000);
            }
        }

        // Â∞ùËØïÈáçËøûÊëÑÂÉèÂ§¥
        function attemptReconnect(cameraId) {
            console.log(`Â∞ùËØïÈáçËøûÊëÑÂÉèÂ§¥ #${cameraId}`);
            
            const cameraItem = document.querySelector(`.camera-item[data-camera-id="${cameraId}"]`);
            if (!cameraItem) return;
            
            // ‰øÆÊîπÊëÑÂÉèÂ§¥Âç†‰ΩçÁ¨¶ÊòæÁ§∫ÈáçËøûÁä∂ÊÄÅ
            const placeholder = cameraItem.querySelector('.camera-placeholder');
            placeholder.querySelector('.camera-message').textContent = 'Ê≠£Âú®Â∞ùËØïÈáçÊñ∞ËøûÊé•...';
            placeholder.querySelector('.camera-icon').textContent = 'sync';
            
            // Ê®°ÊãüÈáçËøûËøáÁ®ã
            let connectionAttempts = 0;
            const maxAttempts = 3;
            
            const attemptInterval = setInterval(() => {
                connectionAttempts++;
                console.log(`ÈáçËøûÂ∞ùËØï ${connectionAttempts}/${maxAttempts}`);
                
                if (connectionAttempts >= maxAttempts && Math.random() > 0.7) {
                    // Ê®°ÊãüÈáçËøûÊàêÂäü
                    clearInterval(attemptInterval);
                    
                    // Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫Âú®Á∫ø
                    const statusBadge = cameraItem.querySelector('.camera-status');
                    statusBadge.textContent = 'Âú®Á∫ø';
                    statusBadge.className = 'camera-status online';
                    cameraItem.dataset.status = 'online';
                    
                    // Êõ¥Êñ∞ÂõæÊ†áÂíåÊ∂àÊÅØ
                    placeholder.querySelector('.camera-message').textContent = 'ÊëÑÂÉèÂ§¥Â∑≤ÊÅ¢Â§çËøûÊé•';
                    placeholder.querySelector('.camera-icon').textContent = 'videocam';
                    
                    // ÊõøÊç¢ÊéßÂà∂ÊåâÈíÆ
                    const cameraControls = cameraItem.querySelector('.camera-controls');
                    cameraControls.innerHTML = '';
                    
                    const controlButtons = [
                        { action: 'history', icon: 'history', text: 'ÂéÜÂè≤ËÆ∞ÂΩï' },
                        { action: 'refresh', icon: 'refresh', text: 'Âà∑Êñ∞' }
                    ];
                    
                    controlButtons.forEach(btn => {
                        const button = document.createElement('button');
                        button.className = 'camera-control-btn';
                        button.title = btn.text;
                        button.innerHTML = `<span class="material-icons">${btn.icon}</span>`;
                        button.dataset.action = btn.action;
                        button.dataset.camera = cameraId;
                        button.addEventListener('click', function() {
                            controlCamera(cameraId, btn.action);
                        });
                        cameraControls.appendChild(button);
                    });
                    
                    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                    showActionFeedback(cameraId, 'ÊëÑÂÉèÂ§¥Â∑≤ÊÅ¢Â§çËøûÊé•');
                    
                    // Êõ¥Êñ∞Á≥ªÁªüÁä∂ÊÄÅ
                    updateSystemStatus();
                } else if (connectionAttempts >= maxAttempts) {
                    // Ê®°ÊãüÈáçËøûÂ§±Ë¥•
                    clearInterval(attemptInterval);
                    
                    // ÊÅ¢Â§çÁ¶ªÁ∫øÁä∂ÊÄÅ
                    placeholder.querySelector('.camera-message').textContent = 'ÈáçËøûÂ§±Ë¥•ÔºåÊëÑÂÉèÂ§¥Á¶ªÁ∫ø';
                    placeholder.querySelector('.camera-icon').textContent = 'videocam_off';
                    
                    // ÊòæÁ§∫Â§±Ë¥•Ê∂àÊÅØ
                    showActionFeedback(cameraId, 'ÈáçËøûÂ§±Ë¥•');
                }
            }, 1000);
        }

        // Êõ¥Êñ∞Á≥ªÁªüÁä∂ÊÄÅ‰ø°ÊÅØ
        function updateSystemStatus() {
            // ÁªüËÆ°ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ
            const cameras = document.querySelectorAll('.camera-item');
            let onlineCount = 0;
            let offlineCount = 0;
            let warningCount = 0;
            
            cameras.forEach(camera => {
                const status = camera.dataset.status;
                if (status === 'online') onlineCount++;
                else if (status === 'offline') offlineCount++;
                else if (status === 'warning') warningCount++;
            });
            
            const systemStatus = document.getElementById('system-status');
            
            if (offlineCount > 0 || warningCount > 0) {
                let statusMessage = `ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ: ${onlineCount} Âú®Á∫ø`;
                if (warningCount > 0) statusMessage += `, ${warningCount} Ë≠¶Âëä`;
                if (offlineCount > 0) statusMessage += `, ${offlineCount} Á¶ªÁ∫ø`;
                
                systemStatus.textContent = statusMessage;
                
                if (offlineCount > 0) {
                    document.getElementById('cameraAlert').style.color = '#dc3545';
                } else {
                    document.getElementById('cameraAlert').style.color = '#ffc107';
                }
            } else {
                systemStatus.textContent = 'ÁõëÊéßÁ≥ªÁªüËøêË°åÊ≠£Â∏∏ÔºåÊâÄÊúâÊëÑÂÉèÂ§¥Âú®Á∫ø';
                document.getElementById('cameraAlert').style.color = '#28a745';
            }
        }

        // Ê®°ÊãüÊëÑÂÉèÂ§¥ÊéßÂà∂
        function controlCamera(cameraId, action) {
            console.log(`ÊéßÂà∂ÊëÑÂÉèÂ§¥ #${cameraId}ÔºåÂä®‰Ωú: ${action}`);
            
            const cameraItem = document.querySelector(`.camera-item[data-camera-id="${cameraId}"]`);
            if (!cameraItem) return;
            
            // ÊòæÁ§∫ÊéßÂà∂ÂèçÈ¶àÔºàÈó™ÁÉÅÊïàÊûúÔºâ
            const placeholder = cameraItem.querySelector('.camera-placeholder');
            placeholder.style.opacity = '0.7';
            setTimeout(() => {
                placeholder.style.opacity = '1';
            }, 200);
            
            // Ê†πÊçÆÂä®‰ΩúÊâßË°å‰∏çÂêåÁöÑÊ®°ÊãüÊìç‰Ωú
            switch(action) {
                case 'history':
                    // Ê®°ÊãüÊü•ÁúãÂéÜÂè≤ËÆ∞ÂΩï
                    showActionFeedback(cameraId, 'Ê≠£Âú®Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï');
                    break;
                case 'refresh':
                    // Âà∑Êñ∞ÊëÑÂÉèÂ§¥
                    showActionFeedback(cameraId, 'Ê≠£Âú®Âà∑Êñ∞ËøûÊé•');
                    break;
            }
        }

        // ÊòæÁ§∫ÊëÑÂÉèÂ§¥Êìç‰ΩúÂèçÈ¶à
        function showActionFeedback(cameraId, message) {
            const cameraItem = document.querySelector(`.camera-item[data-camera-id="${cameraId}"]`);
            if (!cameraItem) return;
            
            // ÂàõÂª∫ÂèçÈ¶àÂÖÉÁ¥†
            const feedback = document.createElement('div');
            feedback.className = 'camera-feedback';
            feedback.style.position = 'absolute';
            feedback.style.bottom = '10px';
            feedback.style.left = '50%';
            feedback.style.transform = 'translateX(-50%)';
            feedback.style.backgroundColor = 'rgba(0,0,0,0.7)';
            feedback.style.color = 'white';
            feedback.style.padding = '5px 10px';
            feedback.style.borderRadius = '4px';
            feedback.style.fontSize = '12px';
            feedback.style.zIndex = '100';
            feedback.textContent = message;
            
            // Ê∑ªÂä†Âà∞ÊëÑÂÉèÂ§¥ËßÜÂõæ
            const cameraView = cameraItem.querySelector('.camera-view');
            cameraView.appendChild(feedback);
            
            // 2ÁßíÂêéÁßªÈô§ÂèçÈ¶à
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.remove();
                }
            }, 2000);
        }

        // Ê†áÁ≠æÈ°µÂàáÊç¢ÂäüËÉΩ
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Êõ¥Êñ∞Ê†áÁ≠æÈ°µÁä∂ÊÄÅ
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Êõ¥Êñ∞ÂÜÖÂÆπÂå∫Âüü
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Â¶ÇÊûúÂàáÊç¢Âà∞ÁõëÊéßÊ†áÁ≠æÔºåÂàùÂßãÂåñÁõ∏Â∫îÂäüËÉΩ
                if (tabId === 'monitor') {
                    // ÂàùÂßãÂåñÊëÑÂÉèÂ§¥ÁõëÊéßËÄå‰∏çÊòØÊ°•Ê¢ÅÁõëÊéß
                    initCameraMonitor();
                }
            });
        });

        // Êñá‰ª∂‰∏ä‰º†‰∫ã‰ª∂
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                const file = this.files[0];
                fileInfo.textContent = `Â∑≤ÈÄâÊã©Êñá‰ª∂: ${file.name} (${formatFileSize(file.size)})`;
                uploadButton.disabled = false;
            } else {
                fileInfo.textContent = 'Êú™ÈÄâÊã©Êñá‰ª∂';
                uploadButton.disabled = true;
            }
        });

        // ‰∏ä‰º†ÊåâÈíÆ‰∫ã‰ª∂
        uploadButton.addEventListener('click', function() {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const content = e.target.result;
                        // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØ
                        console.log("Êñá‰ª∂ÂÜÖÂÆπËØªÂèñÊàêÂäüÔºåÈïøÂ∫¶Ôºö", content.length);
                        processData(content);
                        
                        // Á°Æ‰øùÊï∞ÊçÆÂ§ÑÁêÜÂêéÂêØÁî®Ê£ÄÊµãÊåâÈíÆ
                        if (sensorData.length > 0) {
                            console.log("ÊàêÂäüÂä†ËΩΩÊï∞ÊçÆÁÇπÔºö", sensorData.length);
                            detectButton.disabled = false;
                        } else {
                            console.warn("Êï∞ÊçÆÂ§ÑÁêÜÂÆåÊàêÔºå‰ΩÜÊ≤°ÊúâÊúâÊïàÊï∞ÊçÆÁÇπ");
                            alert('Êú™ËÉΩ‰ªéÊñá‰ª∂‰∏≠ÊèêÂèñÊúâÊïàÊï∞ÊçÆÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè');
                            detectButton.disabled = true;
                        }
                    } catch (error) {
                        console.error('Êï∞ÊçÆËß£ÊûêÈîôËØØ:', error);
                        alert('Êï∞ÊçÆËß£ÊûêÈîôËØØ: ' + error.message);
                    }
                };
                reader.onerror = function(e) {
                    console.error('Êñá‰ª∂ËØªÂèñÈîôËØØ:', e);
                    alert('Êñá‰ª∂ËØªÂèñÈîôËØØ!');
                };
                reader.readAsText(file);
            } else {
                alert('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂!');
            }
        });

        // ÈáçÁΩÆÊåâÈíÆ‰∫ã‰ª∂
        resetButton.addEventListener('click', function() {
            resetAll();
        });

        // ÂºÄÂßãÊ£ÄÊµãÊåâÈíÆ‰∫ã‰ª∂
        detectButton.addEventListener('click', function() {
            console.log("ÁÇπÂáªÊ£ÄÊµãÊåâÈíÆÔºåÂΩìÂâçÊï∞ÊçÆÁÇπÊï∞Èáè:", sensorData.length);
            if (sensorData && sensorData.length > 0) {
                console.log("ÂºÄÂßãÂºÇÂ∏∏Ê£ÄÊµã...");
                startAnomalyDetection();
            } else {
                console.warn("Ê≤°ÊúâÊï∞ÊçÆÂèØ‰æõÊ£ÄÊµã");
                alert('ËØ∑ÂÖà‰∏ä‰º†Êï∞ÊçÆ!');
            }
        });

        // ÁôªÂΩïÊåâÈíÆ‰∫ã‰ª∂
        loginButton.addEventListener('click', handleLogin);

        // ÈÄÄÂá∫ÊåâÈíÆ‰∫ã‰ª∂
        logoutButton.addEventListener('click', handleLogout);

        // ÊîØÊåÅÂõûËΩ¶ÁôªÂΩï
        passwordInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                handleLogin();
            }
        });

        // Ê®°ÊãüÂºÇÂ∏∏Ê£ÄÊµãËøáÁ®ã
        function startAnomalyDetection() {
            noAnalysisMessage.style.display = 'none';
            analysisLoader.style.display = 'block';
            analysisSummary.style.display = 'none';
            anomalyList.innerHTML = '';
            
            // Ê®°ÊãüÂºÇÂ∏∏Ê£ÄÊµãÂª∂Ëøü
            setTimeout(() => {
                // ÊâßË°åÂºÇÂ∏∏Ê£ÄÊµã
                const result = detectAnomalies();
                
                analysisLoader.style.display = 'none';
                analysisSummary.style.display = 'block';
                
                // ÂàõÂª∫ÂõæË°®
                createAnomalyChart();
                
                // Êõ¥Êñ∞ÁõëÊéßËßÜÂõæ
                initBridgeMonitor();
                
                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                addToDetectionHistory(result);
                
                // Ëá™Âä®ÂàáÊç¢Âà∞ÂàÜÊûêÊ†áÁ≠æ
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector('.tab[data-tab="analysis"]').classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById('analysis-tab').classList.add('active');
            }, 2000);
        }

        // Â§ÑÁêÜ‰∏ä‰º†ÁöÑÊï∞ÊçÆ
        function processData(content) {
            try {
                const lines = content.split('\n');
                console.log("Êñá‰ª∂Ë°åÊï∞:", lines.length);
                
                sensorData = [];
                
                let validLines = 0;
                let skippedLines = 0;
                
                lines.forEach((line, index) => {
                    if (line.trim() !== '') {
                        const parts = line.split(',');
                        // ‰øÆÊîπÈÄªËæëÔºåÊîØÊåÅÊõ¥ÁÅµÊ¥ªÁöÑÊï∞ÊçÆÊ†ºÂºè
                        if (parts.length >= 2) {
                            try {
                                const timestamp = parts[0].trim();
                                const sensorId = parts.length >= 3 ? parts[1].trim() : `‰º†ÊÑüÂô®${index+1}`;
                                const valueIndex = parts.length >= 3 ? 2 : 1;
                                const valueStr = parts[valueIndex].trim();
                                const value = parseFloat(valueStr);
                                
                                if (!isNaN(value)) {
                                    sensorData.push({
                                        timestamp: timestamp,
                                        sensorId: sensorId,
                                        value: value,
                                        status: 'normal'
                                    });
                                    validLines++;
                                } else {
                                    console.warn(`Á¨¨${index+1}Ë°åÊï∞ÂÄºÊó†Êïà: "${valueStr}"`);
                                    skippedLines++;
                                }
                            } catch (e) {
                                console.warn(`Ëß£ÊûêÁ¨¨${index+1}Ë°åÊó∂Âá∫Èîô:`, e.message, "Ë°åÂÜÖÂÆπ:", line);
                                skippedLines++;
                            }
                        } else {
                            console.warn(`Á¨¨${index+1}Ë°åÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåËá≥Â∞ëÈúÄË¶Å2‰∏™ÂÄº: ${line}`);
                            skippedLines++;
                        }
                    }
                });
                
                console.log(`Êï∞ÊçÆÂ§ÑÁêÜÂÆåÊàê: ÊúâÊïàË°åÊï∞=${validLines}, Ë∑≥ËøáË°åÊï∞=${skippedLines}`);
                
                // Á°Æ‰øùÂç≥‰ΩøÊ≤°ÊúâÊï∞ÊçÆ‰πü‰∏ç‰ºöÊä•Èîô
                if (sensorData.length === 0) {
                    console.warn("Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÊï∞ÊçÆ");
                }
                
                displayData();
                createChart();
                
            } catch (error) {
                console.error("Â§ÑÁêÜÊï∞ÊçÆÊó∂ÂèëÁîüÈîôËØØ:", error);
                alert("Â§ÑÁêÜÊï∞ÊçÆÊó∂ÂèëÁîüÈîôËØØ: " + error.message);
            }
        }

        // ‰ºòÂåñÊï∞ÊçÆÊòæÁ§∫ÂáΩÊï∞
        function displayData() {
            if (!sensorData || sensorData.length === 0) {
                noDataMessage.style.display = 'block';
                noChartDataMessage.style.display = 'block';
                return;
            }
            
            // ÈöêËóèÊó†Êï∞ÊçÆÊèêÁ§∫
            noDataMessage.style.display = 'none';
            
            // Ê∏ÖÁ©∫Ë°®Ê†º
            const tableBody = dataTable.getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            
            // ‰ΩøÁî®ÊñáÊ°£ÁâáÊÆµÂáèÂ∞ëDOMÊìç‰Ωú
            const fragment = document.createDocumentFragment();
            
            // ÊòæÁ§∫ÊúÄÊñ∞ÁöÑÊï∞ÊçÆÁÇπÔºà‰∏∫‰∫ÜÊÄßËÉΩÔºåÊúÄÂ§öÊòæÁ§∫100Êù°Ôºâ
            const dataToShow = sensorData.slice(-100);
            
            // ÊâπÈáèÂàõÂª∫DOMÂÖÉÁ¥†
            dataToShow.forEach(item => {
                const row = document.createElement('tr');
                
                const timestampCell = document.createElement('td');
                timestampCell.textContent = item.timestamp;
                
                const sensorIdCell = document.createElement('td');
                sensorIdCell.textContent = item.sensorId;
                
                const valueCell = document.createElement('td');
                valueCell.textContent = item.value.toFixed(2);
                
                const statusCell = document.createElement('td');
                const statusBadge = document.createElement('span');
                statusBadge.className = `status-badge status-${item.status}`;
                statusBadge.textContent = item.status === 'normal' ? 'Ê≠£Â∏∏' : 
                                         item.status === 'warning' ? 'Ë≠¶Âëä' : 'ÂºÇÂ∏∏';
                statusCell.appendChild(statusBadge);
                
                row.appendChild(timestampCell);
                row.appendChild(sensorIdCell);
                row.appendChild(valueCell);
                row.appendChild(statusCell);
                
                fragment.appendChild(row);
            });
            
            // ‰∏ÄÊ¨°ÊÄßÊ∑ªÂä†ÊâÄÊúâË°åÔºåÂáèÂ∞ëÈ°µÈù¢ÈáçÊéí
            tableBody.appendChild(fragment);
        }

        // ÂàõÂª∫ÂõæË°®
        function createChart() {
            if (sensorData.length > 0) {
                noChartDataMessage.style.display = 'none';
                
                const ctx = document.getElementById('dataChart').getContext('2d');
                
                // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
                if (dataChart) {
                    dataChart.destroy();
                }
                
                // Êåâ‰º†ÊÑüÂô®Á±ªÂûãÂàÜÁªÑ
                const sensorTypes = ['Ê∏©Â∫¶', 'Â∫îÂèò', 'ÊåØÂä®', 'ÂÄæËßí', 'ÂÖ∂‰ªñ'];
                let datasetsByType = {};
                
                // ÂàùÂßãÂåñÊØèÁßçÁ±ªÂûãÁöÑÊï∞ÊçÆÈõÜ
                sensorTypes.forEach(type => {
                    datasetsByType[type] = [];
                });
                
                // Ëé∑ÂèñÂîØ‰∏ÄÁöÑ‰º†ÊÑüÂô®ID
                const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
                
                // ‰∏∫ÊØè‰∏™‰º†ÊÑüÂô®IDÂàÜÈÖç‰∏ÄÁßçÈ¢úËâ≤
                const sensorColors = {};
                const baseColors = [
                    { r: 255, g: 99, b: 132 },   // Á∫¢Ëâ≤Á≥ª
                    { r: 54, g: 162, b: 235 },   // ËìùËâ≤Á≥ª
                    { r: 255, g: 206, b: 86 },   // ÈªÑËâ≤Á≥ª
                    { r: 75, g: 192, b: 192 },   // ÈùíËâ≤Á≥ª
                    { r: 153, g: 102, b: 255 },  // Á¥´Ëâ≤Á≥ª
                    { r: 255, g: 159, b: 64 },   // Ê©ôËâ≤Á≥ª
                    { r: 99, g: 255, b: 132 },   // ÁªøËâ≤Á≥ª
                    { r: 235, g: 54, b: 162 }    // Á≤âËâ≤Á≥ª
                ];
                
                uniqueSensors.forEach((sensorId, index) => {
                    // Âæ™ÁéØ‰ΩøÁî®È¢úËâ≤
                    const colorIndex = index % baseColors.length;
                    const baseColor = baseColors[colorIndex];
                    
                    // Á®çÂæÆË∞ÉÊï¥È¢úËâ≤ÔºåÁ°Æ‰øùÂêå‰∏Ä‰º†ÊÑüÂô®Á±ªÂûãÁöÑÈ¢úËâ≤Áõ∏Ëøë‰ΩÜÂèØÂå∫ÂàÜ
                    const variant = Math.floor(index / baseColors.length);
                    const r = Math.max(0, Math.min(255, baseColor.r - variant * 20));
                    const g = Math.max(0, Math.min(255, baseColor.g - variant * 20));
                    const b = Math.max(0, Math.min(255, baseColor.b - variant * 20));
                    
                    sensorColors[sensorId] = {
                        border: `rgba(${r}, ${g}, ${b}, 1)`,
                        background: `rgba(${r}, ${g}, ${b}, 0.1)`
                    };
                });
                
                // Êåâ‰º†ÊÑüÂô®IDÂàÜÁªÑÊï∞ÊçÆ
                const datasets = [];
                
                uniqueSensors.forEach(sensorId => {
                    // Á°ÆÂÆö‰º†ÊÑüÂô®Á±ªÂûã
                    let sensorType = 'ÂÖ∂‰ªñ';
                    if (sensorId.includes('Ê∏©Â∫¶')) sensorType = 'Ê∏©Â∫¶';
                    else if (sensorId.includes('Â∫îÂèò')) sensorType = 'Â∫îÂèò';
                    else if (sensorId.includes('ÊåØÂä®')) sensorType = 'ÊåØÂä®';
                    else if (sensorId.includes('ÂÄæËßí')) sensorType = 'ÂÄæËßí';
                    
                    // Ëé∑ÂèñËØ•‰º†ÊÑüÂô®ÁöÑÊâÄÊúâÊï∞ÊçÆÁÇπ
                    const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                    
                    // ‰∏∫ÊØè‰∏™‰º†ÊÑüÂô®ÂàõÂª∫Êï∞ÊçÆÈõÜ
                    const dataset = {
                        label: `${sensorType}: ${sensorId}`,
                        data: sensorPoints.map(item => ({
                            x: item.timestamp,
                            y: item.value
                        })),
                        borderColor: sensorColors[sensorId].border,
                        backgroundColor: sensorColors[sensorId].background,
                        borderWidth: 2,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        tension: 0.3,
                        fill: false,
                        hidden: false // ÈªòËÆ§ÊòæÁ§∫ÊâÄÊúâ‰º†ÊÑüÂô®Êï∞ÊçÆ
                    };
                    
                    // Â∞ÜÊï∞ÊçÆÈõÜÊ∑ªÂä†Âà∞ÂØπÂ∫îÁöÑ‰º†ÊÑüÂô®Á±ªÂûãÁªÑ
                    datasetsByType[sensorType].push(dataset);
                });
                
                // ÂêàÂπ∂ÊâÄÊúâÊï∞ÊçÆÈõÜ
                sensorTypes.forEach(type => {
                    if (datasetsByType[type].length > 0) {
                        datasets.push(...datasetsByType[type]);
                    }
                });
                
                // ÂàõÂª∫Êñ∞ÂõæË°®Ôºå‰ΩøÁî®Êï£ÁÇπÂõæ‰ª•ÊîØÊåÅ‰∏çÂêåÊó∂Èó¥ËΩ¥ÁöÑÊï∞ÊçÆ
                dataChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    boxWidth: 12,
                                    usePointStyle: true,
                                    generateLabels: function(chart) {
                                        // ÁîüÊàêÂõæ‰æãÊ†áÁ≠æ
                                        const labels = Chart.defaults.plugins.legend.labels.generateLabels(chart);
                                        
                                        // Êåâ‰º†ÊÑüÂô®Á±ªÂûãÂàÜÁªÑÂõæ‰æã
                                        const groupedLabels = {};
                                        sensorTypes.forEach(type => {
                                            groupedLabels[type] = [];
                                        });
                                        
                                        labels.forEach(label => {
                                            // ‰ªéÊ†áÁ≠æÊñáÊú¨‰∏≠ÊèêÂèñ‰º†ÊÑüÂô®Á±ªÂûã
                                            const typeMatch = label.text.match(/^([^:]+):/);
                                            if (typeMatch) {
                                                const type = typeMatch[1].trim();
                                                if (sensorTypes.includes(type)) {
                                                    groupedLabels[type].push(label);
                                                } else {
                                                    groupedLabels['ÂÖ∂‰ªñ'].push(label);
                                                }
                                            } else {
                                                groupedLabels['ÂÖ∂‰ªñ'].push(label);
                                            }
                                        });
                                        
                                        // ÊâÅÂπ≥ÂåñÂàÜÁªÑÂêéÁöÑÊ†áÁ≠æ
                                        const result = [];
                                        sensorTypes.forEach(type => {
                                            if (groupedLabels[type].length > 0) {
                                                // Ê∑ªÂä†Á±ªÂûãÊ†áÈ¢òÔºà‰∏çÂèØÁÇπÂáªÔºâ
                                                result.push({
                                                    text: `${type}‰º†ÊÑüÂô®`,
                                                    fillStyle: 'rgba(0,0,0,0.1)',
                                                    strokeStyle: 'rgba(0,0,0,0.1)',
                                                    lineWidth: 0,
                                                    hidden: false,
                                                    index: -1, // Á°Æ‰øù‰∏ç‰∏éÂÆûÈôÖÊï∞ÊçÆÈõÜÂÜ≤Á™Å
                                                    isGroup: true
                                                });
                                                result.push(...groupedLabels[type]);
                                            }
                                        });
                                        
                                        return result;
                                    },
                                    onClick: function(e, legendItem, legend) {
                                        if (legendItem.isGroup) return; // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂàÜÁªÑÊ†áÈ¢òÔºå‰∏çÂÅö‰ªª‰ΩïÊìç‰Ωú
                                        
                                        // ÈªòËÆ§Âõæ‰æãÁÇπÂáªË°å‰∏∫
                                        const index = legendItem.datasetIndex;
                                        const ci = legend.chart;
                                        if (ci.isDatasetVisible(index)) {
                                            ci.hide(index);
                                            legendItem.hidden = true;
                                        } else {
                                            ci.show(index);
                                            legendItem.hidden = false;
                                        }
                                    }
                                }
                            },
                            tooltip: {
                                mode: 'nearest',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        const dataset = context.dataset;
                                        const value = context.raw.y;
                                        return `${dataset.label}: ${value.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        scales: {
                            x: {
                                type: 'category',
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            },
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: '‰º†ÊÑüÂô®ÂÄº'
                                }
                            }
                        }
                    }
                });
                
                // Ê∑ªÂä†ÊéßÂà∂Èù¢ÊùøÔºåÁî®‰∫éÊåâ‰º†ÊÑüÂô®Á±ªÂûãÁ≠õÈÄâÊòæÁ§∫
                createChartControls(sensorTypes);
            } else {
                noChartDataMessage.style.display = 'block';
            }
        }

        // ÂàõÂª∫ÂõæË°®ÊéßÂà∂Èù¢Êùø
        function createChartControls(sensorTypes) {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÊéßÂà∂Èù¢Êùø
            let controlPanel = document.getElementById('chart-controls');
            if (!controlPanel) {
                controlPanel = document.createElement('div');
                controlPanel.id = 'chart-controls';
                controlPanel.className = 'chart-controls';
                controlPanel.style.marginBottom = '15px';
                controlPanel.style.display = 'flex';
                controlPanel.style.flexWrap = 'wrap';
                controlPanel.style.gap = '10px';
                
                const chartContainer = document.getElementById('chart-container');
                chartContainer.insertBefore(controlPanel, document.getElementById('dataChart').parentNode);
            } else {
                controlPanel.innerHTML = ''; // Ê∏ÖÁ©∫Áé∞ÊúâÊéß‰ª∂
            }
            
            // Ê∑ªÂä†"ÂÖ®ÈÉ®ÊòæÁ§∫"ÊåâÈíÆ
            const showAllBtn = document.createElement('button');
            showAllBtn.textContent = 'ÊòæÁ§∫ÂÖ®ÈÉ®';
            showAllBtn.className = 'chart-control-btn active';
            showAllBtn.style.padding = '5px 10px';
            showAllBtn.style.backgroundColor = '#4299e1';
            showAllBtn.style.color = 'white';
            showAllBtn.style.border = '1px solid #3182ce';
            showAllBtn.style.borderRadius = '4px';
            showAllBtn.style.cursor = 'pointer';
            
            showAllBtn.addEventListener('click', function() {
                if (dataChart) {
                    dataChart.data.datasets.forEach((dataset, index) => {
                        dataChart.setDatasetVisibility(index, true);
                    });
                    dataChart.update();
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    document.querySelectorAll('.chart-control-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
            
            controlPanel.appendChild(showAllBtn);
            
            // ‰∏∫ÊØèÁßç‰º†ÊÑüÂô®Á±ªÂûãÊ∑ªÂä†Á≠õÈÄâÊåâÈíÆ
            sensorTypes.forEach(type => {
                const button = document.createElement('button');
                button.textContent = `${type}‰º†ÊÑüÂô®`;
                button.className = 'chart-control-btn';
                button.style.padding = '5px 10px';
                button.style.backgroundColor = '#e2e8f0';
                button.style.border = '1px solid #cbd5e0';
                button.style.borderRadius = '4px';
                button.style.cursor = 'pointer';
                
                button.addEventListener('click', function() {
                    if (dataChart) {
                        // ÈöêËóèÊâÄÊúâÊï∞ÊçÆÈõÜ
                        dataChart.data.datasets.forEach((dataset, index) => {
                            const isCurrentType = dataset.label.startsWith(`${type}:`);
                            dataChart.setDatasetVisibility(index, isCurrentType);
                        });
                        dataChart.update();
                        
                        // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                        document.querySelectorAll('.chart-control-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        this.classList.add('active');
                    }
                });
                
                controlPanel.appendChild(button);
            });
            
            // Ê∑ªÂä†CSSÊ†∑Âºè
            const style = document.createElement('style');
            style.textContent = `
                .chart-control-btn {
                    transition: all 0.2s ease;
                }
                .chart-control-btn:hover {
                    opacity: 0.9;
                }
                .chart-control-btn.active {
                    background-color: #4299e1 !important;
                    color: white !important;
                    border-color: #3182ce !important;
                }
            `;
            document.head.appendChild(style);
        }

        // ÂàõÂª∫ÂºÇÂ∏∏Ê£ÄÊµãÂõæË°®
        function createAnomalyChart() {
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            
            // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
            if (anomalyChart) {
                anomalyChart.destroy();
            }
            
            // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ
            const labels = Array.from({ length: zScores.length }, (_, i) => i + 1);
            
            // ÂàõÂª∫Z-scoreÊï∞ÊçÆÈõÜ
            const datasets = [
                {
                    label: 'Z-Score',
                    data: zScores,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderWidth: 2,
                    pointRadius: 3
                }
            ];
            
            // Ê∑ªÂä†ÂºÇÂ∏∏ÁÇπÊï∞ÊçÆÈõÜ
            if (anomalyIndices.length > 0) {
                // Âú®Z-ScoreÊõ≤Á∫ø‰∏äÊ†áËÆ∞Âá∫ÂºÇÂ∏∏ÁÇπ
                const anomalyData = zScores.map((z, i) => anomalyIndices.includes(i) ? z : null);
                
                datasets.push({
                    label: 'ÂçïÁÇπÂºÇÂ∏∏',
                    data: anomalyIndices.filter(i => anomalyTypes[i] === 'ÂçïÁÇπÂºÇÂ∏∏').map(i => zScores[i]),
                    pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false,
                    pointStyle: 'circle'
                });
                
                datasets.push({
                    label: 'ËøûÁª≠ÊÄßÂºÇÂ∏∏',
                    data: anomalyIndices.filter(i => anomalyTypes[i] === 'ËøûÁª≠ÊÄßÂºÇÂ∏∏').map(i => zScores[i]),
                    pointBackgroundColor: 'rgba(255, 159, 64, 1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false,
                    pointStyle: 'triangle'
                });
                
                datasets.push({
                    label: 'Áæ§‰ΩìÂºÇÂ∏∏',
                    data: anomalyIndices.filter(i => anomalyTypes[i] === 'Áæ§‰ΩìÂºÇÂ∏∏').map(i => zScores[i]),
                    pointBackgroundColor: 'rgba(153, 102, 255, 1)',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false,
                    pointStyle: 'rect'
                });
            }
            
            // ÂàõÂª∫ÂõæË°®
            anomalyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true
                            }
                        },
                        annotation: {
                            annotations: {
                                anomalyThreshold: {
                                    type: 'line',
                                    yMin: 2,
                                    yMax: 2,
                                    borderColor: 'rgba(255, 0, 0, 0.5)',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        display: true,
                                        content: 'ÂºÇÂ∏∏ÈòàÂÄº (Z-score = 2)',
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Êï∞ÊçÆÁÇπ'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Z-Score'
                            }
                        }
                    }
                }
            });
            
            // Â¶ÇÊûúÊ≠£Âú®Ê®°Êãü‰∫ã‰ª∂ÔºåÊ∑ªÂä†‰∫ã‰ª∂Âå∫ÂüüÊ≥®Èáä
            if (currentEventSimulation && currentEventSimulation !== bridgeEvents.NORMAL) {
                const eventName = eventSettings[currentEventSimulation].name;
                
                anomalyChart.options.plugins.annotation.annotations.eventRegion = {
                    type: 'box',
                    xMin: 0,
                    xMax: anomalyChart.data.labels.length - 1,
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    borderColor: 'rgba(255, 99, 132, 0.3)',
                    borderWidth: 1,
                    label: {
                        display: true,
                        content: `${eventName} ÂΩ±ÂìçÂå∫Âüü`,
                        position: 'start'
                    }
                };
                
                anomalyChart.update();
            }
        }

        // Ê£ÄÊµãÂºÇÂ∏∏
        function detectAnomalies() {
            if (!sensorData || sensorData.length === 0) {
                console.warn("Ê≤°ÊúâÊï∞ÊçÆÂèØ‰æõÊ£ÄÊµã");
                return {
                    totalPoints: 0,
                    anomalyCount: 0,
                    singlePointCount: 0,
                    continuousCount: 0,
                    clusterCount: 0,
                    anomalies: {}
                };
            }
            
            // Êåâ‰º†ÊÑüÂô®ÂàÜÁªÑÊï∞ÊçÆ
            const sensorGroups = {};
            
            sensorData.forEach(item => {
                if (!sensorGroups[item.sensorId]) {
                    sensorGroups[item.sensorId] = [];
                }
                sensorGroups[item.sensorId].push(item);
            });
            
            // Áî®‰∫éÂ≠òÂÇ®ÊØè‰∏™‰º†ÊÑüÂô®ÁöÑÂºÇÂ∏∏ÔºàÊåâÁ±ªÂûãÂàÜÁ±ªÔºâ
            const anomaliesBySensor = {};
            
            // Áî®‰∫éZ-scoreÂõæË°®Êï∞ÊçÆ
            zScores = [];
            anomalyIndices = [];
            anomalyTypes = [];
            
            // ÁªüËÆ°Êï∞ÊçÆ
            let totalDataPoints = 0;
            let totalAnomalies = 0;
            let singlePoints = 0;
            let continuousAnomalies = 0;
            let clusterAnomalies = 0;
            
            // ÂØπÊØè‰∏™‰º†ÊÑüÂô®ËøõË°åÂºÇÂ∏∏Ê£ÄÊµã
            for (const sensorId in sensorGroups) {
                const sensorDataPoints = sensorGroups[sensorId];
                
                // Ë∑≥ËøáÊï∞ÊçÆÈáèÂ§™Â∞ëÁöÑ‰º†ÊÑüÂô®
                if (sensorDataPoints.length < 5) continue;
                
                // ËÆ∞ÂΩïÊÄªÊï∞ÊçÆÁÇπÊï∞
                totalDataPoints += sensorDataPoints.length;
                
                // ÊèêÂèñÊï∞ÂÄºÊï∞ÁªÑ
                const values = sensorDataPoints.map(item => item.value);
                
                // ËÆ°ÁÆóÂü∫Êú¨ÁªüËÆ°Èáè
                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                
                // ËÆ°ÁÆóÊ†áÂáÜÂ∑Æ
                const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;
                const stddev = Math.sqrt(variance);
                
                // Â¶ÇÊûúÊ†áÂáÜÂ∑ÆËøáÂ∞èÔºåÂèØËÉΩË°®Á§∫Êï∞ÊçÆÂá†‰πéÊ≤°ÊúâÊ≥¢Âä®ÔºåËøôÁßçÊÉÖÂÜµ‰∏ãÂºÇÂ∏∏Ê£ÄÊµãÂèØËÉΩ‰∏çÈÄÇÁî®
                if (stddev < 0.001) continue;
                
                // ËÆ°ÁÆóZ-score
                const zScoreThreshold = 2.0; // Ê†áÂáÜËÆæÁΩÆ‰∏∫2ÔºåÂØπÂ∫îÁ∫¶5%ÁöÑÂºÇÂ∏∏Áéá
                const zScoreValues = values.map(value => Math.abs((value - mean) / stddev));
                
                // Ê∑ªÂä†Âà∞Z-scoreÈõÜÂêàÁî®‰∫éÂõæË°®
                zScores = zScores.concat(zScoreValues);
                
                // Ê£ÄÊµãÂºÇÂ∏∏
                const currentSensorAnomalies = [];
                
                // Âà§Êñ≠‰º†ÊÑüÂô®Á±ªÂûã
                let sensorType = 'ÂÖ∂‰ªñ';
                if (sensorId.includes('Ê∏©Â∫¶')) sensorType = 'Ê∏©Â∫¶';
                else if (sensorId.includes('Â∫îÂèò')) sensorType = 'Â∫îÂèò';
                else if (sensorId.includes('ÊåØÂä®')) sensorType = 'ÊåØÂä®';
                else if (sensorId.includes('ÂÄæËßí')) sensorType = 'ÂÄæËßí';
                
                // ÂçïÁÇπÂºÇÂ∏∏Ê£ÄÊµã
                zScoreValues.forEach((zScore, index) => {
                    if (zScore > zScoreThreshold) {
                        // Á°ÆÂÆöÂºÇÂ∏∏Á±ªÂûã
                        let anomalyType = 'ÂçïÁÇπÂºÇÂ∏∏';
                        
                        // Ê£ÄÊü•ÊòØÂê¶ËøûÁª≠ÂºÇÂ∏∏
                        if (index > 0 && index < zScoreValues.length - 1) {
                            if (zScoreValues[index-1] > zScoreThreshold || zScoreValues[index+1] > zScoreThreshold) {
                                anomalyType = 'ËøûÁª≠ÊÄßÂºÇÂ∏∏';
                            }
                        }
                        
                        // Ê∑ªÂä†ÂºÇÂ∏∏ËÆ∞ÂΩï
                        const dataPoint = sensorDataPoints[index];
                        currentSensorAnomalies.push({
                            sensorId: sensorId,
                            sensorType: sensorType,
                            timestamp: dataPoint.timestamp,
                            value: dataPoint.value,
                            zScore: zScore,
                            mean: mean,
                            stddev: stddev,
                            type: anomalyType
                        });
                        
                        // Ê∑ªÂä†Âà∞ÂÖ®Â±ÄanomalyIndicesÁî®‰∫éÂõæË°®
                        anomalyIndices.push(zScores.length - zScoreValues.length + index);
                        anomalyTypes.push(anomalyType);
                        
                        // ÁªüËÆ°ËÆ°Êï∞
                        totalAnomalies++;
                        if (anomalyType === 'ÂçïÁÇπÂºÇÂ∏∏') {
                            singlePoints++;
                        } else if (anomalyType === 'ËøûÁª≠ÊÄßÂºÇÂ∏∏') {
                            continuousAnomalies++;
                        }
                    }
                });
                
                // Áæ§‰ΩìÂºÇÂ∏∏Ê£ÄÊµãÔºà‰ΩøÁî®ÊªëÂä®Á™óÂè£Ê£ÄÊµãÂºÇÂ∏∏ÈõÜÁæ§Ôºâ
                const windowSize = 5; // ÊªëÂä®Á™óÂè£Â§ßÂ∞è
                for (let i = 0; i <= zScoreValues.length - windowSize; i++) {
                    const window = zScoreValues.slice(i, i + windowSize);
                    const windowMean = window.reduce((a, b) => a + b, 0) / windowSize;
                    
                    // Â¶ÇÊûúÁ™óÂè£ÂÜÖÂπ≥ÂùáZ-scoreË∂ÖËøáÈòàÂÄºÔºà‰ΩÜ‰∏çÊòØÂõ†‰∏∫Âçï‰∏™ÊûÅÁ´ØÂÄºÂºïËµ∑ÁöÑÔºâ
                    if (windowMean > zScoreThreshold * 0.7 && window.filter(z => z > zScoreThreshold).length >= 2) {
                        // Ê£ÄÊü•Ëøô‰∏™Á™óÂè£ÊòØÂê¶Â∑≤ÁªèÂåÖÂê´‰∫ÜÊ†áËÆ∞‰∏∫ËøûÁª≠ÊÄßÂºÇÂ∏∏ÁöÑÁÇπ
                        const hasMarkedAnomaly = window.some((_, idx) => {
                            const globalIdx = zScores.length - zScoreValues.length + i + idx;
                            return anomalyIndices.includes(globalIdx);
                        });
                        
                        // Â¶ÇÊûúËøô‰∏™Á™óÂè£Ê≤°ÊúâË¢´Ê†áËÆ∞ËøáÔºåÂàôÊ†áËÆ∞‰∏∫Áæ§‰ΩìÂºÇÂ∏∏
                        if (!hasMarkedAnomaly) {
                            // ÂèñÁ™óÂè£‰∏≠Èó¥ÁÇπ‰Ωú‰∏∫‰ª£Ë°®
                            const midIdx = i + Math.floor(windowSize / 2);
                            const dataPoint = sensorDataPoints[midIdx];
                            
                            currentSensorAnomalies.push({
                                sensorId: sensorId,
                                sensorType: sensorType,
                                timestamp: dataPoint.timestamp,
                                value: dataPoint.value,
                                zScore: zScoreValues[midIdx],
                                mean: mean,
                                stddev: stddev,
                                type: 'Áæ§‰ΩìÂºÇÂ∏∏'
                            });
                            
                            // Ê∑ªÂä†Âà∞ÂÖ®Â±Äindices
                            anomalyIndices.push(zScores.length - zScoreValues.length + midIdx);
                            anomalyTypes.push('Áæ§‰ΩìÂºÇÂ∏∏');
                            
                            // ÁªüËÆ°
                            totalAnomalies++;
                            clusterAnomalies++;
                        }
                    }
                }
                
                // ‰øùÂ≠òÂΩìÂâç‰º†ÊÑüÂô®ÁöÑÂºÇÂ∏∏
                if (currentSensorAnomalies.length > 0) {
                    anomaliesBySensor[sensorId] = currentSensorAnomalies;
                }
            }
            
            // ËøîÂõûÊ£ÄÊµãÁªìÊûú
            return {
                totalPoints: totalDataPoints,
                anomalyCount: totalAnomalies,
                singlePointCount: singlePoints,
                continuousCount: continuousAnomalies,
                clusterCount: clusterAnomalies,
                anomalies: anomaliesBySensor
            };
        }

        // ÁîüÊàêÊåâ‰º†ÊÑüÂô®Á±ªÂûãÂàÜÁªÑÁöÑÂºÇÂ∏∏ÂàóË°®
        function generateAnomalyList(anomaliesByType, sensorTypes) {
            anomalyList.innerHTML = '';  // Á°Æ‰øùÊ∏ÖÁ©∫‰πãÂâçÁöÑÂàóË°®
            
            const totalAnomalies = Object.values(anomaliesByType).reduce((sum, arr) => sum + arr.length, 0);
            
            if (totalAnomalies > 0) {
                // ÂàõÂª∫Á±ªÂûãÈÄâÊã©Âô®
                const typeSelector = document.createElement('div');
                typeSelector.className = 'anomaly-type-selector';
                typeSelector.style.marginBottom = '15px';
                typeSelector.style.display = 'flex';
                typeSelector.style.flexWrap = 'wrap';
                typeSelector.style.gap = '8px';
                
                // Ê∑ªÂä†"ÂÖ®ÈÉ®"ÈÄâÈ°π
                const allTypesBtn = document.createElement('button');
                allTypesBtn.textContent = 'ÂÖ®ÈÉ®ÂºÇÂ∏∏';
                allTypesBtn.className = 'anomaly-type-btn active';
                allTypesBtn.dataset.type = 'all';
                allTypesBtn.style.padding = '5px 12px';
                allTypesBtn.style.backgroundColor = '#4299e1';
                allTypesBtn.style.color = 'white';
                allTypesBtn.style.border = 'none';
                allTypesBtn.style.borderRadius = '4px';
                allTypesBtn.style.cursor = 'pointer';
                typeSelector.appendChild(allTypesBtn);
                
                // ‰∏∫ÊØèÁßç‰º†ÊÑüÂô®Á±ªÂûãÊ∑ªÂä†ÊåâÈíÆ
                sensorTypes.forEach(type => {
                    if (anomaliesByType[type].length > 0) {
                        const button = document.createElement('button');
                        button.textContent = `${type}‰º†ÊÑüÂô® (${anomaliesByType[type].length})`;
                        button.className = 'anomaly-type-btn';
                        button.dataset.type = type;
                        button.style.padding = '5px 12px';
                        button.style.backgroundColor = '#e2e8f0';
                        button.style.border = 'none';
                        button.style.borderRadius = '4px';
                        button.style.cursor = 'pointer';
                        typeSelector.appendChild(button);
                    }
                });
                
                // Ê∑ªÂä†ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨
                typeSelector.addEventListener('click', function(e) {
                    if (e.target.classList.contains('anomaly-type-btn')) {
                        // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                        document.querySelectorAll('.anomaly-type-btn').forEach(btn => {
                            btn.classList.remove('active');
                            btn.style.backgroundColor = '#e2e8f0';
                            btn.style.color = 'black';
                        });
                        e.target.classList.add('active');
                        e.target.style.backgroundColor = '#4299e1';
                        e.target.style.color = 'white';
                        
                        // ÊòæÁ§∫Áõ∏Â∫îÁ±ªÂûãÁöÑÂºÇÂ∏∏
                        const type = e.target.dataset.type;
                        showAnomaliesByType(type, anomaliesByType, sensorTypes);
                    }
                });
                
                // Ê∑ªÂä†Á±ªÂûãÈÄâÊã©Âô®Âà∞ÂºÇÂ∏∏ÂàóË°®Ââç
                anomalyList.parentNode.insertBefore(typeSelector, anomalyList);
                
                // ÈªòËÆ§ÊòæÁ§∫ÊâÄÊúâÂºÇÂ∏∏
                showAnomaliesByType('all', anomaliesByType, sensorTypes);
            } else {
                // Â¶ÇÊûúÊ≤°ÊúâÂºÇÂ∏∏ÔºåÊòæÁ§∫‰∏ÄÊù°‰ø°ÊÅØ
                const noAnomalyItem = document.createElement('li');
                noAnomalyItem.textContent = 'Êú™Ê£ÄÊµãÂà∞‰ªª‰ΩïÂºÇÂ∏∏Êï∞ÊçÆÁÇπ';
                noAnomalyItem.style.textAlign = 'center';
                noAnomalyItem.style.color = '#28a745';
                anomalyList.appendChild(noAnomalyItem);
            }
        }

        // ÊòæÁ§∫ÊåáÂÆöÁ±ªÂûãÁöÑÂºÇÂ∏∏
        function showAnomaliesByType(type, anomaliesByType, sensorTypes) {
            anomalyList.innerHTML = '';
            
            let anomaliesToShow = [];
            
            if (type === 'all') {
                // ÊòæÁ§∫ÊâÄÊúâÁ±ªÂûãÁöÑÂºÇÂ∏∏
                sensorTypes.forEach(t => {
                    if (anomaliesByType[t].length > 0) {
                        anomaliesToShow = anomaliesToShow.concat(anomaliesByType[t]);
                    }
                });
            } else {
                // ÊòæÁ§∫ÁâπÂÆöÁ±ªÂûãÁöÑÂºÇÂ∏∏
                anomaliesToShow = anomaliesByType[type];
            }
            
            // Êåâ‰∏•ÈáçÁ®ãÂ∫¶ÊéíÂ∫èÔºàZ-scoreÈôçÂ∫èÔºâ
            anomaliesToShow.sort((a, b) => b.zScore - a.zScore);
            
            // ÊòæÁ§∫ÂºÇÂ∏∏ÂàóË°®
            anomaliesToShow.forEach(anomaly => {
                const listItem = document.createElement('li');
                listItem.classList.add('anomaly-item');
                
                if (anomaly.zScore > 3.0) {
                    listItem.classList.add('severe');
                }
                
                // Ëé∑Âèñ‰º†ÊÑüÂô®Á±ªÂûãÂØπÂ∫îÁöÑÂçï‰Ωç
                let unit = '';
                if (anomaly.sensorType === 'Ê∏©Â∫¶') unit = '¬∞C';
                else if (anomaly.sensorType === 'Â∫îÂèò') unit = 'ŒºŒµ';
                else if (anomaly.sensorType === 'ÊåØÂä®') unit = 'Hz';
                else if (anomaly.sensorType === 'ÂÄæËßí') unit = '¬∞';
                
                listItem.innerHTML = `
                    <strong>Êó∂Èó¥:</strong> ${anomaly.timestamp} | 
                    <strong>‰º†ÊÑüÂô®:</strong> <span class="sensor-type">${anomaly.sensorType}</span>: ${anomaly.sensorId} | 
                    <strong>Êï∞ÂÄº:</strong> ${anomaly.value.toFixed(2)}${unit} | 
                    <strong>ZÂæóÂàÜ:</strong> ${anomaly.zScore.toFixed(2)} | 
                    <strong>Á±ªÂûã:</strong> ${anomaly.type}
                `;
                
                // ‰∏∫‰∏çÂêå‰º†ÊÑüÂô®Á±ªÂûãÊ∑ªÂä†‰∏çÂêåÁöÑÈ¢úËâ≤Ê†áËÆ∞
                const sensorTypeSpan = listItem.querySelector('.sensor-type');
                if (sensorTypeSpan) {
                    if (anomaly.sensorType === 'Ê∏©Â∫¶') {
                        sensorTypeSpan.style.color = '#e53e3e';
                    } else if (anomaly.sensorType === 'Â∫îÂèò') {
                        sensorTypeSpan.style.color = '#3182ce';
                    } else if (anomaly.sensorType === 'ÊåØÂä®') {
                        sensorTypeSpan.style.color = '#805ad5';
                    } else if (anomaly.sensorType === 'ÂÄæËßí') {
                        sensorTypeSpan.style.color = '#dd6b20';
                    }
                }
                
                anomalyList.appendChild(listItem);
            });
            
            // Â¶ÇÊûúÁ≠õÈÄâÂêéÊ≤°ÊúâÂºÇÂ∏∏ÔºåÊòæÁ§∫ÊèêÁ§∫
            if (anomaliesToShow.length === 0) {
                const noFilteredItem = document.createElement('li');
                noFilteredItem.textContent = `Êú™Ê£ÄÊµãÂà∞${type}‰º†ÊÑüÂô®ÁöÑÂºÇÂ∏∏Êï∞ÊçÆÁÇπ`;
                noFilteredItem.style.textAlign = 'center';
                noFilteredItem.style.color = '#718096';
                anomalyList.appendChild(noFilteredItem);
            }
        }

        // ÂàõÂª∫ÂºÇÂ∏∏ÂõæË°®ÊéßÂà∂Èù¢Êùø
        function createAnomalyChartControls(sensorTypes, anomaliesByType, chart) {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÊéßÂà∂Èù¢Êùø
            let controlPanel = document.getElementById('anomaly-chart-controls');
            if (!controlPanel) {
                controlPanel = document.createElement('div');
                controlPanel.id = 'anomaly-chart-controls';
                controlPanel.className = 'chart-controls';
                controlPanel.style.marginBottom = '15px';
                controlPanel.style.display = 'flex';
                controlPanel.style.flexWrap = 'wrap';
                controlPanel.style.gap = '10px';
                
                const chartContainer = document.getElementById('anomaly-chart-container');
                chartContainer.insertBefore(controlPanel, document.getElementById('anomalyChart'));
            } else {
                controlPanel.innerHTML = ''; // Ê∏ÖÁ©∫Áé∞ÊúâÊéß‰ª∂
            }
            
            // Ê∑ªÂä†"ÂÖ®ÈÉ®ÊòæÁ§∫"ÊåâÈíÆ
            const showAllBtn = document.createElement('button');
            showAllBtn.textContent = 'ÊòæÁ§∫ÂÖ®ÈÉ®';
            showAllBtn.className = 'chart-control-btn active';
            showAllBtn.style.padding = '5px 10px';
            showAllBtn.style.backgroundColor = '#4299e1';
            showAllBtn.style.color = 'white';
            showAllBtn.style.border = '1px solid #3182ce';
            showAllBtn.style.borderRadius = '4px';
            showAllBtn.style.cursor = 'pointer';
            
            showAllBtn.addEventListener('click', function() {
                if (chart) {
                    chart.data.datasets.forEach((dataset, index) => {
                        chart.setDatasetVisibility(index, true);
                    });
                    chart.update();
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    document.querySelectorAll('#anomaly-chart-controls .chart-control-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
            
            controlPanel.appendChild(showAllBtn);
            
            // ‰∏∫ÊØèÁßç‰º†ÊÑüÂô®Á±ªÂûãÊ∑ªÂä†Á≠õÈÄâÊåâÈíÆ
            sensorTypes.forEach(type => {
                if (anomaliesByType[type].length > 0) {
                    const button = document.createElement('button');
                    button.textContent = `${type}‰º†ÊÑüÂô® (${anomaliesByType[type].length})`;
                    button.className = 'chart-control-btn';
                    button.style.padding = '5px 10px';
                    button.style.backgroundColor = '#e2e8f0';
                    button.style.border = '1px solid #cbd5e0';
                    button.style.borderRadius = '4px';
                    button.style.cursor = 'pointer';
                    
                    button.addEventListener('click', function() {
                        if (chart) {
                            // ÈöêËóèÊâÄÊúâÊï∞ÊçÆÈõÜ
                            chart.data.datasets.forEach((dataset, index) => {
                                const isCurrentType = dataset.label.includes(`${type}:`);
                                chart.setDatasetVisibility(index, isCurrentType);
                            });
                            chart.update();
                            
                            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                            document.querySelectorAll('#anomaly-chart-controls .chart-control-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            this.classList.add('active');
                        }
                    });
                    
                    controlPanel.appendChild(button);
                }
            });
        }

        // ÈáçÁΩÆÊâÄÊúâÊï∞ÊçÆÂíåÁä∂ÊÄÅ
        function resetAll() {
            // ÈáçÁΩÆÊï∞ÊçÆ
            sensorData = [];
            
            // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•
            fileInput.value = '';
            fileInfo.textContent = 'Êú™ÈÄâÊã©Êñá‰ª∂';
            uploadButton.disabled = true;  // Á°Æ‰øùÊ£ÄÊµãÊåâÈíÆÂàùÂßãÁä∂ÊÄÅ‰∏∫Á¶ÅÁî®
            
            // Ê∏ÖÈô§Ë°®Ê†ºÊï∞ÊçÆ
            const tableBody = dataTable.getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            noDataMessage.style.display = 'block';
            
            // Ê∏ÖÈô§ÂõæË°®
            if (dataChart) {
                dataChart.destroy();
                dataChart = null;
            }
            noChartDataMessage.style.display = 'block';
            
            // Ê∏ÖÈô§ÂºÇÂ∏∏ÂàÜÊûêÁªìÊûú
            noAnalysisMessage.style.display = 'block';
            analysisLoader.style.display = 'none';
            analysisSummary.style.display = 'none';
            anomalyList.innerHTML = '';
            
            // ÈöêËóèÊ°•Ê¢ÅÁõëÊéß
            noMonitorMessage.style.display = 'block';
            
            // ÂÅúÊ≠¢Êï∞ÊçÆÊõ¥Êñ∞
            stopDataUpdates();
            
            // ÂàáÊç¢Âà∞Êï∞ÊçÆÊü•ÁúãÊ†áÁ≠æ
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="data"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('data-tab').classList.add('active');
        }

        // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆ
        function createSampleData() {
            console.log("ÂºÄÂßãÁîüÊàêÊ†∑Êú¨Êï∞ÊçÆ");
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const fileInfoElement = document.getElementById('fileInfo');
            if (fileInfoElement) {
                fileInfoElement.textContent = 'Ê≠£Âú®ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆ...';
            }
            
            // Á¶ÅÁî®ÊåâÈíÆÈò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
            const sampleBtnElement = document.getElementById('sampleButton');
            if (sampleBtnElement) {
                sampleBtnElement.disabled = true;
            }
            
            // ÈáçÁΩÆÊï∞ÊçÆ
            sensorData = [];
            
            // Ê£ÄÊü•Ë°®Ê†ºÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
            const dataTable = document.getElementById('sensorDataTable');
            if (dataTable && dataTable.querySelector('tbody')) {
                dataTable.querySelector('tbody').innerHTML = '<tr><td colspan="5" class="text-center">Ê≠£Âú®ÁîüÊàêÊï∞ÊçÆÔºåËØ∑Á®çÂÄô...</td></tr>';
            }
            
            // ÂÆö‰πâ‰º†ÊÑüÂô®Á±ªÂûãÂíå‰ΩçÁΩÆ
            const sensorTypes = [
                { type: 'Ê∏©Â∫¶', count: 15, unit: '¬∞C' },
                { type: 'Â∫îÂèò', count: 15, unit: 'ŒºŒµ' },
                { type: 'ÊåØÂä®', count: 15, unit: 'Hz' },
                { type: 'ÂÄæËßí', count: 10, unit: '¬∞' },
                { type: '‰ΩçÁßª', count: 10, unit: 'mm' },
                { type: 'Âä†ÈÄüÂ∫¶', count: 10, unit: 'm/s¬≤' },
                { type: 'ËΩΩÈáç', count: 5, unit: 'kN' },
                { type: 'È£éÈÄü', count: 5, unit: 'm/s' },
                { type: 'ÂéãÂäõ', count: 5, unit: 'kPa' },
                { type: 'ÊπøÂ∫¶', count: 5, unit: '%' }
            ];
            
            const sections = ['ÂåóÊÆµ', '‰∏≠ÊÆµ', 'ÂçóÊÆµ', '‰∏úÊÆµ', 'Ë•øÊÆµ', 'ÊîØÊíëÁªìÊûÑ', 'ËøûÊé•ÈÉ®‰Ωç'];
            const positions = ['Ê°•Èù¢', 'Ê°•Â¢©', 'Ê°•Â°î', 'ÂêäÁ¥¢', 'ÊîØÂ∫ß', '‰º∏Áº©Áºù', '‰∫§ÈÄöÁõëÊéß'];
            
            // ÂºÇÊ≠•Â§ÑÁêÜÈÅøÂÖçÁïåÈù¢ÂÜªÁªì
            setTimeout(function() {
                try {
                    // ÂàõÂª∫‰º†ÊÑüÂô®Êï∞ÊçÆ
                    let sensorId = 1;
                    
                    // ‰∏∫ÊØèÁßç‰º†ÊÑüÂô®Á±ªÂûãÁîüÊàêÊ†∑Êú¨Êï∞ÊçÆ
                    sensorTypes.forEach(sensor => {
                        for (let i = 0; i < sensor.count; i++) {
                            const section = sections[Math.floor(Math.random() * sections.length)];
                            const position = positions[Math.floor(Math.random() * positions.length)];
                            const sensorName = `${sensor.type}-${section}-${position}-${sensorId.toString().padStart(3, '0')}`;
                            
                            // Ê†πÊçÆ‰º†ÊÑüÂô®Á±ªÂûãÁ°ÆÂÆöÂü∫ÂáÜÂÄºÂíåËåÉÂõ¥
                            let baseValue, minValue, maxValue, warningThreshold, alarmThreshold;
                            
                            switch(sensor.type) {
                                case 'Ê∏©Â∫¶':
                                    baseValue = 25;
                                    minValue = 5;
                                    maxValue = 55;
                                    warningThreshold = 40;
                                    alarmThreshold = 45;
                                    break;
                                case 'Â∫îÂèò':
                                    baseValue = 200;
                                    minValue = 50;
                                    maxValue = 400;
                                    warningThreshold = 300;
                                    alarmThreshold = 350;
                                    break;
                                case 'ÊåØÂä®':
                                    baseValue = 0.5;
                                    minValue = 0.05;
                                    maxValue = 3.0;
                                    warningThreshold = 1.5;
                                    alarmThreshold = 2.0;
                                    break;
                                case 'ÂÄæËßí':
                                    baseValue = 0.5;
                                    minValue = 0;
                                    maxValue = 3.0;
                                    warningThreshold = 1.5;
                                    alarmThreshold = 2.0;
                                    break;
                                case '‰ΩçÁßª':
                                    baseValue = 5;
                                    minValue = 0;
                                    maxValue = 30;
                                    warningThreshold = 15;
                                    alarmThreshold = 20;
                                    break;
                                case 'Âä†ÈÄüÂ∫¶':
                                    baseValue = 0.2;
                                    minValue = 0;
                                    maxValue = 1.5;
                                    warningThreshold = 0.8;
                                    alarmThreshold = 1.0;
                                    break;
                                case 'ËΩΩÈáç':
                                    baseValue = 1000;
                                    minValue = 0;
                                    maxValue = 3000;
                                    warningThreshold = 2000;
                                    alarmThreshold = 2500;
                                    break;
                                case 'È£éÈÄü':
                                    baseValue = 5;
                                    minValue = 0;
                                    maxValue = 30;
                                    warningThreshold = 18;
                                    alarmThreshold = 25;
                                    break;
                                case 'ÂéãÂäõ':
                                    baseValue = 100;
                                    minValue = 50;
                                    maxValue = 200;
                                    warningThreshold = 160;
                                    alarmThreshold = 180;
                                    break;
                                case 'ÊπøÂ∫¶':
                                    baseValue = 60;
                                    minValue = 20;
                                    maxValue = 95;
                                    warningThreshold = 85;
                                    alarmThreshold = 90;
                                    break;
                                default:
                                    baseValue = 50;
                                    minValue = 0;
                                    maxValue = 100;
                                    warningThreshold = 80;
                                    alarmThreshold = 90;
                            }
                            
                            // ÂàõÂª∫Êó∂Èó¥Êà≥ÔºåÊØèÂçäÂ∞èÊó∂‰∏Ä‰∏™Êï∞ÊçÆÁÇπÔºåÊúÄÂ§öÂàõÂª∫12Â∞èÊó∂ÁöÑÊï∞ÊçÆÔºà24‰∏™ÁÇπÔºâ
                            const now = new Date();
                            const timestamps = [];
                            for (let t = 0; t < 24; t++) {
                                const timestamp = new Date(now.getTime() - (t * 30 * 60000));
                                timestamps.push(timestamp.toLocaleString('zh-CN', {
                                    year: 'numeric',
                                    month: '2-digit',
                                    day: '2-digit',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                }));
                            }
                            
                            // ÁîüÊàêÊï∞ÊçÆÁÇπ
                            for (let j = 0; j < timestamps.length; j++) {
                                // ‰∏∫‰∫ÜÊ®°ÊãüÁúüÂÆûÊï∞ÊçÆÔºåÊ†πÊçÆÊüêÁßçÊ®°ÂºèÁîüÊàêÊï∞ÊçÆÂÄº
                                let value;
                                if (sensor.type === 'Ê∏©Â∫¶') {
                                    // Ê∏©Â∫¶ÈöèÊó∂Èó¥ÂëàÁé∞Ê≠£Âº¶Ê≥¢Âä®
                                    const hour = new Date(timestamps[j]).getHours();
                                    value = baseValue + 5 * Math.sin((hour / 24) * Math.PI * 2) + (Math.random() * 3 - 1.5);
                                } else if (sensor.type === 'È£éÈÄü') {
                                    // È£éÈÄüÂú®ÁôΩÂ§©ËæÉÂ§ß
                                    const hour = new Date(timestamps[j]).getHours();
                                    value = baseValue + 3 * Math.sin((hour / 24) * Math.PI) + (Math.random() * 2);
                                } else if (sensor.type === 'ËΩΩÈáç') {
                                    // ËΩΩÈáçÂú®‰∫§ÈÄöÈ´òÂ≥∞ÊúüËæÉÂ§ß
                                    const hour = new Date(timestamps[j]).getHours();
                                    const trafficPeak = (hour >= 7 && hour <= 9) || (hour >= 17 && hour <= 19);
                                    value = baseValue + (trafficPeak ? 800 : 200) * Math.random();
                                } else {
                                    // ÂÖ∂‰ªñ‰º†ÊÑüÂô®Êï∞ÊçÆÂü∫‰∫éÈöèÊú∫Ê≥¢Âä®
                                    value = baseValue + (Math.random() * 2 - 1) * (maxValue - minValue) * 0.2;
                                }
                                
                                // ÂºÇÂ∏∏Ê¶ÇÁéá
                                if (Math.random() < 0.2) { // Â¢ûÂä†Âà∞20%ÁöÑÂºÇÂ∏∏Ê¶ÇÁéá
                                    // ÁîüÊàêÂºÇÂ∏∏Êï∞ÊçÆ
                                    const anomalyDirection = Math.random() > 0.5 ? 1 : -1;
                                    const anomalyMagnitude = (Math.random() * 0.4 + 0.1) * (maxValue - minValue);
                                    value += anomalyDirection * anomalyMagnitude;
                                }
                                
                                // Á°Æ‰øùÂÄºÂú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ
                                value = Math.max(minValue, Math.min(maxValue, value));
                                
                                // Á°ÆÂÆö‰º†ÊÑüÂô®Áä∂ÊÄÅ
                                let status = 'normal';
                                if (value > warningThreshold && value < alarmThreshold) {
                                    status = 'warning';
                                } else if (value > alarmThreshold || value < minValue) {
                                    status = 'danger';
                                }
                                
                                // Ê∑ªÂä†Âà∞Êï∞ÊçÆÈõÜ
                                sensorData.push({
                                    timestamp: timestamps[j],
                                    sensorId: sensorName,
                                    value: parseFloat(value.toFixed(2)),
                                    status: status,
                                    sensorType: sensor.type,
                                    location: section,
                                    position: position,
                                    unit: sensor.unit
                                });
                            }
                            
                            sensorId++;
                        }
                    });
                    
                    // Êõ¥Êñ∞UI
                    displayData();
                    
                    // Â¶ÇÊûúÂáΩÊï∞Â≠òÂú®ÂàôË∞ÉÁî®
                    if (typeof createChart === 'function') {
                        createChart();
                    }
                    
                    // ÂàùÂßãÂåñÊ°•Ê¢ÅÁä∂ÊÄÅ
                    if (typeof initBridgeMonitor === 'function') {
                        initBridgeMonitor();
                    }
                    
                    // ÂàùÂßãÂåñ‰∫ã‰ª∂È¢ÑÊµã
                    if (typeof initializeEventPredictions === 'function') {
                        initializeEventPredictions();
                    } else {
                        console.warn("initializeEventPredictions ÂáΩÊï∞‰∏çÂ≠òÂú®");
                    }
                    
                    // ‰ΩøÊ£ÄÊµãÊåâÈíÆÂèØÁî®
                    const detectBtn = document.getElementById('detectButton');
                    if (detectBtn) {
                        detectBtn.disabled = false;
                    }
                    
                } catch (error) {
                    console.error("ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆÊó∂Âá∫Èîô:", error);
                    if (fileInfoElement) {
                        fileInfoElement.textContent = `ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆÂ§±Ë¥•: ${error.message}`;
                    }
                } finally {
                    // ÈáçÊñ∞ÂêØÁî®ÊåâÈíÆ
                    const sampleBtn = document.getElementById('sampleButton');
                    if (sampleBtn) {
                        sampleBtn.disabled = false;
                    }
                }
            }, 10);
        }

        // ÁîüÊàêÂπ∂‰∏ãËΩΩÁ§∫‰æãÊñá‰ª∂
        function generateExampleFile() {
            // ÈòªÊ≠¢ÈªòËÆ§ÈìæÊé•ÁÇπÂáªË°å‰∏∫
            event.preventDefault();
            
            // ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆ
            const exampleData = [];
            const now = new Date();
            
            // Ê∑ªÂä†Ë°®Â§¥
            exampleData.push("Êó∂Èó¥Êà≥,‰º†ÊÑüÂô®ID,Êï∞ÂÄº");
            
            // Ê∑ªÂä†Ê∏©Â∫¶‰º†ÊÑüÂô®Êï∞ÊçÆÁ§∫‰æã
            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(now.getTime() - (19-i) * 30 * 60 * 1000); // 30ÂàÜÈíüÈó¥Èöî
                const timeStr = timestamp.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(',', ' ');
                
                // Ê∏©Â∫¶ÂÄº(ÊëÑÊ∞èÂ∫¶)ÔºåÁ∫¶25Â∫¶Â∑¶Âè≥Ê≥¢Âä®
                let tempValue = 25 + Math.sin(i/3) * 2 + (Math.random() - 0.5);
                exampleData.push(`${timeStr},Ê∏©Â∫¶‰º†ÊÑüÂô®-‰∏ªÊ°•ÂåóÊÆµ,${tempValue.toFixed(2)}`);
            }
            
            // Ê∑ªÂä†Â∫îÂèò‰º†ÊÑüÂô®Êï∞ÊçÆÁ§∫‰æã
            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(now.getTime() - (19-i) * 30 * 60 * 1000); // 30ÂàÜÈíüÈó¥Èöî
                const timeStr = timestamp.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(',', ' ');
                
                // Â∫îÂèòÂÄº(ŒºŒµ)ÔºåÁ∫¶200Â∑¶Âè≥Ê≥¢Âä®
                let strainValue = 200 + Math.sin(i/4) * 15 + (Math.random() - 0.5) * 5;
                exampleData.push(`${timeStr},Â∫îÂèò‰º†ÊÑüÂô®-‰∏ªÊ°•‰∏≠ÊÆµ,${strainValue.toFixed(2)}`);
            }
            
            // Ê∑ªÂä†ÊåØÂä®‰º†ÊÑüÂô®Êï∞ÊçÆÁ§∫‰æã
            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(now.getTime() - (19-i) * 30 * 60 * 1000); // 30ÂàÜÈíüÈó¥Èöî
                const timeStr = timestamp.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(',', ' ');
                
                // ÊåØÂä®ÂÄº(g)ÔºåÁ∫¶0.5Â∑¶Âè≥Ê≥¢Âä®
                let vibValue = 0.5 + Math.sin(i/2) * 0.1 + (Math.random() - 0.5) * 0.1;
                if (i === 10) vibValue = 1.2; // Ê∑ªÂä†ÂºÇÂ∏∏ÂÄº
                exampleData.push(`${timeStr},ÊåØÂä®‰º†ÊÑüÂô®-‰∏ªÊ°•ÂçóÊÆµ,${vibValue.toFixed(2)}`);
            }
            
            // Â∞ÜÁ§∫‰æãÊï∞ÊçÆËΩ¨Êç¢‰∏∫CSVÊñáÊú¨
            const csvContent = exampleData.join('\n');
            
            // ÂàõÂª∫BlobÂØπË±°
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'Ê°•Ê¢ÅÁõëÊµãÊï∞ÊçÆÁ§∫‰æã.csv');
            link.style.visibility = 'hidden';
            
            // Ê∑ªÂä†Âà∞DOMÔºåËß¶Âèë‰∏ãËΩΩÔºåÁÑ∂ÂêéÁßªÈô§
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // ÈöèÊú∫Âà∑Êñ∞Êï∞ÊçÆÂäüËÉΩ
        function startRandomDataUpdates() {
            // ÂÅúÊ≠¢‰πãÂâçÁöÑÊõ¥Êñ∞
            stopDataUpdates();
            
            // Á°Æ‰øùÊúâÊï∞ÊçÆ
            if (!sensorData || sensorData.length === 0) {
                alert('ËØ∑ÂÖà‰∏ä‰º†Êï∞ÊçÆÊàñÁîüÊàêÁ§∫‰æãÊï∞ÊçÆ');
                return;
            }
            
            // ÊòæÁ§∫Ê≠£Âú®Âà∑Êñ∞ÊèêÁ§∫
            fileInfo.textContent = 'Êï∞ÊçÆÂà∑Êñ∞‰∏≠...';
            refreshButton.textContent = 'ÂÅúÊ≠¢Âà∑Êñ∞';
            refreshButton.classList.add('danger');
            
            // ÂêØÁî®Ê£ÄÊµãÊåâÈíÆÔºåÁ°Æ‰øùÂú®Êï∞ÊçÆÂà∑Êñ∞Êó∂ÂèØ‰ª•ËøõË°åÊ£ÄÊµã
            detectButton.disabled = false;
            
            // ÊØè5ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Êï∞ÊçÆÔºàÊõ¥Á¨¶ÂêàÊ°•Ê¢ÅÁõëÊµãÁöÑÂÆûÈôÖÈ¢ëÁéáÔºâ
            dataUpdateInterval = setInterval(() => {
                randomlyUpdateData();
            }, 5000);
        }
        
        // ÂÅúÊ≠¢Êï∞ÊçÆÊõ¥Êñ∞
        function stopDataUpdates() {
            if (dataUpdateInterval) {
                clearInterval(dataUpdateInterval);
                dataUpdateInterval = null;
                
                refreshButton.textContent = 'ÈöèÊú∫Âà∑Êñ∞Êï∞ÊçÆ';
                refreshButton.classList.remove('danger');
                
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    fileInfo.textContent = `Â∑≤ÈÄâÊã©Êñá‰ª∂: ${file.name} (${formatFileSize(file.size)})`;
                } else {
                    fileInfo.textContent = 'Êú™ÈÄâÊã©Êñá‰ª∂';
                }
            }
        }
        
        // ÈöèÊú∫Êõ¥Êñ∞Êï∞ÊçÆÔºå‰ΩøÊ®°ÊãüÊï∞ÊçÆÊõ¥Á¨¶ÂêàÁâ©ÁêÜÁé∞ÂÆûÂπ∂Ê∑ªÂä†‰∫ã‰ª∂
        function randomlyUpdateData() {
            if (!sensorData || sensorData.length === 0) return;
            
            // Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥‰Ωú‰∏∫Êñ∞ÁöÑÊï∞ÊçÆÁÇπÊó∂Èó¥Êà≥
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Ëé∑ÂèñÂîØ‰∏ÄÁöÑ‰º†ÊÑüÂô®IDÂàóË°®
            const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
            
            // ÂàõÂª∫ÁéØÂ¢ÉÂõ†Á¥†ÔºåÁ°Æ‰øùÊï∞ÊçÆ‰πãÈó¥ÁöÑÂÖ≥ËÅîÊÄß
            const environmentalFactor = Math.sin(Date.now() / 10000000) * 0.15; // ÁºìÊÖ¢ÂèòÂåñÁöÑÁéØÂ¢ÉÂõ†Á¥†
            const timeOfDayFactor = Math.sin(now.getHours() / 24 * Math.PI) * 0.1; // Êó•Èó¥ÂèòÂåñÂõ†Á¥†
            const bridgeLoadFactor = Math.sin(Date.now() / 3600000) * 0.08; // Ê°•Ê¢ÅË¥üËΩΩÂèòÂåñ
            
            // ÂÖ®Â±ÄÊ∏©Â∫¶ÂΩ±Âìç
            const temperature = 20 + Math.sin(now.getHours() / 24 * Math.PI * 2) * 5 + Math.random() * 2;
            
            // ÈöèÊú∫ÁîüÊàê‰∫ã‰ª∂
            let currentEvent = null;
            const eventProbability = Math.random();
            let eventImpact = 0;
            let eventLocation = '';
            let eventSeverity = 'low';
            let affectedSensorTypes = [];
            let affectedSections = [];
            let eventReasoning = 'ÊâÄÊúâ‰º†ÊÑüÂô®Êï∞ÊçÆÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÊó†ÂºÇÂ∏∏Ê®°Âºè';
            
            // ÂÆö‰πâÂèØËÉΩÁöÑ‰∫ã‰ª∂Á±ªÂûã
            const possibleEvents = [
                {
                    type: 'Ê≠£Â∏∏ËøêÁª¥‰∏≠',
                    probability: 0.80, // 80%Ê¶ÇÁéáÊ≠£Â∏∏ËøêË°å
                    impact: 0,
                    severity: 'low',
                    affectedTypes: [],
                    affectedSections: []
                },
                {
                    type: '‰∫§ÈÄöË¥üËΩΩËøáÈ´ò',
                    probability: 0.05, // 5%Ê¶ÇÁéá
                    impact: 0.4,
                    severity: 'medium',
                    affectedTypes: ['Â∫îÂèò', 'ÊåØÂä®', 'ËΩΩÈáç'],
                    affectedSections: ['‰∏≠ÊÆµ', 'ÂåóÊÆµ']
                },
                {
                    type: 'ÁªìÊûÑÂ∫îÂèòÂºÇÂ∏∏',
                    probability: 0.03, // 3%Ê¶ÇÁéá
                    impact: 0.6,
                    severity: 'high',
                    affectedTypes: ['Â∫îÂèò', '‰ΩçÁßª', 'ÂÄæËßí'],
                    affectedSections: ['ÂçóÊÆµ', 'ÊîØÊíëÁªìÊûÑ']
                },
                {
                    type: 'Ê∏©Â∫¶ÂºÇÂ∏∏Ê≥¢Âä®',
                    probability: 0.04, // 4%Ê¶ÇÁéá
                    impact: 0.3,
                    severity: 'medium',
                    affectedTypes: ['Ê∏©Â∫¶', 'Â∫îÂèò'],
                    affectedSections: ['ÂÖ®Ê°•']
                },
                {
                    type: 'Â§ñÈÉ®ÈúáÂä®Âπ≤Êâ∞',
                    probability: 0.03, // 3%Ê¶ÇÁéá
                    impact: 0.5,
                    severity: 'medium',
                    affectedTypes: ['ÊåØÂä®', 'Âä†ÈÄüÂ∫¶'],
                    affectedSections: ['‰∏úÊÆµ', 'Ë•øÊÆµ']
                },
                {
                    type: 'È£éÂäõÂΩ±ÂìçÊòéÊòæ',
                    probability: 0.03, // 3%Ê¶ÇÁéá
                    impact: 0.35,
                    severity: 'low',
                    affectedTypes: ['ÊåØÂä®', 'ÂÄæËßí'],
                    affectedSections: ['ÂÖ®Ê°•']
                },
                {
                    type: 'ÊîØÂ∫ß‰ΩçÁßªÂºÇÂ∏∏',
                    probability: 0.01, // 1%Ê¶ÇÁéá
                    impact: 0.7,
                    severity: 'high',
                    affectedTypes: ['‰ΩçÁßª', 'Â∫îÂèò', 'ÂÄæËßí'],
                    affectedSections: ['ËøûÊé•ÈÉ®‰Ωç', 'ÊîØÊíëÁªìÊûÑ']
                },
                {
                    type: 'ÂêäÁ¥¢Âº†ÂäõÂèòÂåñ',
                    probability: 0.01, // 1%Ê¶ÇÁéá
                    impact: 0.5,
                    severity: 'medium',
                    affectedTypes: ['Â∫îÂèò', 'Âä†ÈÄüÂ∫¶'],
                    affectedSections: ['ËøûÊé•ÈÉ®‰Ωç']
                }
            ];
            
            // Á¥ØÁßØÊ¶ÇÁéáÁ°ÆÂÆö‰∫ã‰ª∂
            let cumulativeProbability = 0;
            for (const event of possibleEvents) {
                cumulativeProbability += event.probability;
                if (eventProbability <= cumulativeProbability) {
                    currentEvent = event;
                    eventImpact = event.impact;
                    eventSeverity = event.severity;
                    affectedSensorTypes = event.affectedTypes;
                    
                    // Á°ÆÂÆöÂΩ±ÂìçÂå∫ÊÆµ
                    if (event.affectedSections.includes('ÂÖ®Ê°•')) {
                        affectedSections = ['ÂåóÊÆµ', '‰∏≠ÊÆµ', 'ÂçóÊÆµ', '‰∏úÊÆµ', 'Ë•øÊÆµ', 'ÊîØÊíëÁªìÊûÑ', 'ËøûÊé•ÈÉ®‰Ωç'];
                    } else {
                        affectedSections = event.affectedSections;
                    }
                    
                    // ‰∏∫‰∏çÂêå‰∫ã‰ª∂Á±ªÂûãÁîüÊàê‰∏çÂêåÁöÑÂà§Êñ≠‰æùÊçÆ
                    switch (event.type) {
                        case '‰∫§ÈÄöË¥üËΩΩËøáÈ´ò':
                            eventReasoning = '‰∏≠ÊÆµËΩΩÈáç‰º†ÊÑüÂô®Êï∞ÊçÆÊåÅÁª≠ÂÅèÈ´òÔºåÊåØÂä®È¢ëÁéáÂ¢ûÂä†Ôºå‰∏é‰∫§ÈÄöÈ´òÂ≥∞ÊúüÊ®°ÂºèÂåπÈÖç';
                            break;
                        case 'ÁªìÊûÑÂ∫îÂèòÂºÇÂ∏∏':
                            eventReasoning = 'ÂçóÊÆµÂ∫îÂèò‰º†ÊÑüÂô®ÂíåÊîØÊíëÁªìÊûÑ‰ΩçÁßªÊï∞ÊçÆÂºÇÂ∏∏Ôºå‰∏éÂéÜÂè≤Â∫îÂèòÊ®°Âºè‰∏çÁ¨¶';
                            break;
                        case 'Ê∏©Â∫¶ÂºÇÂ∏∏Ê≥¢Âä®':
                            eventReasoning = 'ÂÖ®Ê°•Ê∏©Â∫¶‰º†ÊÑüÂô®Êï∞ÊçÆÂá∫Áé∞ÈùûÊ≠£Â∏∏Ê∏©Â∫¶ÂèòÂåñÔºåË∂ÖÂá∫Â≠£ËäÇÊÄßÈ¢ÑÊúüËåÉÂõ¥';
                            break;
                        case 'Â§ñÈÉ®ÈúáÂä®Âπ≤Êâ∞':
                            eventReasoning = '‰∏úË•ø‰∏§ÊÆµÂä†ÈÄüÂ∫¶ÂíåÊåØÂä®‰º†ÊÑüÂô®Ê£ÄÊµãÂà∞ÂºÇÂ∏∏ÈúáÂä®Ê®°ÂºèÔºåÂèØËÉΩÂèóÂ§ñÈÉ®Â∑•Á®ãÂΩ±Âìç';
                            break;
                        case 'È£éÂäõÂΩ±ÂìçÊòéÊòæ':
                            eventReasoning = 'ÂÖ®Ê°•ÊåØÂä®ÂíåÂÄæËßí‰º†ÊÑüÂô®Êï∞ÊçÆÊ≥¢Âä®Â¢ûÂ§ßÔºå‰∏éÊ∞îË±°Á´ôÈ£éÈÄüÊï∞ÊçÆÁõ∏ÂÖ≥';
                            break;
                        case 'ÊîØÂ∫ß‰ΩçÁßªÂºÇÂ∏∏':
                            eventReasoning = 'ËøûÊé•ÈÉ®‰Ωç‰ΩçÁßª‰º†ÊÑüÂô®Êï∞ÊçÆÁ™ÅÂèòÔºåÊîØÊíëÁªìÊûÑÂÄæËßíÂèòÂåñÊòæËëó';
                            break;
                        case 'ÂêäÁ¥¢Âº†ÂäõÂèòÂåñ':
                            eventReasoning = 'ËøûÊé•ÈÉ®‰ΩçÂêäÁ¥¢Â∫îÂèòÂíåÂä†ÈÄüÂ∫¶‰º†ÊÑüÂô®Êï∞ÊçÆÊ≥¢Âä®ÂºÇÂ∏∏ÔºåÂèØËÉΩÈúÄË¶ÅÊ£ÄÊü•ÂêäÁ¥¢Âº†Âäõ';
                            break;
                        default:
                            eventReasoning = 'ÊâÄÊúâ‰º†ÊÑüÂô®Êï∞ÊçÆÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÊó†ÂºÇÂ∏∏Ê®°Âºè';
                    }
                    
                    break;
                }
            }
            
            // Êõ¥Êñ∞‰∫ã‰ª∂È¢ÑÊµã
            if (currentEvent && currentEvent.type !== 'Ê≠£Â∏∏ËøêÁª¥‰∏≠') {
                // Ê∏ÖÈô§ÊóßÈ¢ÑÊµã
                eventPredictions.length = 0;
                
                // Ê∑ªÂä†Êñ∞È¢ÑÊµã
                eventPredictions.push({
                    id: Date.now(),
                    eventType: currentEvent.type,
                    probability: 0.5 + Math.random() * 0.4, // 50%-90%Ê¶ÇÁéá
                    reasoning: eventReasoning,
                    timestamp: timeStr,
                    severity: eventSeverity,
                    relatedSensors: generateAffectedSensorList(affectedSensorTypes, affectedSections)
                });
                
                // ÊòæÁ§∫‰∫ã‰ª∂È¢ÑÊµã
                displayEventPredictions();
            } else if (Math.random() > 0.9) { // 10%ÁöÑÊ¶ÇÁéáÊõ¥Êñ∞Ê≠£Â∏∏ËøêË°åÁä∂ÊÄÅ
                eventPredictions.length = 0;
                eventPredictions.push({
                    id: Date.now(),
                    eventType: 'Ê≠£Â∏∏ËøêÁª¥‰∏≠',
                    probability: 0.9 + Math.random() * 0.09, // 90%-99%Ê¶ÇÁéá
                    reasoning: 'ÊâÄÊúâ‰º†ÊÑüÂô®Êï∞ÊçÆÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÊó†ÂºÇÂ∏∏Ê®°Âºè',
                    timestamp: timeStr,
                    severity: 'low',
                    relatedSensors: ['Á≥ªÁªüÁä∂ÊÄÅ', 'ÊâÄÊúâ‰º†ÊÑüÂô®']
                });
                displayEventPredictions();
            }
            
            // ‰∏∫ÊØè‰∏™‰º†ÊÑüÂô®ÂàõÂª∫Êñ∞ÁöÑÊï∞ÊçÆÁÇπ
            uniqueSensors.forEach(sensorId => {
                // Ëé∑ÂèñËØ•‰º†ÊÑüÂô®ÁöÑÂéÜÂè≤Êï∞ÊçÆ
                const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                if (sensorPoints.length === 0) return;
                
                const currentSensor = sensorPoints[sensorPoints.length - 1];
                const currentValue = currentSensor.value;
                
                // Ê†πÊçÆ‰º†ÊÑüÂô®IDÂàÜÊûê‰º†ÊÑüÂô®Á±ªÂûãÂíåÂå∫ÊÆµ
                let sensorType = currentSensor.sensorType || 'ÂÖ∂‰ªñ';
                let sensorLocation = currentSensor.location || '‰∏≠ÊÆµ';
                
                // Á°ÆÂÆöÊòØÂê¶ÂèóÂΩìÂâç‰∫ã‰ª∂ÂΩ±Âìç
                const isAffectedType = affectedSensorTypes.includes(sensorType);
                const isAffectedSection = affectedSections.includes(sensorLocation);
                const isAffected = isAffectedType && isAffectedSection;
                
                // Ê†πÊçÆ‰º†ÊÑüÂô®Á±ªÂûãËé∑ÂèñÊï∞ÊçÆËåÉÂõ¥
                let baseValue, minValue, maxValue, warningThreshold, alarmThreshold;
                
                switch(sensorType) {
                    case 'Ê∏©Â∫¶':
                        baseValue = 25;
                        minValue = 5;
                        maxValue = 55;
                        warningThreshold = 40;
                        alarmThreshold = 45;
                        break;
                    case 'Â∫îÂèò':
                        baseValue = 200;
                        minValue = 50;
                        maxValue = 400;
                        warningThreshold = 300;
                        alarmThreshold = 350;
                        break;
                    case 'ÊåØÂä®':
                        baseValue = 0.5;
                        minValue = 0.05;
                        maxValue = 3.0;
                        warningThreshold = 1.5;
                        alarmThreshold = 2.0;
                        break;
                    case 'ÂÄæËßí':
                        baseValue = 0.5;
                        minValue = 0;
                        maxValue = 3.0;
                        warningThreshold = 1.5;
                        alarmThreshold = 2.0;
                        break;
                    case '‰ΩçÁßª':
                        baseValue = 5;
                        minValue = 0;
                        maxValue = 30;
                        warningThreshold = 15;
                        alarmThreshold = 20;
                        break;
                    case 'Âä†ÈÄüÂ∫¶':
                        baseValue = 0.2;
                        minValue = 0;
                        maxValue = 1.5;
                        warningThreshold = 0.8;
                        alarmThreshold = 1.0;
                        break;
                    case 'ËΩΩÈáç':
                        baseValue = 1000;
                        minValue = 0;
                        maxValue = 3000;
                        warningThreshold = 2000;
                        alarmThreshold = 2500;
                        break;
                    default:
                        baseValue = 50;
                        minValue = 0;
                        maxValue = 100;
                        warningThreshold = 80;
                        alarmThreshold = 90;
                }
                
                // ËÆ°ÁÆóÂü∫Á°ÄÂèòÂåñÈáè
                const randomFactor = (Math.random() * 2 - 1) * 0.01 * currentValue; // Âü∫Á°ÄÈöèÊú∫Ê≥¢Âä® (Â∞èÂπÖ)
                
                // ÁéØÂ¢ÉÂõ†Á¥†ÂΩ±Âìç
                let environmentalImpact = 0;
                if (sensorType === 'Ê∏©Â∫¶') {
                    environmentalImpact = environmentalFactor * 1.2 + (temperature - 20) * 0.1;
                } else if (sensorType === 'Â∫îÂèò') {
                    environmentalImpact = bridgeLoadFactor * 1.5 + timeOfDayFactor * 0.5;
                } else if (sensorType === 'ÊåØÂä®') {
                    environmentalImpact = bridgeLoadFactor * 1.2 + environmentalFactor * 0.8;
                } else if (sensorType === 'ÂÄæËßí') {
                    environmentalImpact = bridgeLoadFactor * 0.9 + environmentalFactor * 1.1;
                } else if (sensorType === '‰ΩçÁßª') {
                    environmentalImpact = bridgeLoadFactor * 1.3 + environmentalFactor * 0.7;
                } else if (sensorType === 'Âä†ÈÄüÂ∫¶') {
                    environmentalImpact = bridgeLoadFactor * 1.4 + environmentalFactor * 1.2;
                } else if (sensorType === 'ËΩΩÈáç') {
                    environmentalImpact = bridgeLoadFactor * 2.0 + timeOfDayFactor * 1.5;
                } else {
                    environmentalImpact = environmentalFactor * 0.8 + timeOfDayFactor * 0.7;
                }
                
                // ‰∫ã‰ª∂ÂΩ±Âìç
                let eventEffect = 0;
                if (isAffected) {
                    // ‰∫ã‰ª∂ÂΩ±ÂìçÊ†πÊçÆ‰º†ÊÑüÂô®Á±ªÂûã‰∏çÂêåËÄå‰∏çÂêå
                    let typeMultiplier = 1.0;
                    if (currentEvent) {
                        switch(currentEvent.type) {
                            case '‰∫§ÈÄöË¥üËΩΩËøáÈ´ò':
                                if (sensorType === 'ËΩΩÈáç') typeMultiplier = 2.0;
                                else if (sensorType === 'ÊåØÂä®') typeMultiplier = 1.5;
                                else if (sensorType === 'Â∫îÂèò') typeMultiplier = 1.3;
                                break;
                            case 'ÁªìÊûÑÂ∫îÂèòÂºÇÂ∏∏':
                                if (sensorType === 'Â∫îÂèò') typeMultiplier = 2.0;
                                else if (sensorType === '‰ΩçÁßª') typeMultiplier = 1.8;
                                else if (sensorType === 'ÂÄæËßí') typeMultiplier = 1.5;
                                break;
                            case 'Ê∏©Â∫¶ÂºÇÂ∏∏Ê≥¢Âä®':
                                if (sensorType === 'Ê∏©Â∫¶') typeMultiplier = 1.8;
                                else if (sensorType === 'Â∫îÂèò') typeMultiplier = 1.2;
                                break;
                            case 'Â§ñÈÉ®ÈúáÂä®Âπ≤Êâ∞':
                                if (sensorType === 'ÊåØÂä®') typeMultiplier = 2.0;
                                else if (sensorType === 'Âä†ÈÄüÂ∫¶') typeMultiplier = 1.8;
                                break;
                            case 'È£éÂäõÂΩ±ÂìçÊòéÊòæ':
                                if (sensorType === 'ÊåØÂä®') typeMultiplier = 1.5;
                                else if (sensorType === 'ÂÄæËßí') typeMultiplier = 1.3;
                                break;
                            case 'ÊîØÂ∫ß‰ΩçÁßªÂºÇÂ∏∏':
                                if (sensorType === '‰ΩçÁßª') typeMultiplier = 2.2;
                                else if (sensorType === 'Â∫îÂèò') typeMultiplier = 1.5;
                                else if (sensorType === 'ÂÄæËßí') typeMultiplier = 1.7;
                                break;
                            case 'ÂêäÁ¥¢Âº†ÂäõÂèòÂåñ':
                                if (sensorType === 'Â∫îÂèò') typeMultiplier = 1.8;
                                else if (sensorType === 'Âä†ÈÄüÂ∫¶') typeMultiplier = 1.6;
                                break;
                        }
                    }
                    
                    // ËÆ°ÁÆó‰∫ã‰ª∂ÂΩ±Âìç
                    const directionFactor = eventImpact * typeMultiplier;
                    const randomDirection = Math.random() > 0.3; // 70%Ê¶ÇÁéá‰∏∫Ê≠£ÂêëÂèòÂåñ
                    eventEffect = (randomDirection ? 1 : -1) * directionFactor * baseValue * 0.2;
                }
                
                // ÂºÇÂ∏∏Ê¶ÇÁéá(ÈöèÊú∫ÂºÇÂ∏∏„ÄÅ‰∏çÂèó‰∫ã‰ª∂ÂΩ±Âìç)
                let anomalyEffect = 0;
                if (!isAffected && Math.random() < 0.05) { // 5%Ê¶ÇÁéá‰∫ßÁîüÈöèÊú∫ÂºÇÂ∏∏
                    anomalyEffect = (Math.random() < 0.5 ? 1 : -1) * Math.random() * 0.3 * baseValue;
                }
                
                // Âü∫Á°ÄÁéØÂ¢ÉÂΩ±Âìç
                let baseChange = (environmentalImpact * currentValue * 0.05) + randomFactor;
                
                // ËÆ°ÁÆóÊÄªÂèòÂåñÈáè
                let totalChange = baseChange + eventEffect + anomalyEffect;
                
                // ËÆ°ÁÆóÊñ∞ÂÄº
                let newValue = currentValue + totalChange;
                
                // Á°Æ‰øùÊñ∞ÂÄºÂú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ
                newValue = Math.max(minValue, Math.min(maxValue, newValue));
                
                // Á°Æ‰øùÊï∞ÊçÆÁöÑËøûÁª≠ÊÄß
                const maxChange = currentValue * 0.25; // ÊúÄÂ§ßÂÖÅËÆ∏25%ÁöÑÂèòÂåñ
                if (Math.abs(newValue - currentValue) > maxChange) {
                    newValue = currentValue + (Math.sign(newValue - currentValue) * maxChange * Math.random());
                }
                
                // Á°ÆÂÆö‰º†ÊÑüÂô®Áä∂ÊÄÅ
                let status = 'normal';
                if (newValue > warningThreshold && newValue < alarmThreshold) {
                    status = 'warning';
                }
                if (newValue > alarmThreshold || newValue < minValue) {
                    status = 'danger';
                }
                
                // ÂàõÂª∫Êñ∞ÁöÑÊï∞ÊçÆÁÇπ
                const newDataPoint = {
                    timestamp: timeStr,
                    sensorId: sensorId,
                    value: newValue,
                    status: status,
                    sensorType: sensorType,
                    location: sensorLocation
                };
                
                // Ê∑ªÂä†Âà∞Êï∞ÊçÆÈõÜ
                sensorData.push(newDataPoint);
                
                // Êõ¥Êñ∞UI
                addDataToTable(newDataPoint);
                
                // Êõ¥Êñ∞ÂõæË°®
                updateCharts();
                
                // Êõ¥Êñ∞Áõ∏ÂÖ≥ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ
                updateCameraStatus(sensorId, status);
            });
            
            // ÈôêÂà∂Êï∞ÊçÆÁÇπÊï∞ÈáèÔºå‰øùÁïôÊúÄËøëÁöÑ2000‰∏™Êï∞ÊçÆÁÇπ
            if (sensorData.length > 2000) {
                sensorData = sensorData.slice(sensorData.length - 2000);
                refreshTable();
            }
        }

        // ËæÖÂä©ÂáΩÊï∞ÔºöÊ†πÊçÆ‰º†ÊÑüÂô®Á±ªÂûãÂíåÂå∫ÊÆµÁîüÊàêÂèóÂΩ±ÂìçÁöÑ‰º†ÊÑüÂô®ÂàóË°®
        function generateAffectedSensorList(types, sections) {
            if (types.length === 0 || sections.length === 0) {
                return ['Á≥ªÁªüÁä∂ÊÄÅ'];
            }
            
            // ‰ªéÁé∞Êúâ‰º†ÊÑüÂô®‰∏≠ÊâæÂá∫ÂèóÂΩ±ÂìçÁöÑ‰º†ÊÑüÂô®ID
            const affectedSensors = [];
            const sensorsByType = {};
            
            // ÊåâÁ±ªÂûãÂàÜÁªÑ‰º†ÊÑüÂô®
            sensorData.forEach(item => {
                if (!sensorsByType[item.sensorType]) {
                    sensorsByType[item.sensorType] = new Set();
                }
                sensorsByType[item.sensorType].add(item.sensorId);
            });
            
            // ‰∏∫ÊØèÁßçÁ±ªÂûãÊâæÂá∫ÊúÄÂ§ö3‰∏™‰º†ÊÑüÂô®
            types.forEach(type => {
                if (sensorsByType[type]) {
                    // ËΩ¨‰∏∫Êï∞ÁªÑÂπ∂Á≠õÈÄâÁ¨¶ÂêàÂå∫ÊÆµÁöÑ‰º†ÊÑüÂô®
                    const sensors = Array.from(sensorsByType[type]).filter(id => {
                        const sensorPoint = sensorData.find(s => s.sensorId === id);
                        return sensorPoint && sections.includes(sensorPoint.location);
                    });
                    
                    // ÈöèÊú∫ÈÄâÊã©ÊúÄÂ§ö3‰∏™‰º†ÊÑüÂô®
                    const selectedCount = Math.min(3, sensors.length);
                    for (let i = 0; i < selectedCount; i++) {
                        const randomIndex = Math.floor(Math.random() * sensors.length);
                        if (sensors[randomIndex] && !affectedSensors.includes(sensors[randomIndex])) {
                            affectedSensors.push(sensors[randomIndex]);
                            sensors.splice(randomIndex, 1);
                        }
                    }
                }
            });
            
            return affectedSensors.length > 0 ? affectedSensors : ['Á≥ªÁªüÁä∂ÊÄÅ'];
        }

        // ÊëÑÂÉèÂ§¥Êï∞ÊçÆÁîüÊàê
        function generateCameras() {
            allCameras = [];
            const sections = ['ÂåóÊÆµ', '‰∏≠ÊÆµ', 'ÂçóÊÆµ', '‰∏úÊÆµ', 'Ë•øÊÆµ', 'ÊîØÊíëÁªìÊûÑ', 'ËøûÊé•ÈÉ®‰Ωç'];
            const positions = ['Ê°•Èù¢', 'Ê°•Â¢©', 'Ê°•Â°î', 'ÂêäÁ¥¢', 'ÊîØÂ∫ß', '‰º∏Áº©Áºù', '‰∫§ÈÄöÁõëÊéß'];
            
            // Êî∂ÈõÜÁé∞Êúâ‰º†ÊÑüÂô®ID
            const existingSensorIds = new Set(sensorData.map(item => item.sensorId));
            
            // ‰∏∫ÊØè‰∏™‰º†ÊÑüÂô®ÂàõÂª∫ÂÖ≥ËÅîÊëÑÂÉèÂ§¥
            let cameraCount = 0;
            existingSensorIds.forEach(sensorId => {
                // Âà§Êñ≠‰º†ÊÑüÂô®‰ΩçÁΩÆ
                let section = '‰∏≠ÊÆµ';
                let position = 'Ê°•Èù¢';
                
                for (const s of sections) {
                    if (sensorId.includes(s)) {
                        section = s;
                        break;
                    }
                }
                
                for (const p of positions) {
                    if (sensorId.includes(p)) {
                        position = p;
                        break;
                    }
                }
                
                // ÂàõÂª∫ÊëÑÂÉèÂ§¥
                const statusChance = Math.random();
                let status;
                
                if (statusChance > 0.9) {
                    status = 'offline';
                } else if (statusChance > 0.8) {
                    status = 'warning';
                } else {
                    status = 'online';
                }
                
                cameraCount++;
                allCameras.push({
                    id: `CAM-${cameraCount.toString().padStart(3, '0')}`,
                    name: `${section}${position}ÊëÑÂÉèÂ§¥-${cameraCount}`,
                    status: status,
                    sensorId: sensorId,
                    section: section,
                    position: position,
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 3600000)).toLocaleString('zh-CN')
                });
            });
            
            // Â¶ÇÊûúÊëÑÂÉèÂ§¥Êï∞Èáè‰∏çË∂≥50‰∏™ÔºåÊ∑ªÂä†È¢ùÂ§ñÁöÑÊëÑÂÉèÂ§¥
            while (allCameras.length < 50) {
                cameraCount++;
                const section = sections[Math.floor(Math.random() * sections.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                const statusChance = Math.random();
                let status;
                
                if (statusChance > 0.9) {
                    status = 'offline';
                } else if (statusChance > 0.8) {
                    status = 'warning';
                } else {
                    status = 'online';
                }
                
                allCameras.push({
                    id: `CAM-${cameraCount.toString().padStart(3, '0')}`,
                    name: `${section}${position}ÊëÑÂÉèÂ§¥-${cameraCount}`,
                    status: status,
                    sensorId: `‰º†ÊÑüÂô®-${section}-${position}-${cameraCount.toString().padStart(2, '0')}`,
                    section: section,
                    position: position,
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 3600000)).toLocaleString('zh-CN')
                });
            }
            
            return allCameras;
        }

        // Ê∑ªÂä†Á§∫‰æãÊï∞ÊçÆÊåâÈíÆÂíå‰∏ãËΩΩÁ§∫‰æãÊñá‰ª∂ÂäüËÉΩ
        document.getElementById('sampleButton').addEventListener('click', function() {
            // ÁîüÊàêÁ§∫‰æãÊï∞ÊçÆ
            createSampleData();
            
            // Á°Æ‰øùÊ£ÄÊµãÊåâÈíÆÂêØÁî®
            document.getElementById('detectButton').disabled = false;
        });
        downloadExample.addEventListener('click', generateExampleFile);
        
        // ÈöèÊú∫Âà∑Êñ∞ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        refreshButton.addEventListener('click', function() {
            if (dataUpdateInterval) {
                stopDataUpdates();
            } else {
                startRandomDataUpdates();
            }
        });
        
        // ÂàùÂßãÂåñ
        resetAll();
        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
        checkLoginStatus();
        // ÂàùÂßãÂåñ‰∫ã‰ª∂ÊéßÂà∂Èù¢Êùø
        initEventControls();

        // Á°ÆÂÆöÂºÇÂ∏∏Á±ªÂûã
        function determineAnomalyType(index, values, zScore) {
            try {
                // Ê£ÄÊü•ÂâçÂêéÊòØÂê¶‰πüÊòØÂºÇÂ∏∏ÔºåÂà§Êñ≠ËøûÁª≠ÊÄßÂºÇÂ∏∏
                let isContinuous = false;
                
                if (index > 1) {  // Á°Æ‰øùÊúâÂâç‰∏§‰∏™ÁÇπ
                    try {
                        isContinuous = Math.abs((values[index-1] - values[index-2]) / Math.max(0.01, Math.abs(values[index-2]))) > 0.1;
                    } catch (e) {
                        console.warn("ËÆ°ÁÆóÂâçÂØºÁÇπËøûÁª≠ÊÄßÂºÇÂ∏∏Êó∂Âá∫Èîô:", e.message);
                    }
                }
                
                if (!isContinuous && index < values.length - 1) {  // Ê£ÄÊü•Âêé‰∏Ä‰∏™ÁÇπ
                    try {
                        isContinuous = Math.abs((values[index+1] - values[index]) / Math.max(0.01, Math.abs(values[index]))) > 0.1;
                    } catch (e) {
                        console.warn("ËÆ°ÁÆóÂêéÁªßÁÇπËøûÁª≠ÊÄßÂºÇÂ∏∏Êó∂Âá∫Èîô:", e.message);
                    }
                }
                
                // Ê£ÄÊü•Âë®Âõ¥ÁÇπÊòØÂê¶ÂΩ¢ÊàêÁæ§‰Ωì
                const startIdx = Math.max(0, index - 3);
                const endIdx = Math.min(values.length, index + 4);
                const nearbyPoints = values.slice(startIdx, endIdx);
                
                const nearbyMean = nearbyPoints.reduce((acc, val) => acc + val, 0) / nearbyPoints.length;
                const globalMean = values.reduce((acc, val) => acc + val, 0) / values.length;
                
                // ÈÅøÂÖçÈô§‰ª•Èõ∂ÔºåÂä†ÂÖ•ÂÆâÂÖ®Ê£ÄÊü•
                const denominator = Math.max(0.01, Math.abs(globalMean));
                const isCluster = Math.abs((nearbyMean - globalMean) / denominator) > 0.1 && nearbyPoints.length >= 3;
                
                if (isCluster) {
                    return 'Áæ§‰ΩìÂºÇÂ∏∏';
                } else if (isContinuous) {
                    return 'ËøûÁª≠ÊÄßÂºÇÂ∏∏';
                } else {
                    return 'ÂçïÁÇπÂºÇÂ∏∏';
                }
            } catch (error) {
                console.error("Á°ÆÂÆöÂºÇÂ∏∏Á±ªÂûãÊó∂Âá∫Èîô:", error);
                return 'Êú™ÂàÜÁ±ªÂºÇÂ∏∏';  // ËøîÂõû‰∏Ä‰∏™ÈªòËÆ§ÂÄº
            }
        }

        // ÂàùÂßãÂåñ‰∫ã‰ª∂ÊéßÂà∂Èù¢Êùø
        function initEventControls() {
            console.log("ÂàùÂßãÂåñ‰∫ã‰ª∂ÊéßÂà∂Èù¢Êùø");
            
            // Ëé∑Âèñ‰∫ã‰ª∂Áõ∏ÂÖ≥ÁöÑDOMÂÖÉÁ¥†
            eventNameElement = document.getElementById('currentEventName');
            eventDescElement = document.getElementById('currentEventDescription');
            eventProgressContainer = document.getElementById('eventProgressContainer');
            eventProgressBar = document.getElementById('eventProgressBar');
            eventProgressText = document.getElementById('eventProgressText');
            eventDetails = document.getElementById('eventDetails');
            
            // ‰∫ã‰ª∂ÊåâÈíÆÁÇπÂáªÂ§ÑÁêÜ
            const eventButtons = document.querySelectorAll('#eventButtons button');
            eventButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const eventType = this.getAttribute('data-event');
                    
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂΩìÂâçÊ¥ªÂä®‰∫ã‰ª∂ÔºåÂàôÂøΩÁï•
                    if (currentEventSimulation === eventType) return;
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    eventButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ÂºÄÂßãÊ®°ÊãüÊñ∞‰∫ã‰ª∂
                    startEventSimulation(eventType);
                });
            });
            
            // ÂàùÂßãÂåñÊ∏ÖÁ©∫ÂéÜÂè≤ÊåâÈíÆ
            document.getElementById('clearHistoryBtn').addEventListener('click', function() {
                clearDetectionHistory();
            });
            
            // ÈªòËÆ§ËÆæÁΩÆ‰∏∫Ê≠£Â∏∏ËøêË°åÁä∂ÊÄÅ
            startEventSimulation(bridgeEvents.NORMAL);
        }

        // ÂºÄÂßã‰∫ã‰ª∂Ê®°Êãü
        function startEventSimulation(eventType) {
            // Ê£ÄÊü•‰∫ã‰ª∂Á±ªÂûã
            if (!eventType) {
                console.warn("Êú™ÊåáÂÆö‰∫ã‰ª∂Á±ªÂûãÔºå‰ΩøÁî®ÈªòËÆ§ÂÄº");
                eventType = "NORMAL"; // ‰ΩøÁî®ÈªòËÆ§ÂÄº
            }
            
            // Ê£ÄÊü•‰∫ã‰ª∂ËÆæÁΩÆÊòØÂê¶Â≠òÂú®
            if (typeof eventSettings === 'undefined' || !eventSettings || !eventSettings[eventType]) {
                console.error(`‰∫ã‰ª∂ËÆæÁΩÆÊú™ÂÆö‰πâÊàñ‰∫ã‰ª∂Á±ªÂûã ${eventType} ‰∏çÂ≠òÂú®`);
                return;
            }
            
            // ÂÅúÊ≠¢ÂΩìÂâç‰∫ã‰ª∂Ê®°Êãü
            if (currentEventSimulation !== null) {
                console.log(`ÂÅúÊ≠¢ÂΩìÂâç‰∫ã‰ª∂Ê®°Êãü: ${currentEventSimulation}`);
            }
            
            // ËÆæÁΩÆÊñ∞ÁöÑ‰∫ã‰ª∂Ê®°Êãü
            currentEventSimulation = eventType;
            const eventConfig = eventSettings[eventType];
            
            console.log(`ÂºÄÂßãÊ®°Êãü‰∫ã‰ª∂: ${eventType}, ÂêçÁß∞: ${eventConfig.name}`);
            
            // Êõ¥Êñ∞UI - Ê∑ªÂä†È™åËØÅ‰ª•Èò≤Ê≠¢ÂØπnullÁöÑÂºïÁî®
            if (eventNameElement) eventNameElement.textContent = eventConfig.name;
            if (eventDescElement) eventDescElement.textContent = eventConfig.description;
            
            // Ê∏ÖÈô§‰∏ä‰∏Ä‰∏™‰∫ã‰ª∂ÁöÑÁ±ª
            if (eventDetails) {
                eventDetails.className = 'event-details';
                
                // Ê∑ªÂä†ÂΩìÂâç‰∫ã‰ª∂ÁöÑÁ±ª
                if (eventConfig.severity === 'warning') {
                    eventDetails.classList.add('event-warning');
                } else if (eventConfig.severity === 'alert') {
                    eventDetails.classList.add('event-alert');
                }
            }
            
            // ËÆæÁΩÆ‰∫ã‰ª∂ËøõÂ∫¶
            if (eventType === bridgeEvents.NORMAL) {
                // Ê≠£Â∏∏Áä∂ÊÄÅÊ≤°ÊúâËøõÂ∫¶Êù°
                eventProgressContainer.style.display = 'none';
                eventProgress = 0;
                eventDuration = 0;
            } else {
                // ËÆæÁΩÆ‰∫ã‰ª∂ÊåÅÁª≠Êó∂Èó¥ÔºàÈöèÊú∫Âú®ÈÖçÁΩÆÁöÑËåÉÂõ¥ÂÜÖÔºâ
                eventDuration = Math.floor(Math.random() * 
                    (eventConfig.duration[1] - eventConfig.duration[0] + 1)) + 
                    eventConfig.duration[0];
                
                eventProgress = 0;
                updateEventProgress();
                
                // ÊòæÁ§∫ËøõÂ∫¶Êù°
                eventProgressContainer.style.display = 'block';
            }
        }

        // Êõ¥Êñ∞‰∫ã‰ª∂ËøõÂ∫¶
        function updateEventProgress() {
            if (!currentEventSimulation || currentEventSimulation === bridgeEvents.NORMAL) return;
            
            // Â¢ûÂä†ËøõÂ∫¶
            eventProgress += (100 / eventDuration);
            
            // Á°Æ‰øù‰∏çË∂ÖËøá100%
            if (eventProgress > 100) {
                eventProgress = 100;
                
                // ‰∫ã‰ª∂ÁªìÊùüÔºåÊÅ¢Â§çÊ≠£Â∏∏Áä∂ÊÄÅ
                setTimeout(() => {
                    document.querySelector('#eventButtons button[data-event="normal"]').click();
                }, 1000);
            }
            
            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            eventProgressBar.style.width = `${eventProgress}%`;
            eventProgressText.textContent = `${Math.round(eventProgress)}%`;
        }

        // Â∞ÜÂºÇÂ∏∏Ê£ÄÊµãÁªìÊûúÊ∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
        function addToDetectionHistory(result) {
            const historyList = document.getElementById('detectionHistory');
            const noHistoryMsg = historyList.querySelector('.no-history-message');
            
            if (noHistoryMsg) {
                noHistoryMsg.remove();
            }
            
            // ÂàõÂª∫ÂéÜÂè≤ËÆ∞ÂΩïÈ°π
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.dataset.timestamp = new Date().toISOString();
            
            // Ëé∑ÂèñÂΩìÂâç‰∫ã‰ª∂ÂêçÁß∞
            const eventName = currentEventSimulation ? 
                eventSettings[currentEventSimulation].name : 'Ê≠£Â∏∏ËøêË°å';
                
            // ÂàõÂª∫ÂéÜÂè≤ËÆ∞ÂΩïÂÜÖÂÆπ
            historyItem.innerHTML = `
                <div class="history-item-header">
                    <div class="history-item-title">Ê£ÄÊµãÁªìÊûú #${document.querySelectorAll('.history-item').length + 1}</div>
                    <div class="history-item-time">${new Date().toLocaleString('zh-CN')}</div>
                </div>
                <div class="history-item-stats">
                    <div>‰∫ã‰ª∂Áä∂ÊÄÅ: ${eventName}</div>
                    <div>Êï∞ÊçÆÁÇπ: ${result.totalPoints}, ÂºÇÂ∏∏: ${result.anomalyCount}</div>
                    <div>ÂçïÁÇπÂºÇÂ∏∏: ${result.singlePointCount}, ËøûÁª≠ÊÄßÂºÇÂ∏∏: ${result.continuousCount}, Áæ§‰ΩìÂºÇÂ∏∏: ${result.clusterCount}</div>
                </div>
            `;
            
            // ÁÇπÂáªÂéÜÂè≤ËÆ∞ÂΩïÈ°πÊÅ¢Â§çËØ•Ê£ÄÊµãÁªìÊûú
            historyItem.addEventListener('click', function() {
                restoreDetectionResult(this.dataset.timestamp);
            });
            
            // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // Â≠òÂÇ®ÂΩìÂâçÊ£ÄÊµãÁªìÊûú
            saveDetectionResult(historyItem.dataset.timestamp, result);
        }

        // ‰øùÂ≠òÊ£ÄÊµãÁªìÊûú
        function saveDetectionResult(timestamp, result) {
            // Ëé∑ÂèñÂ∑≤ÊúâÁöÑÂéÜÂè≤ËÆ∞ÂΩï
            let history = JSON.parse(localStorage.getItem('detectionHistory') || '[]');
            
            // Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï
            history.push({
                timestamp: timestamp,
                result: result,
                anomalyChartData: dataChart ? dataChart.data : null,
                event: currentEventSimulation,
                eventName: eventSettings[currentEventSimulation || bridgeEvents.NORMAL].name
            });
            
            // ÈôêÂà∂ÊúÄÂ§ßÂéÜÂè≤ËÆ∞ÂΩïÊï∞
            if (history.length > 10) {
                history = history.slice(history.length - 10);
            }
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('detectionHistory', JSON.stringify(history));
        }

        // ÊÅ¢Â§çÊ£ÄÊµãÁªìÊûú
        function restoreDetectionResult(timestamp) {
            // Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩï
            const history = JSON.parse(localStorage.getItem('detectionHistory') || '[]');
            
            // Êü•ÊâæÂØπÂ∫îÁöÑËÆ∞ÂΩï
            const record = history.find(item => item.timestamp === timestamp);
            if (!record) return;
            
            // ÊÅ¢Â§çÊ£ÄÊµãÁªìÊûúÊòæÁ§∫
            const result = record.result;
            
            // Êõ¥Êñ∞ÁªüËÆ°Êï∞Â≠ó
            document.getElementById('totalPoints').textContent = result.totalPoints;
            document.getElementById('anomalyCount').textContent = result.anomalyCount;
            document.getElementById('singlePointCount').textContent = result.singlePointCount;
            document.getElementById('continuousCount').textContent = result.continuousCount;
            document.getElementById('clusterCount').textContent = result.clusterCount;
            
            // ÊÅ¢Â§çÂºÇÂ∏∏ÂàóË°®
            document.getElementById('anomalyList').innerHTML = '';
            
            // ÊòæÁ§∫ÂàÜÊûêÁªìÊûú
            analysisSummary.style.display = 'block';
            analysisLoader.style.display = 'none';
            noAnalysisMessage.style.display = 'none';
            
            // Â¶ÇÊûúÊúâÂõæË°®Êï∞ÊçÆÔºåÊÅ¢Â§çÂõæË°®
            if (record.anomalyChartData) {
                restoreAnomalyChart(record.anomalyChartData);
            }
            
            // ÊòæÁ§∫ÊÅ¢Â§çÊèêÁ§∫
            alert(`Â∑≤ÊÅ¢Â§ç ${new Date(timestamp).toLocaleString('zh-CN')} ÁöÑÊ£ÄÊµãÁªìÊûúÔºåÂú®"${record.eventName}"Áä∂ÊÄÅ‰∏ãËøõË°åÁöÑÊ£ÄÊµã`);
        }

        // ÊÅ¢Â§çÂºÇÂ∏∏Ê£ÄÊµãÂõæË°®
        function restoreAnomalyChart(chartData) {
            if (!chartData) return;
            
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            
            // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
            if (anomalyChart) {
                anomalyChart.destroy();
            }
            
            // ÂàõÂª∫Êñ∞ÂõæË°®
            anomalyChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true
                            }
                        },
                        annotation: {
                            annotations: {
                                anomalyThreshold: {
                                    type: 'line',
                                    yMin: 2,
                                    yMax: 2,
                                    borderColor: 'rgba(255, 0, 0, 0.5)',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        display: true,
                                        content: 'ÂºÇÂ∏∏ÈòàÂÄº (Z-score = 2)',
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Êï∞ÊçÆÁÇπ'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Z-Score'
                            }
                        }
                    }
                }
            });
        }

        // Ê∏ÖÁ©∫Ê£ÄÊµãÂéÜÂè≤
        function clearDetectionHistory() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                // Ê∏ÖÁ©∫localStorage
                localStorage.removeItem('detectionHistory');
                
                // Ê∏ÖÁ©∫ÂéÜÂè≤ÂàóË°®
                const historyList = document.getElementById('detectionHistory');
                historyList.innerHTML = '<div class="no-history-message">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>';
            }
        }

        // Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï
        function loadDetectionHistory() {
            const history = JSON.parse(localStorage.getItem('detectionHistory') || '[]');
            const historyList = document.getElementById('detectionHistory');
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="no-history-message">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>';
                return;
            }
            
            // Ê∏ÖÁ©∫Áé∞ÊúâÂàóË°®
            historyList.innerHTML = '';
            
            // Ê∑ªÂä†ÂéÜÂè≤ËÆ∞ÂΩï
            history.forEach((record, index) => {
                const result = record.result;
                
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.timestamp = record.timestamp;
                
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-title">Ê£ÄÊµãÁªìÊûú #${history.length - index}</div>
                        <div class="history-item-time">${new Date(record.timestamp).toLocaleString('zh-CN')}</div>
                    </div>
                    <div class="history-item-stats">
                        <div>‰∫ã‰ª∂Áä∂ÊÄÅ: ${record.eventName || 'Ê≠£Â∏∏ËøêË°å'}</div>
                        <div>Êï∞ÊçÆÁÇπ: ${result.totalPoints}, ÂºÇÂ∏∏: ${result.anomalyCount}</div>
                        <div>ÂçïÁÇπÂºÇÂ∏∏: ${result.singlePointCount}, ËøûÁª≠ÊÄßÂºÇÂ∏∏: ${result.continuousCount}, Áæ§‰ΩìÂºÇÂ∏∏: ${result.clusterCount}</div>
                    </div>
                `;
                
                // ÁÇπÂáªÂéÜÂè≤ËÆ∞ÂΩïÈ°πÊÅ¢Â§çËØ•Ê£ÄÊµãÁªìÊûú
                historyItem.addEventListener('click', function() {
                    restoreDetectionResult(this.dataset.timestamp);
                });
                
                historyList.appendChild(historyItem);
            });
        }

        // ‰∫ã‰ª∂È¢ÑÊµãÊï∞ÊçÆÁªìÊûÑ
        eventPredictions = [
            {
                id: 1,
                eventType: 'ÁªìÊûÑÂ∫îÂèòÂºÇÂ∏∏',
                probability: 0.85,
                reasoning: 'ÂåóÊÆµÂ∫îÂèò‰º†ÊÑüÂô®ËøûÁª≠3Â∞èÊó∂Êï∞ÊçÆÂÅèÈ´òÔºåË∂ÖËøáÊ≠£Â∏∏ËåÉÂõ¥20%',
                timestamp: '2023-11-18 08:45',
                severity: 'high',
                relatedSensors: ['Â∫îÂèò‰º†ÊÑüÂô®-‰∏ªÊ°•ÂåóÊÆµ', 'Â∫îÂèò‰º†ÊÑüÂô®-‰∏ªÊ°•‰∏≠ÊÆµ']
            },
            {
                id: 2,
                eventType: '‰∫§ÈÄöË¥üËΩΩËøáÈ´ò',
                probability: 0.68,
                reasoning: '‰∏≠ÊÆµÊåØÂä®‰º†ÊÑüÂô®Êï∞ÊçÆÊ≥¢Âä®È¢ëÁπÅÔºå‰∏éÂéÜÂè≤‰∫§ÈÄöÈ´òÂ≥∞ÊúüÊ®°ÂºèÂåπÈÖç',
                timestamp: '2023-11-18 17:30',
                severity: 'medium',
                relatedSensors: ['ÊåØÂä®‰º†ÊÑüÂô®-‰∏ªÊ°•‰∏≠ÊÆµ', 'ÊåØÂä®‰º†ÊÑüÂô®-‰∏ªÊ°•ÂçóÊÆµ']
            },
            {
                id: 3,
                eventType: 'Ê∏©Â∫¶ÂºÇÂ∏∏Ê≥¢Âä®',
                probability: 0.52,
                reasoning: 'ÂçóÊÆµÊ∏©Â∫¶‰º†ÊÑüÂô®ËøëÊúüÊï∞ÊçÆÊ≥¢Âä®Ë∂ÖÂá∫Â≠£ËäÇÊ≠£Â∏∏ËåÉÂõ¥',
                timestamp: '2023-11-18 14:15',
                severity: 'low',
                relatedSensors: ['Ê∏©Â∫¶‰º†ÊÑüÂô®-‰∏ªÊ°•ÂçóÊÆµ']
            }
        ];

        // ÊëÑÂÉèÂ§¥Êï∞ÊçÆ
        function generateCameras() {
            const cameras = [];
            const sections = ['ÂåóÊÆµ', '‰∏≠ÊÆµ', 'ÂçóÊÆµ', '‰∏úÊÆµ', 'Ë•øÊÆµ'];
            const positions = ['Ê°•Èù¢', 'Ê°•Â¢©', 'Ê°•Â°î', 'ÂêäÁ¥¢', 'ÊîØÂ∫ß'];
            
            // ÁîüÊàê50‰∏™ÊëÑÂÉèÂ§¥Êï∞ÊçÆ
            for (let i = 1; i <= 50; i++) {
                const section = sections[Math.floor(Math.random() * sections.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                const statusChance = Math.random();
                let status;
                
                if (statusChance > 0.85) {
                    status = 'offline';
                } else if (statusChance > 0.7) {
                    status = 'warning';
                } else {
                    status = 'online';
                }
                
                cameras.push({
                    id: `CAM-${i.toString().padStart(3, '0')}`,
                    name: `${section}${position}ÊëÑÂÉèÂ§¥-${i}`,
                    status: status,
                    sensorId: `‰º†ÊÑüÂô®-${section}-${position}-${i.toString().padStart(2, '0')}`,
                    section: section,
                    position: position,
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 3600000)).toLocaleString('zh-CN')
                });
            }
            
            return cameras;
        }

        // ÊòæÁ§∫‰∫ã‰ª∂È¢ÑÊµã
        function displayEventPredictions() {
            const container = document.getElementById('event-prediction-container');
            if (!container) return;
            
            // Ê∏ÖÁ©∫ÂÆπÂô®
            container.innerHTML = '';
            
            if (eventPredictions.length === 0) {
                container.innerHTML = '<div class="no-predictions">ÊöÇÊó†ÂºÇÂ∏∏‰∫ã‰ª∂È¢ÑÊµã</div>';
                return;
            }
            
            // ÊåâÊ¶ÇÁéáÈôçÂ∫èÊéíÂ∫è
            eventPredictions.sort((a, b) => b.probability - a.probability);
            
            // ‰∏∫ÊØè‰∏™‰∫ã‰ª∂ÂàõÂª∫‰∏Ä‰∏™È¢ÑÊµãÂç°Áâá
            eventPredictions.forEach(event => {
                let severityClass = '';
                switch (event.severity) {
                    case 'high':
                        severityClass = 'severity-high';
                        break;
                    case 'medium':
                        severityClass = 'severity-medium';
                        break;
                    default:
                        severityClass = 'severity-low';
                }
                
                const probability = (event.probability * 100).toFixed(1);
                
                // ÂàõÂª∫È¢ÑÊµãÂç°Áâá
                const card = document.createElement('div');
                card.className = `event-prediction-card ${severityClass}`;
                card.innerHTML = `
                    <div class="event-header">
                        <div class="event-type">${event.eventType}</div>
                        <div class="event-probability">${probability}%</div>
                    </div>
                    <div class="event-reasoning">${event.reasoning}</div>
                    <div class="event-details">
                        <span class="event-timestamp">Ê£ÄÊµãÊó∂Èó¥: ${event.timestamp}</span>
                        <span class="event-sensors">ÂÖ≥ËÅî‰º†ÊÑüÂô®: ${event.relatedSensors.join(', ')}</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // ÊòæÁ§∫ÊëÑÂÉèÂ§¥
        function displayCameras(cameras) {
            const cameraGrid = document.getElementById('cameraGrid');
            cameraGrid.innerHTML = '';
            
            if (!cameras || cameras.length === 0) {
                cameraGrid.innerHTML = '<div class="no-cameras-message">Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊëÑÂÉèÂ§¥</div>';
                return;
            }
            
            cameras.forEach(camera => {
                const cameraItem = document.createElement('div');
                cameraItem.className = 'camera-item';
                cameraItem.dataset.id = camera.id;
                cameraItem.dataset.section = camera.section;
                cameraItem.dataset.status = camera.status;
                
                let statusClass, statusText;
                switch (camera.status) {
                    case 'offline':
                        statusClass = 'camera-offline';
                        statusText = 'Á¶ªÁ∫ø';
                        break;
                    case 'warning':
                        statusClass = 'camera-warning';
                        statusText = 'Ë≠¶Âëä';
                        break;
                    default:
                        statusClass = 'camera-online';
                        statusText = 'Âú®Á∫ø';
                }
                
                // Â¢ûÂä†ÊëÑÂÉèÂ§¥ËßÜÂõæ - Á©∫ÁôΩÊ°Ü
                cameraItem.innerHTML = `
                    <div class="camera-header">
                        <div class="camera-name">${camera.name}</div>
                        <div class="camera-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="camera-view">
                        <!-- ÊëÑÂÉèÂ§¥ËßÜÂõæÂå∫Âüü -->
                        <div class="camera-placeholder">
                            <div class="camera-no-signal ${camera.status === 'offline' ? 'visible' : ''}">Êó†‰ø°Âè∑</div>
                        </div>
                    </div>
                    <div class="camera-footer">
                        <div class="camera-id">${camera.id}</div>
                        <div class="camera-update">Êõ¥Êñ∞: ${camera.lastUpdate}</div>
                    </div>
                `;
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÔºåÊòæÁ§∫ËØ¶ÊÉÖ
                cameraItem.addEventListener('click', function() {
                    showCameraDetails(camera);
                });
                
                cameraGrid.appendChild(cameraItem);
            });
        }

        // ÊòæÁ§∫ÊëÑÂÉèÂ§¥ËØ¶ÊÉÖ
        function showCameraDetails(camera) {
            const modal = document.getElementById('cameraDetailModal') || createCameraDetailModal();
            const modalTitle = modal.querySelector('.modal-title');
            const modalBody = modal.querySelector('.modal-body');
            
            modalTitle.textContent = `${camera.name} (${camera.id})`;
            
            let statusClass, statusText;
            switch (camera.status) {
                case 'offline':
                    statusClass = 'badge-danger';
                    statusText = 'Á¶ªÁ∫ø';
                    break;
                case 'warning':
                    statusClass = 'badge-warning';
                    statusText = 'Ë≠¶Âëä';
                    break;
                default:
                    statusClass = 'badge-success';
                    statusText = 'Âú®Á∫ø';
            }
            
            modalBody.innerHTML = `
                <div class="camera-detail-view">
                    <div class="camera-placeholder large">
                        <div class="camera-no-signal ${camera.status === 'offline' ? 'visible' : ''}">Êó†‰ø°Âè∑</div>
                    </div>
                </div>
                <div class="camera-detail-info">
                    <p><strong>ID:</strong> ${camera.id}</p>
                    <p><strong>‰ΩçÁΩÆ:</strong> ${camera.section} - ${camera.position}</p>
                    <p><strong>Áä∂ÊÄÅ:</strong> <span class="badge ${statusClass}">${statusText}</span></p>
                    <p><strong>ÂÖ≥ËÅî‰º†ÊÑüÂô®:</strong> ${camera.sensorId}</p>
                    <p><strong>ÊúÄÂêéÊõ¥Êñ∞:</strong> ${camera.lastUpdate}</p>
                </div>
                <div class="camera-controls">
                    <button class="btn btn-primary" disabled>ÊîæÂ§ß</button>
                    <button class="btn btn-primary" disabled>ÊóãËΩ¨</button>
                    <button class="btn btn-primary" disabled>Êà™Âõæ</button>
                    <button class="btn btn-primary" disabled>‰∏ãËΩΩÂΩïÂÉè</button>
                </div>
            `;
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            $(modal).modal('show');
        }

        // ÂàõÂª∫ÊëÑÂÉèÂ§¥ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü
        function createCameraDetailModal() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'cameraDetailModal';
            modal.tabIndex = '-1';
            modal.role = 'dialog';
            modal.setAttribute('aria-labelledby', 'cameraDetailModalLabel');
            modal.setAttribute('aria-hidden', 'true');
            
            modal.innerHTML = `
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="cameraDetailModalLabel">ÊëÑÂÉèÂ§¥ËØ¶ÊÉÖ</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- ÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÂ°´ÂÖÖ -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">ÂÖ≥Èó≠</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            return modal;
        }

        // Ê∑ªÂä†ÊëÑÂÉèÂ§¥Áõ∏ÂÖ≥ÁöÑCSSÊ†∑Âºè
        function addCameraStyles() {
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                .camera-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                    grid-gap: 20px;
                    margin-top: 20px;
                }
                
                .camera-card {
                    position: relative;
                    border-radius: 6px;
                    overflow: hidden;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    transition: transform 0.2s, box-shadow 0.2s;
                    background-color: #fff;
                }
                
                .camera-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
                }
                
                .camera-feed {
                    height: 180px;
                    position: relative;
                    overflow: hidden;
                    background-color: #eee;
                }
                
                .camera-feed img, .camera-feed canvas {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
                
                .camera-status {
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                    background-color: rgba(0,0,0,0.5);
                    color: white;
                }
                
                .camera-status.online {
                    background-color: rgba(40, 167, 69, 0.8);
                }
                
                .camera-status.offline {
                    background-color: rgba(108, 117, 125, 0.8);
                }
                
                .camera-status.warning {
                    background-color: rgba(255, 193, 7, 0.8);
                }
                
                .camera-info {
                    padding: 12px;
                }
                
                .camera-name {
                    font-weight: bold;
                    margin-bottom: 5px;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
                
                .camera-location {
                    color: #666;
                    font-size: 12px;
                    margin-bottom: 8px;
                }
                
                .camera-metrics {
                    display: flex;
                    justify-content: space-between;
                    font-size: 12px;
                    color: #666;
                }
                
                .camera-timestamp {
                    color: #888;
                    font-style: italic;
                }
                
                .camera-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                    color: white;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    opacity: 0;
                    transition: opacity 0.3s;
                }
                
                .camera-feed:hover .camera-overlay {
                    opacity: 1;
                }
                
                .camera-actions {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                }
                
                .camera-action-btn {
                    background-color: rgba(255,255,255,0.2);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 5px;
                    cursor: pointer;
                    transition: background-color 0.2s;
                }
                
                .camera-action-btn:hover {
                    background-color: rgba(255,255,255,0.4);
                }
                
                .no-data-message {
                    text-align: center;
                    padding: 40px;
                    background-color: #f8f9fa;
                    border-radius: 6px;
                    color: #6c757d;
                    margin-top: 20px;
                }
                
                .offline-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                }
                
                .no-camera-results {
                    text-align: center;
                    padding: 20px;
                    color: #6c757d;
                    display: none;
                }
                
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(styleElement);
        }

        // Ê∑ªÂä†ÊëÑÂÉèÂ§¥Ê†∑Âºè
        addCameraStyles();

        // ÂàùÂßãÂåñ‰∫ã‰ª∂È¢ÑÊµã
        function initializeEventPredictions() {
            // ÈöèÊú∫ÁîüÊàê‰∏Ä‰∫õÂàùÂßã‰∫ã‰ª∂È¢ÑÊµã
            eventPredictions = [];
            
            // Â¶ÇÊûúÊúâÂºÇÂ∏∏Êï∞ÊçÆÔºåÁîüÊàêÁõ∏Â∫îÁöÑ‰∫ã‰ª∂È¢ÑÊµã
            const abnormalData = sensorData.filter(item => item.status !== 'normal');
            
            if (abnormalData.length > 0) {
                // Êåâ‰º†ÊÑüÂô®Á±ªÂûãÂàÜÁªÑÂºÇÂ∏∏Êï∞ÊçÆ
                const groupedByType = {};
                abnormalData.forEach(item => {
                    if (!groupedByType[item.sensorType]) {
                        groupedByType[item.sensorType] = [];
                    }
                    groupedByType[item.sensorType].push(item);
                });
                
                // ‰∏∫‰∏ªË¶ÅÁöÑÂºÇÂ∏∏Á±ªÂûãÂàõÂª∫‰∫ã‰ª∂È¢ÑÊµã
                Object.keys(groupedByType).forEach(type => {
                    const count = groupedByType[type].length;
                    if (count > 5) { // Ëá≥Â∞ëÊúâ5‰∏™ÂºÇÂ∏∏ÁÇπÊâçÂàõÂª∫È¢ÑÊµã
                        const locations = [...new Set(groupedByType[type].map(item => item.location))];
                        const sensorIds = [...new Set(groupedByType[type].map(item => item.sensorId))].slice(0, 3);
                        let eventType, reasoning, severity;
                        
                        switch(type) {
                            case 'Ê∏©Â∫¶':
                                eventType = 'Ê∏©Â∫¶ÂºÇÂ∏∏Ê≥¢Âä®';
                                reasoning = `${locations.join('„ÄÅ')}Ê∏©Â∫¶‰º†ÊÑüÂô®Êï∞ÊçÆÂá∫Áé∞ÈùûÊ≠£Â∏∏Ê≥¢Âä®ÔºåÂèØËÉΩÂèóÁéØÂ¢ÉÂõ†Á¥†ÂΩ±Âìç`;
                                severity = 'medium';
                                break;
                            case 'Â∫îÂèò':
                                eventType = 'ÁªìÊûÑÂ∫îÂèòÂºÇÂ∏∏';
                                reasoning = `${locations.join('„ÄÅ')}Â∫îÂèò‰º†ÊÑüÂô®Êï∞ÊçÆÊåÅÁª≠ÂÅèÈ´òÔºåÁªìÊûÑÊâøÂèóÂéãÂäõÂºÇÂ∏∏`;
                                severity = 'high';
                                break;
                            case 'ÊåØÂä®':
                                eventType = 'ÂºÇÂ∏∏ÊåØÂä®';
                                reasoning = `${locations.join('„ÄÅ')}ÊåØÂä®‰º†ÊÑüÂô®Ê£ÄÊµãÂà∞Ë∂ÖÂá∫Ê≠£Â∏∏ËåÉÂõ¥ÁöÑÊåØÂä®`;
                                severity = 'medium';
                                break;
                            case 'ÂÄæËßí':
                                eventType = 'ÁªìÊûÑÂÄæÊñú';
                                reasoning = `${locations.join('„ÄÅ')}ÂÄæËßí‰º†ÊÑüÂô®Êï∞ÊçÆÊòæÁ§∫ÁªìÊûÑËßíÂ∫¶ÂºÇÂ∏∏`;
                                severity = 'high';
                                break;
                            case '‰ΩçÁßª':
                                eventType = 'ÁªìÊûÑ‰ΩçÁßªÂºÇÂ∏∏';
                                reasoning = `${locations.join('„ÄÅ')}‰ΩçÁßª‰º†ÊÑüÂô®ÊòæÁ§∫Ê°•Ê¢ÅÈÉ®‰ª∂Âá∫Áé∞ÂºÇÂ∏∏ÁßªÂä®`;
                                severity = 'high';
                                break;
                            case 'ËΩΩÈáç':
                                eventType = 'Ë¥üËΩΩËøáÈ´ò';
                                reasoning = `${locations.join('„ÄÅ')}ËΩΩÈáç‰º†ÊÑüÂô®ÊòæÁ§∫Ê°•Ê¢ÅÊâøÂèóÂéãÂäõË∂ÖÂá∫ÂÆâÂÖ®ËåÉÂõ¥`;
                                severity = 'medium';
                                break;
                            default:
                                eventType = `${type}Êï∞ÊçÆÂºÇÂ∏∏`;
                                reasoning = `${locations.join('„ÄÅ')}${type}‰º†ÊÑüÂô®Êï∞ÊçÆÂá∫Áé∞ÂºÇÂ∏∏Ê≥¢Âä®`;
                                severity = 'low';
                        }
                        
                        eventPredictions.push({
                            id: Date.now() + Math.random(),
                            eventType: eventType,
                            probability: 0.5 + Math.random() * 0.4,
                            reasoning: reasoning,
                            timestamp: new Date().toLocaleString('zh-CN'),
                            severity: severity,
                            relatedSensors: sensorIds
                        });
                    }
                });
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâÂü∫‰∫éÊï∞ÊçÆÁîüÊàêÁöÑÈ¢ÑÊµãÔºåÂàôÁîüÊàê‰∏Ä‰∏™"Ê≠£Â∏∏ËøêË°å"ÁöÑÈ¢ÑÊµã
            if (eventPredictions.length === 0) {
                eventPredictions.push({
                    id: Date.now(),
                    eventType: 'Ê≠£Â∏∏ËøêÁª¥‰∏≠',
                    probability: 0.95,
                    reasoning: 'ÊâÄÊúâ‰º†ÊÑüÂô®Êï∞ÊçÆÂú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖÔºåÊó†ÂºÇÂ∏∏Ê®°Âºè',
                    timestamp: new Date().toLocaleString('zh-CN'),
                    severity: 'low',
                    relatedSensors: ['Á≥ªÁªüÁä∂ÊÄÅ']
                });
            }
            
            // ÊòæÁ§∫‰∫ã‰ª∂È¢ÑÊµã
            displayEventPredictions();
        }

        // ÊêúÁ¥¢ÂíåÁ≠õÈÄâÊëÑÂÉèÂ§¥
        function searchAndFilterCameras() {
            const searchTerm = document.getElementById('camera-search').value.toLowerCase();
            const statusFilter = document.getElementById('camera-filter').value;
            const sectionFilter = document.getElementById('section-filter').value;
            
            const filteredCameras = allCameras.filter(camera => {
                // ÊêúÁ¥¢Êù°‰ª∂
                const matchesSearch = 
                    camera.name.toLowerCase().includes(searchTerm) ||
                    camera.id.toLowerCase().includes(searchTerm) ||
                    camera.sensorId.toLowerCase().includes(searchTerm);
                
                // Áä∂ÊÄÅÁ≠õÈÄâ
                const matchesStatus = 
                    statusFilter === 'all' || 
                    (statusFilter === 'online' && camera.status === 'online') ||
                    (statusFilter === 'offline' && camera.status === 'offline') ||
                    (statusFilter === 'warning' && camera.status === 'warning');
                
                // Âå∫ÊÆµÁ≠õÈÄâ
                const matchesSection = 
                    sectionFilter === 'all' ||
                    (sectionFilter === 'north' && camera.section === 'ÂåóÊÆµ') ||
                    (sectionFilter === 'center' && camera.section === '‰∏≠ÊÆµ') ||
                    (sectionFilter === 'south' && camera.section === 'ÂçóÊÆµ') ||
                    (sectionFilter === 'east' && camera.section === '‰∏úÊÆµ') ||
                    (sectionFilter === 'west' && camera.section === 'Ë•øÊÆµ');
                
                return matchesSearch && matchesStatus && matchesSection;
            });
            
            displayCameras(filteredCameras);
        }

        // Ê®°ÊãüÊâìÂºÄÊëÑÂÉèÂ§¥Áõ¥Êí≠
        function openCameraFeed(cameraId) {
            const camera = allCameras.find(cam => cam.id === cameraId);
            if (!camera) return;
            
            if (camera.status === 'offline') {
                alert(`Êó†Ê≥ïËøûÊé•ÊëÑÂÉèÂ§¥ ${camera.id}ÔºöËÆæÂ§áÁ¶ªÁ∫ø`);
                return;
            }
            
            alert(`Ê≠£Âú®ËøûÊé•Âà∞ÊëÑÂÉèÂ§¥Ôºö${camera.name}\n‰º†ÊÑüÂô®IDÔºö${camera.sensorId}`);
            // ËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÂÆûÈôÖÁöÑÊëÑÂÉèÂ§¥ËøûÊé•ÈÄªËæë
        }

        // ÈöèÊú∫Êõ¥Êñ∞‰º†ÊÑüÂô®Êï∞ÊçÆ
        function randomlyUpdateData() {
            if (!sensorData || sensorData.length === 0) return;
            
            // Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥‰Ωú‰∏∫Êñ∞ÁöÑÊï∞ÊçÆÁÇπÊó∂Èó¥Êà≥
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Ëé∑ÂèñÂîØ‰∏ÄÁöÑ‰º†ÊÑüÂô®IDÂàóË°®
            const uniqueSensors = [...new Set(sensorData.map(item => item.sensorId))];
            
            // ÂàõÂª∫ÁéØÂ¢ÉÂõ†Á¥†ÔºåÁ°Æ‰øùÊï∞ÊçÆ‰πãÈó¥ÁöÑÂÖ≥ËÅîÊÄß
            const environmentalFactor = Math.sin(Date.now() / 10000000) * 0.15; // ÁºìÊÖ¢ÂèòÂåñÁöÑÁéØÂ¢ÉÂõ†Á¥†
            const timeOfDayFactor = Math.sin(now.getHours() / 24 * Math.PI) * 0.1; // Êó•Èó¥ÂèòÂåñÂõ†Á¥†
            const bridgeLoadFactor = Math.sin(Date.now() / 3600000) * 0.08; // Ê°•Ê¢ÅË¥üËΩΩÂèòÂåñ
            
            // ÂÖ®Â±ÄÊ∏©Â∫¶ÂΩ±Âìç
            const temperature = 20 + Math.sin(now.getHours() / 24 * Math.PI * 2) * 5 + Math.random() * 2;
            
            // ‰∏∫ÊØè‰∏™‰º†ÊÑüÂô®ÂàõÂª∫Êñ∞ÁöÑÊï∞ÊçÆÁÇπ
            uniqueSensors.forEach(sensorId => {
                // Ëé∑ÂèñËØ•‰º†ÊÑüÂô®ÁöÑÂéÜÂè≤Êï∞ÊçÆ
                const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
                const currentValue = sensorPoints[sensorPoints.length - 1].value;
                
                // Ê†πÊçÆ‰º†ÊÑüÂô®IDÂàÜÊûê‰º†ÊÑüÂô®Á±ªÂûãÂíåÂå∫ÊÆµ
                let sensorType = 'ÂÖ∂‰ªñ';
                let sensorLocation = '‰∏≠ÊÆµ';
                
                if (sensorId.includes('Ê∏©Â∫¶')) sensorType = 'Ê∏©Â∫¶';
                else if (sensorId.includes('Â∫îÂèò')) sensorType = 'Â∫îÂèò';
                else if (sensorId.includes('ÊåØÂä®')) sensorType = 'ÊåØÂä®';
                else if (sensorId.includes('ÂÄæËßí')) sensorType = 'ÂÄæËßí';
                
                for (const section of ['ÂåóÊÆµ', '‰∏≠ÊÆµ', 'ÂçóÊÆµ', '‰∏úÊÆµ', 'Ë•øÊÆµ']) {
                    if (sensorId.includes(section)) {
                        sensorLocation = section;
                        break;
                    }
                }
                
                // ËÆ°ÁÆóÂå∫ÊÆµÈó¥ÁöÑ"Ë∑ùÁ¶ª"‰ª•Á°Æ‰øùÁõ∏ÈÇªÂå∫ÊÆµÁöÑÊï∞ÊçÆË∂ãÂäøÁõ∏‰ºº
                function getSectionDistance(section1, section2) {
                    const sections = ['ÂåóÊÆµ', '‰∏≠ÊÆµ', 'ÂçóÊÆµ', '‰∏úÊÆµ', 'Ë•øÊÆµ'];
                    const idx1 = sections.indexOf(section1);
                    const idx2 = sections.indexOf(section2);
                    return Math.abs(idx1 - idx2);
                }
                
                // Ê†πÊçÆ‰º†ÊÑüÂô®Á±ªÂûãËé∑ÂèñÊï∞ÊçÆËåÉÂõ¥
                const range = sensorRanges[sensorType] || sensorRanges['ÂÖ∂‰ªñ'];
                
                // ËÆ°ÁÆóÂü∫Á°ÄÂèòÂåñÈáè
                let baseChange = 0;
                let multiplier = 1.0;
                
                // Âü∫Á°ÄÈöèÊú∫Ê≥¢Âä® (Â∞èÂπÖ)
                const randomFactor = (Math.random() * 2 - 1) * 0.01 * currentValue;
                
                // ÁéØÂ¢ÉÂõ†Á¥†ÂΩ±Âìç
                let environmentalImpact = 0;
                if (sensorType === 'Ê∏©Â∫¶') {
                    environmentalImpact = environmentalFactor * 1.2 + (temperature - 20) * 0.1;
                } else if (sensorType === 'Â∫îÂèò') {
                    environmentalImpact = bridgeLoadFactor * 1.5 + timeOfDayFactor * 0.5;
                } else if (sensorType === 'ÊåØÂä®') {
                    environmentalImpact = bridgeLoadFactor * 1.2 + environmentalFactor * 0.8;
                } else if (sensorType === 'ÂÄæËßí') {
                    environmentalImpact = bridgeLoadFactor * 0.9 + environmentalFactor * 1.1;
                } else {
                    environmentalImpact = environmentalFactor * 0.8 + timeOfDayFactor * 0.7;
                }
                
                // ÊÄªÂèòÂåñÈáè = ÁéØÂ¢ÉÂΩ±Âìç + ÈöèÊú∫Âô™Â£∞
                baseChange = (environmentalImpact * currentValue * 0.05) + randomFactor;
                
                // Â∫îÁî®ÂΩ±ÂìçÂõ†Â≠ê
                baseChange *= multiplier;
                
                // ËÆ°ÁÆóÊñ∞ÂÄº
                let newValue = currentValue + baseChange;
                
                // Á°Æ‰øùÊñ∞ÂÄºÂú®ÂêàÁêÜËåÉÂõ¥ÂÜÖ
                const minValue = range.normal[0] * 0.9;
                const maxValue = range.normal[1] * 1.1;
                
                if (newValue < minValue) newValue = minValue + Math.random() * (range.normal[0] - minValue);
                if (newValue > maxValue) newValue = maxValue - Math.random() * (maxValue - range.normal[1]);
                
                // Á°Æ‰øùÊï∞ÊçÆÁöÑËøûÁª≠ÊÄß
                const maxChange = currentValue * 0.15; // ÊúÄÂ§ßÂÖÅËÆ∏15%ÁöÑÂèòÂåñ
                if (Math.abs(newValue - currentValue) > maxChange) {
                    newValue = currentValue + (Math.sign(newValue - currentValue) * maxChange * Math.random());
                }
                
                // Á°ÆÂÆö‰º†ÊÑüÂô®Áä∂ÊÄÅ
                let status = 'normal';
                if (newValue > range.warning[1] || newValue < range.warning[0]) {
                    status = 'warning';
                }
                if (newValue > range.danger[1] || newValue < range.danger[0]) {
                    status = 'danger';
                }
                
                // ÂàõÂª∫Êñ∞ÁöÑÊï∞ÊçÆÁÇπ
                const newDataPoint = {
                    timestamp: timeStr,
                    sensorId: sensorId,
                    value: newValue,
                    status: status
                };
                
                // Ê∑ªÂä†Âà∞Êï∞ÊçÆÈõÜ
                sensorData.push(newDataPoint);
                
                // Êõ¥Êñ∞UI
                addDataToTable(newDataPoint);
                
                // Êõ¥Êñ∞ÂõæË°®
                updateCharts();
                
                // Êõ¥Êñ∞Áõ∏ÂÖ≥ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ
                updateCameraStatus(sensorId, status);
            });
            
            // ‰∫ã‰ª∂È¢ÑÊµãÊ¶ÇÁéáÊõ¥Êñ∞
            updateEventPredictions();
            
            // ÈôêÂà∂Êï∞ÊçÆÁÇπÊï∞ÈáèÔºå‰øùÁïôÊúÄËøëÁöÑ2000‰∏™Êï∞ÊçÆÁÇπ
            if (sensorData.length > 2000) {
                sensorData = sensorData.slice(sensorData.length - 2000);
                refreshTable();
            }
        }

        // Êõ¥Êñ∞‰∫ã‰ª∂È¢ÑÊµãÊ¶ÇÁéá
        function updateEventPredictions() {
            // Ê†πÊçÆ‰º†ÊÑüÂô®Êï∞ÊçÆÊõ¥Êñ∞‰∫ã‰ª∂È¢ÑÊµãÊ¶ÇÁéá
            eventPredictions.forEach(prediction => {
                // Ê£ÄÊü•Áõ∏ÂÖ≥‰º†ÊÑüÂô®ÁöÑÊúÄÊñ∞Áä∂ÊÄÅ
                const relevantSensors = prediction.relatedSensors;
                let abnormalCount = 0;
                
                relevantSensors.forEach(sensorId => {
                    const sensorData = findLastSensorData(sensorId);
                    if (sensorData && (sensorData.status === 'warning' || sensorData.status === 'danger')) {
                        abnormalCount++;
                    }
                });
                
                // Êõ¥Êñ∞Ê¶ÇÁéáÔºàÂºÇÂ∏∏‰º†ÊÑüÂô®Ë∂äÂ§öÔºåÊ¶ÇÁéáË∂äÈ´òÔºâ
                const ratio = abnormalCount / relevantSensors.length;
                // Â¢ûÂä†‰∏Ä‰∫õÈöèÊú∫Ê≥¢Âä®‰ΩøÈ¢ÑÊµãÊòæÂæóÊõ¥Ëá™ÁÑ∂
                const randomFactor = Math.random() * 0.1 - 0.05;
                
                prediction.probability = Math.max(0.1, Math.min(0.95, prediction.probability * 0.6 + ratio * 0.4 + randomFactor));
                
                // Êõ¥Êñ∞Êó∂Èó¥Êà≥
                prediction.timestamp = new Date().toLocaleString('zh-CN');
                
                // Êõ¥Êñ∞‰∏•ÈáçÁ®ãÂ∫¶
                if (prediction.probability > 0.75) {
                    prediction.severity = 'high';
                } else if (prediction.probability > 0.5) {
                    prediction.severity = 'medium';
                } else {
                    prediction.severity = 'low';
                }
            });
            
            // Âà∑Êñ∞È¢ÑÊµãÊòæÁ§∫
            displayEventPredictions();
        }

        // Êü•Êâæ‰º†ÊÑüÂô®ÊúÄÊñ∞Êï∞ÊçÆ
        function findLastSensorData(sensorId) {
            const sensorPoints = sensorData.filter(item => item.sensorId === sensorId);
            if (sensorPoints.length > 0) {
                return sensorPoints[sensorPoints.length - 1];
            }
            return null;
        }

        // Êõ¥Êñ∞ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ
        function updateCameraStatus(sensorId, sensorStatus) {
            // Êü•Êâæ‰∏éËØ•‰º†ÊÑüÂô®ÂÖ≥ËÅîÁöÑÊâÄÊúâÊëÑÂÉèÂ§¥
            const relatedCameras = allCameras.filter(cam => cam.sensorId === sensorId);
            
            if (relatedCameras.length === 0) return;
            
            // Ê†πÊçÆ‰º†ÊÑüÂô®Áä∂ÊÄÅÊõ¥Êñ∞ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ
            relatedCameras.forEach(camera => {
                // Âè™ÊúâÂΩìÊëÑÂÉèÂ§¥‰∏çÊòØÁ¶ªÁ∫øÁä∂ÊÄÅÊó∂ÊâçËøõË°åÊõ¥Êñ∞
                if (camera.status !== 'offline') {
                    if (sensorStatus === 'danger') {
                        camera.status = 'warning'; // ‰º†ÊÑüÂô®ÂëäË≠¶Êó∂ÔºåÊëÑÂÉèÂ§¥Áä∂ÊÄÅËÆæ‰∏∫Ë≠¶Âëä
                    } else {
                        // 80%ÁöÑÊ¶ÇÁéá‰øùÊåÅÂéüÁä∂ÊÄÅÔºå20%ÁöÑÊ¶ÇÁéáÊõ¥Êñ∞‰∏∫‰º†ÊÑüÂô®Áä∂ÊÄÅ
                        if (Math.random() > 0.8) {
                            camera.status = sensorStatus === 'warning' ? 'warning' : 'online';
                        }
                    }
                    camera.lastUpdate = new Date().toLocaleString('zh-CN');
                }
            });
            
            // Êõ¥Êñ∞ÊëÑÂÉèÂ§¥ÊòæÁ§∫
            displayCameras();
        }

        // ÊñáÊ°£Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log("È°µÈù¢Â∑≤Âä†ËΩΩÔºåÂºÄÂßãÂàùÂßãÂåñ...");
            
            // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            checkLoginStatus();
            
            // ÂàùÂßãÂåñÂÖ∂‰ªñÂäüËÉΩ...
            
            // ÁªëÂÆöÁôªÂΩïÊåâÈíÆ‰∫ã‰ª∂
            if (loginButton) {
                loginButton.addEventListener('click', handleLogin);
            } else {
                console.warn("Êâæ‰∏çÂà∞ÁôªÂΩïÊåâÈíÆÔºåËØ∑Ê£ÄÊü•HTMLÁªìÊûÑ");
            }
            
            // ÁªëÂÆöÁôªÂá∫ÊåâÈíÆ‰∫ã‰ª∂
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }
            
            // Â¶ÇÊûúÊâæÂà∞ÁôªÂΩïË°®ÂçïÔºåÁªëÂÆöÂõûËΩ¶ÈîÆÁôªÂΩïÂäüËÉΩ
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            }
            
            // ... ÂÖ∂‰ªñÂàùÂßãÂåñ‰ª£Á†Å ...
        });

        // Âú®È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ‰∫ã‰ª∂È¢ÑÊµãÂå∫Âüü
        function initEventPredictionArea() {
            const mainContent = document.querySelector('.main-content');
            if (!mainContent) return;
            
            // ÂàõÂª∫‰∫ã‰ª∂È¢ÑÊµãÂÆπÂô®
            const eventArea = document.createElement('div');
            eventArea.className = 'event-prediction-area';
            eventArea.innerHTML = `
                <div class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>‰∫ã‰ª∂È¢ÑÊµã</span>
                </div>
                <div id="event-prediction-container" class="prediction-container">
                    <div class="no-predictions">ÊöÇÊó†ÂºÇÂ∏∏‰∫ã‰ª∂È¢ÑÊµã</div>
                </div>
            `;
            
            // Â∞Ü‰∫ã‰ª∂È¢ÑÊµãÂå∫ÂüüÊèíÂÖ•Âà∞‰∏ªÂÜÖÂÆπÂå∫ÂüüÁöÑÊúÄÂâçÈù¢
            mainContent.insertBefore(eventArea, mainContent.firstChild);
            
            // Ê∑ªÂä†‰∫ã‰ª∂È¢ÑÊµãÁõ∏ÂÖ≥ÁöÑCSS
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                .event-prediction-area {
                    margin-bottom: 20px;
                    background-color: #fff;
                    border-radius: 8px;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                    padding: 15px;
                }
                
                .prediction-container {
                    margin-top: 10px;
                }
                
                .no-predictions {
                    color: #888;
                    text-align: center;
                    padding: 10px;
                }
                
                .event-prediction-card {
                    padding: 12px;
                    border-radius: 6px;
                    margin-bottom: 10px;
                    border-left: 4px solid #5cb85c;
                    background-color: #f9f9f9;
                }
                
                .event-prediction-card.severity-high {
                    border-left-color: #d9534f;
                }
                
                .event-prediction-card.severity-medium {
                    border-left-color: #f0ad4e;
                }
                
                .event-prediction-card.severity-low {
                    border-left-color: #5bc0de;
                }
                
                .event-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 8px;
                }
                
                .event-type {
                    font-weight: bold;
                    font-size: 16px;
                }
                
                .event-probability {
                    font-weight: bold;
                    color: #d9534f;
                }
                
                .event-reasoning {
                    margin-bottom: 10px;
                    line-height: 1.4;
                }
                
                .event-details {
                    display: flex;
                    flex-direction: column;
                    font-size: 12px;
                    color: #777;
                }
                
                .event-timestamp, .event-sensors {
                    margin-bottom: 2px;
                }
            `;
            document.head.appendChild(styleElement);
        }

        // ÂàùÂßãÂåñ‰∫ã‰ª∂È¢ÑÊµãÊï∞ÊçÆ
        let eventPredictions = []; 

        // Ê∑ªÂä†ÊëÑÂÉèÂ§¥Ê†∑Âºè
        addCameraStyles();

        // Ê∑ªÂä†‰∫ã‰ª∂È¢ÑÊµãÊ†∑Âºè
        function addEventPredictionStyles() {
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                .event-predictions-section {
                    margin-top: 10px;
                }
                
                .no-predictions {
                    color: #888;
                    text-align: center;
                    padding: 10px;
                }
                
                .event-prediction-card {
                    padding: 12px;
                    border-radius: 6px;
                    margin-bottom: 10px;
                    border-left: 4px solid #5cb85c;
                    background-color: #f9f9f9;
                }
                
                .event-prediction-card.severity-high {
                    border-left-color: #d9534f;
                }
                
                .event-prediction-card.severity-medium {
                    border-left-color: #f0ad4e;
                }
                
                .event-prediction-card.severity-low {
                    border-left-color: #5bc0de;
                }
                
                .event-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 8px;
                }
                
                .event-type {
                    font-weight: bold;
                    font-size: 16px;
                }
                
                .event-probability {
                    font-weight: bold;
                    color: #d9534f;
                }
                
                .event-reasoning {
                    margin-bottom: 10px;
                    line-height: 1.4;
                }
                
                .event-details {
                    display: flex;
                    flex-direction: column;
                    font-size: 12px;
                    color: #777;
                }
                
                .event-timestamp, .event-sensors {
                    margin-bottom: 2px;
                }
            `;
            document.head.appendChild(styleElement);
        }

        // Ê∑ªÂä†ÊëÑÂÉèÂ§¥Ê†∑Âºè
        addCameraStyles();
    </script>
</body>
</html> 